<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8" />-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>-->
<!--  <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">-->
<!--  <title>Gurukul Utsav New Registration</title>-->
<!--  <script src="https://cdn.tailwindcss.com"></script>-->
<!--  <script>-->
<!--    // Ensure Tailwind is loaded before configuration-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        if (typeof tailwind !== 'undefined') {-->
<!--            tailwind.config = {-->
<!--                theme: {-->
<!--                    extend: {-->
<!--                        fontFamily: {-->
<!--                            inter: ['Inter', 'sans-serif'],-->
<!--                        },-->
<!--                        colors: {-->
<!--                            'dark-bg': '#03040A',-->
<!--                            'text-color-primary': '#e5e7eb',-->
<!--                            'text-color-secondary': '#9ca3af',-->
<!--                            'glass-bg': 'rgba(15, 12, 29, 0.4)',-->
<!--                            'glass-border': 'rgba(255, 255, 255, 0.1)',-->
<!--                            'input-bar-bg': 'rgba(10, 8, 20, 0.7)',-->
<!--                            'bot-message-bg': 'rgba(43, 46, 62, 0.7)', /* New: specifically for bot messages */-->
<!--                            'user-input-bg': 'linear-gradient(135deg, #007BFF, #0056b3)', /* For user response section */-->
<!--                            'form-button-bg': '#007BFF', /* Primary button color */-->
<!--                            'form-button-hover': '#0056b3',-->
<!--                            'error-red': '#ef4444', /* Tailwind red-500 */-->
<!--                            'success-green': '#22c55e', /* Tailwind green-500 */-->
<!--                            'scroll-thumb-bg': 'rgba(148, 163, 184, 0.3)',-->
<!--                            'splash-bg': 'rgba(0, 0, 0, 0.6)',-->
<!--                            'settings-highlight-bg': 'rgba(255, 255, 255, 0.05)',-->
<!--                            'form-field-bg-dark': 'rgba(0, 0, 0, 0.3)', /* Dark mode input field background */-->
<!--                            'calendar-day-bg': 'rgba(255, 255, 255, 0.1)',-->
<!--                            'calendar-day-hover': 'rgba(255, 255, 255, 0.2)',-->
<!--                            'calendar-day-selected': '#007BFF',-->
<!--                            'time-picker-bg': 'rgba(255, 255, 255, 0.15)', /* Removed, but kept for reference */-->
<!--                            'time-picker-selected-bg': 'rgba(255, 255, 255, 0.3)', /* Removed, but kept for reference */-->
<!--                        }-->
<!--                    },-->
<!--                }-->
<!--            };-->
<!--        } else {-->
<!--            console.error("Tailwind CSS not loaded. Cannot apply custom configuration.");-->
<!--        }-->
<!--    });-->
<!--  </script>-->
<!--  <link rel="preconnect" href="https://fonts.googleapis.com">-->
<!--  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>-->
<!--  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">-->
<!--  &lt;!&ndash; Font Awesome for Icons &ndash;&gt;-->
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">-->
<!--  &lt;!&ndash; html2pdf.js for PDF generation &ndash;&gt;-->
<!--  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>-->

<!--  <style>-->
<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    /* CSS Variables for Theming      */-->
<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    :root {-->
<!--      &#45;&#45;bg-color: #03040A;-->
<!--      &#45;&#45;text-color-primary: #e5e7eb;-->
<!--      &#45;&#45;text-color-secondary: #9ca3af;-->
<!--      &#45;&#45;glass-bg: rgba(15, 12, 29, 0.4);-->
<!--      &#45;&#45;glass-border: rgba(255, 255, 255, 0.1);-->
<!--      &#45;&#45;input-bar-bg: rgba(10, 8, 20, 0.7);-->
<!--      &#45;&#45;bot-message-bg: rgba(43, 46, 62, 0.7);-->
<!--      &#45;&#45;user-input-bg: linear-gradient(135deg, #007BFF, #0056b3);-->
<!--      &#45;&#45;form-button-bg: #007BFF;-->
<!--      &#45;&#45;form-button-hover: #0056b3;-->
<!--      &#45;&#45;scroll-thumb-bg: rgba(148, 163, 184, 0.3);-->
<!--      &#45;&#45;splash-bg: rgba(0, 0, 0, 0.6);-->
<!--      &#45;&#45;settings-highlight-bg: rgba(255, 255, 255, 0.05);-->
<!--      &#45;&#45;error-color: #ef4444;-->
<!--      &#45;&#45;success-color: #22c55e;-->
<!--      &#45;&#45;form-field-bg: rgba(0, 0, 0, 0.3); /* For inputs */-->
<!--      &#45;&#45;calendar-day-bg: rgba(255, 255, 255, 0.1);-->
<!--      &#45;&#45;calendar-day-hover: rgba(255, 255, 255, 0.2);-->
<!--      &#45;&#45;calendar-day-selected: #007BFF;-->

<!--      /* Zoom variables */-->
<!--      &#45;&#45;global-font-size: 16px; /* Base font size for 'rem' calculation */-->
<!--      &#45;&#45;chat-max-width: 640px; /* Base max-width for chat container */-->
<!--    }-->

<!--    .light-theme {-->
<!--      &#45;&#45;bg-color: #F0F2F5;-->
<!--      &#45;&#45;text-color-primary: #1f2937;-->
<!--      &#45;&#45;text-color-secondary: #4b5563;-->
<!--      &#45;&#45;glass-bg: rgba(255, 255, 255, 0.5);-->
<!--      &#45;&#45;glass-border: rgba(0, 0, 0, 0.1);-->
<!--      &#45;&#45;input-bar-bg: rgba(229, 231, 235, 0.8);-->
<!--      &#45;&#45;bot-message-bg: rgba(229, 231, 235, 1);-->
<!--      &#45;&#45;user-input-bg: linear-gradient(135deg, #007BFF, #0069d9);-->
<!--      &#45;&#45;form-button-bg: #007BFF;-->
<!--      &#45;&#45;form-button-hover: #0069d9;-->
<!--      &#45;&#45;scroll-thumb-bg: rgba(107, 114, 128, 0.4);-->
<!--      &#45;&#45;splash-bg: rgba(255, 255, 255, 0.5);-->
<!--      &#45;&#45;settings-highlight-bg: rgba(0, 0, 0, 0.05);-->
<!--      &#45;&#45;error-color: #dc2626;-->
<!--      &#45;&#45;success-color: #16a34a;-->
<!--      &#45;&#45;form-field-bg: rgba(255, 255, 255, 0.7); /* For inputs */-->
<!--      &#45;&#45;calendar-day-bg: rgba(0, 0, 0, 0.05);-->
<!--      &#45;&#45;calendar-day-hover: rgba(0, 0, 0, 0.1);-->
<!--      &#45;&#45;calendar-day-selected: #007BFF;-->
<!--    }-->

<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    /* Base Styling                   */-->
<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    body {-->
<!--      font-family: 'Inter', sans-serif;-->
<!--      background-color: var(&#45;&#45;bg-color);-->
<!--      color: var(&#45;&#45;text-color-primary);-->
<!--      /* Removed overflow: hidden from body to allow full page scrolling if needed */-->
<!--      transition: background-color 0.5s ease, color 0.5s ease;-->
<!--      font-size: var(&#45;&#45;global-font-size); /* Apply global font size */-->
<!--    }-->

<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    /* Dynamic Evolving Waves         */-->
<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    #dynamic-background {-->
<!--      position: fixed; inset: 0; z-index: 0; overflow: hidden;-->
<!--      background-color: var(&#45;&#45;bg-color);-->
<!--      transition: background-color 0.5s ease;-->
<!--    }-->
<!--    #dynamic-background .wave {-->
<!--      position: absolute; border-radius: 50%; filter: blur(120px); opacity: 0.5;-->
<!--    }-->

<!--    @keyframes wave-move-1 { 0% { transform: translate(0, 0) rotate(0deg) scale(1.2); } 50% { transform: translate(150px, 100px) rotate(180deg) scale(1.4); } 100% { transform: translate(0, 0) rotate(360deg) scale(1.2); } }-->
<!--    @keyframes wave-move-2 { 0% { transform: translate(0, 0) rotate(0deg) scale(1); } 50% { transform: translate(-200px, -150px) rotate(180deg) scale(1.2); } 100% { transform: translate(0, 0) rotate(360deg) scale(1); } }-->
<!--    @keyframes wave-move-3 { 0% { transform: translate(0, 0) rotate(0deg) scale(1.1); } 50% { transform: translate(100px, -150px) rotate(-180deg) scale(1.3); } 100% { transform: translate(0, 0) rotate(-360deg) scale(1.1); } }-->
<!--    @keyframes change-color-1 { 0%, 100% { background-color: #1a0033; } 33% { background-color: #001f2e; } 66% { background-color: #0d1127; } }-->
<!--    @keyframes change-color-2 { 0%, 100% { background-color: #001f2e; } 33% { background-color: #0d1127; } 66% { background-color: #2a004d; } }-->
<!--    @keyframes change-color-3 { 0%, 100% { background-color: #0d1127; } 33% { background-color: #1a0033; } 66% { background-color: #00334d; } }-->

<!--    .wave-1 { width: 800px; height: 800px; top: -25%; left: -15%; animation: wave-move-1 30s cubic-bezier(0.36, 0.45, 0.63, 0.53) infinite, change-color-1 20s ease-in-out infinite; }-->
<!--    .wave-2 { width: 900px; height: 900px; bottom: -30%; right: -20%; animation: wave-move-2 25s cubic-bezier(0.36, 0.45, 0.63, 0.53) -10s infinite, change-color-2 20s ease-in-out -5s infinite; }-->
<!--    .wave-3 { width: 700px; height: 700px; bottom: 5%; left: -10%; animation: wave-move-3 20s cubic-bezier(0.36, 0.45, 0.63, 0.53) -5s infinite, change-color-3 20s ease-in-out -15s infinite; }-->

<!--    .light-theme #dynamic-background { opacity: 0; }-->

<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    /* Splash Screen & Animations     */-->
<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    #splash { background-color: var(&#45;&#45;splash-bg); transition: background-color 0.5s ease; }-->
<!--    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; visibility: hidden; } }-->
<!--    .animate-fade-out { animation: fadeOut 1.5s ease-in-out forwards; }-->

<!--    /* Modified splash-image keyframes for glow and appearance */-->
<!--    @keyframes splash-image-appear {-->
<!--        0% {-->
<!--            opacity: 0;-->
<!--            transform: scale(0.5);-->
<!--            box-shadow: 0 0 5px 2px rgba(255, 193, 7, 0.2), 0 0 10px 4px rgba(255, 193, 7, 0.1); /* Initial subtle yellow glow */-->
<!--        }-->
<!--        50% {-->
<!--            opacity: 0.7;-->
<!--            transform: scale(0.85);-->
<!--            box-shadow: 0 0 30px 10px rgba(255, 193, 7, 0.6), 0 0 60px 20px rgba(255, 193, 7, 0.3); /* Growing yellow aura */-->
<!--        }-->
<!--        100% {-->
<!--            opacity: 1;-->
<!--            transform: scale(1);-->
<!--            box-shadow: 0 0 60px 25px rgba(255, 193, 7, 0.9), 0 0 120px 50px rgba(255, 193, 7, 0.5); /* Full, bright yellow aura */-->
<!--        }-->
<!--    }-->
<!--    .splash-image-style {-->
<!--        border-radius: 50%; /* Make it circular */-->
<!--        object-fit: cover; /* Ensure image covers the circle */-->
<!--        border: 8px solid #FFC107; /* Yellow border for the guru image */-->
<!--        animation: splash-image-appear 1.5s forwards ease-out; /* Apply glow and appearance animation */-->
<!--        animation-delay: 0.2s; /* Delay for a smoother start */-->
<!--        /* Increased size for the guru image */-->
<!--        width: 250px; /* Adjust as needed */-->
<!--        height: 250px; /* Keep height equal to width for perfect circle */-->
<!--        max-width: 80vw; /* Ensure responsiveness */-->
<!--        max-height: 80vw; /* Ensure responsiveness */-->
<!--    }-->

<!--    @keyframes splash-text { 0% { opacity: 0; transform: translateY(20px); } 30%, 70% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-10px); } }-->
<!--    .animate-splash-text { animation: splash-text 1.5s ease-in-out forwards; /* Reduced animation time */ }-->

<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    /* Polished Glass Container       */-->
<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    .glass-container {-->
<!--      background: var(&#45;&#45;glass-bg);-->
<!--      backdrop-filter: blur(50px) saturate(180%);-->
<!--      border: 1px solid var(&#45;&#45;glass-border);-->
<!--      box-shadow: 0 15px 35px rgba(0,0,0,0.3), inset 0 0 0 1.5px rgba(255, 255, 255, 0.05);-->
<!--      transition: background-color 0.5s ease, border 0.5s ease, max-width 0.3s ease; /* Add max-width transition */-->
<!--      max-width: var(&#45;&#45;chat-max-width); /* Controlled by JS zoom */-->
<!--      max-height: 95vh; /* Limit height of the entire chat window */-->
<!--      overflow-y: auto; /* Make the entire glass container scrollable */-->
<!--    }-->

<!--    /* Scrollbar styles for the main chat window */-->
<!--    .glass-container::-webkit-scrollbar { width: 6px; }-->
<!--    .glass-container::-webkit-scrollbar-track { background: transparent; }-->
<!--    .glass-container::-webkit-scrollbar-thumb { background-color: var(&#45;&#45;scroll-thumb-bg); border-radius: 3px; }-->
<!--    .glass-container::-webkit-scrollbar-thumb:hover { background-color: rgba(148, 163, 184, 0.5); }-->


<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    /* Chat/Form Interaction Styles   */-->
<!--    /* &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--    /* Base for all message/form bubbles */-->
<!--    .interaction-bubble {-->
<!--        border-radius: 1.5rem;-->
<!--        padding: 1.5rem;-->
<!--        margin-bottom: 1.5rem; /* Space between bubbles */-->
<!--        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);-->
<!--        border: 1px solid rgba(255, 255, 255, 0.05);-->
<!--        opacity: 0;-->
<!--        transform: translateY(20px);-->
<!--        transition: all 0.5s ease-in-out;-->
<!--        max-width: 100%; /* Ensure it fits in container */-->
<!--    }-->

<!--    /* Animation for bubbles appearing */-->
<!--    .interaction-bubble.active {-->
<!--        opacity: 1;-->
<!--        transform: translateY(0);-->
<!--        pointer-events: auto; /* Enable interaction for active forms */-->
<!--    }-->

<!--    /* Bot message specific styling */-->
<!--    .bot-message {-->
<!--        background: var(&#45;&#45;bot-message-bg);-->
<!--        color: var(&#45;&#45;text-color-primary);-->
<!--        align-self: flex-start; /* Align to the left */-->
<!--        border-bottom-left-radius: 0.5rem; /* Smoother corner on one side */-->
<!--        display: flex; /* Make it a flex container */-->
<!--        align-items: flex-start; /* Align icon and text at the top */-->
<!--        padding: 1rem 1.5rem; /* Adjust padding for icon */-->
<!--    }-->
<!--    .bot-message .bot-avatar {-->
<!--        width: 7.5rem; /* w-10 */-->
<!--        height: 7.5rem; /* h-10 */-->
<!--        border-radius: 50%; /* rounded-full */-->
<!--        object-fit: cover;-->
<!--        margin-right: 0.75rem; /* mr-3 */-->
<!--        flex-shrink: 0; /* Prevent avatar from shrinking */-->
<!--        border: 2px solid var(&#45;&#45;form-button-bg); /* Small border for bot avatar */-->
<!--    }-->
<!--    .bot-message .bot-text-content {-->
<!--        flex-grow: 1; /* Allow text content to take remaining space */-->
<!--    }-->

<!--    /* User input form specific styling */-->
<!--    .user-input-form {-->
<!--        background: var(&#45;&#45;user-input-bg);-->
<!--        color: white; /* User input forms have white text */-->
<!--        align-self: flex-end; /* Align to the right */-->
<!--        border-bottom-right-radius: 0.5rem; /* Smoother corner on one side */-->
<!--        pointer-events: none; /* Disabled until active */-->
<!--    }-->

<!--    .user-input-form h2 {-->
<!--        font-size: 1.5em; /* text-2xl relative to parent font-size */-->
<!--        font-weight: 600; /* font-semibold */-->
<!--        margin-bottom: 1rem;-->
<!--        color: white; /* Always white for user input forms */-->
<!--    }-->
<!--    .user-input-form p {-->
<!--        font-size: 1em; /* text-base relative */-->
<!--        color: rgba(255, 255, 255, 0.9);-->
<!--        margin-bottom: 1.5rem;-->
<!--    }-->
<!--    .user-input-form label {-->
<!--        display: block;-->
<!--        margin-bottom: 0.5rem;-->
<!--        font-weight: 500;-->
<!--        color: white; /* Always white for labels in user forms */-->
<!--    }-->
<!--    .user-input-form input[type="text"],-->
<!--    .user-input-form input[type="tel"],-->
<!--    .user-input-form input[type="number"], /* Added for age */-->
<!--    .user-input-form select,-->
<!--    .user-input-form textarea { /* Added textarea */-->
<!--        width: 100%;-->
<!--        padding: 0.75rem 1rem;-->
<!--        border-radius: 0.75rem; /* rounded-xl */-->
<!--        background-color: rgba(255, 255, 255, 0.2); /* Semi-transparent white background for input fields */-->
<!--        border: 1px solid rgba(255, 255, 255, 0.4);-->
<!--        color: white;-->
<!--        font-size: 1em; /* Relative to parent */-->
<!--        transition: border-color 0.3s ease, box-shadow 0.3s ease;-->
<!--    }-->
<!--    .user-input-form input:focus,-->
<!--    .user-input-form select:focus,-->
<!--    .user-input-form textarea:focus { /* Added textarea */-->
<!--        outline: none;-->
<!--        border-color: white;-->
<!--        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);-->
<!--    }-->
<!--    .user-input-form input::placeholder,-->
<!--    .user-input-form textarea::placeholder { /* Added textarea */-->
<!--        color: rgba(255, 255, 255, 0.7);-->
<!--    }-->
<!--    .user-input-form select option {-->
<!--        background-color: var(&#45;&#45;form-button-bg); /* Match user form background for dropdown options */-->
<!--        color: white;-->
<!--    }-->

<!--    .form-field-group {-->
<!--        margin-bottom: 1.5rem;-->
<!--    }-->
<!--    .form-field-group .error-message {-->
<!--        color: var(&#45;&#45;error-color);-->
<!--        font-size: 0.875em; /* text-sm relative */-->
<!--        margin-top: 0.5rem;-->
<!--        height: 1.25rem; /* Reserve space to prevent layout shift */-->
<!--    }-->

<!--    .form-button {-->
<!--        background-color: white; /* White button on user forms */-->
<!--        color: var(&#45;&#45;form-button-bg); /* Text color is primary blue */-->
<!--        padding: 0.75rem 2rem;-->
<!--        border-radius: 9999px; /* rounded-full */-->
<!--        font-weight: 600; /* font-semibold */-->
<!--        transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;-->
<!--        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Darker shadow for white button */-->
<!--    }-->
<!--    .form-button:hover {-->
<!--        background-color: rgba(255, 255, 255, 0.9);-->
<!--        transform: translateY(-2px);-->
<!--        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);-->
<!--    }-->
<!--    .form-button:active {-->
<!--        transform: translateY(0);-->
<!--        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);-->
<!--    }-->

<!--    /* Theme and Zoom buttons */-->
<!--    .theme-button {-->
<!--      background-color: var(&#45;&#45;settings-highlight-bg);-->
<!--      border: 1px solid var(&#45;&#45;glass-border);-->
<!--      color: var(&#45;&#45;text-color-primary);-->
<!--      padding: 0.5rem 0.75rem;-->
<!--      border-radius: 9999px;-->
<!--      cursor: pointer;-->
<!--      display: flex;-->
<!--      align-items: center;-->
<!--      gap: 0.5rem;-->
<!--      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;-->
<!--    }-->
<!--    .theme-button:hover {-->
<!--        background-color: var(&#45;&#45;glass-border);-->
<!--    }-->


<!--    /* Radio button styling for user forms */-->
<!--    .user-input-form .radio-option {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        margin-bottom: 0.75rem; /* Slightly less margin for radio options */-->
<!--        cursor: pointer;-->
<!--    }-->
<!--    .user-input-form .radio-option input[type="radio"] {-->
<!--        -webkit-appearance: none;-->
<!--        -moz-appearance: none;-->
<!--        appearance: none;-->
<!--        width: 1.25em; /* Smaller radio button relative to font size */-->
<!--        height: 1.25em;-->
<!--        border-radius: 50%;-->
<!--        border: 2px solid rgba(255, 255, 255, 0.7);-->
<!--        background-color: transparent;-->
<!--        margin-right: 0.75rem;-->
<!--        position: relative;-->
<!--        cursor: pointer;-->
<!--        transition: border-color 0.2s ease, background-color 0.2s ease;-->
<!--    }-->
<!--    .user-input-form .radio-option input[type="radio"]:checked {-->
<!--        border-color: white;-->
<!--        background-color: white;-->
<!--    }-->
<!--    .user-input-form .radio-option input[type="radio"]:checked::before {-->
<!--        content: '';-->
<!--        display: block;-->
<!--        width: 0.6em; /* Smaller dot relative to font size */-->
<!--        height: 0.6em;-->
<!--        background-color: var(&#45;&#45;form-button-bg); /* Blue dot inside white radio */-->
<!--        border-radius: 50%;-->
<!--        position: absolute;-->
<!--        top: 50%;-->
<!--        left: 50%;-->
<!--        transform: translate(-50%, -50%);-->
<!--    }-->
<!--    .user-input-form .radio-option label {-->
<!--        color: white;-->
<!--        font-size: 1em; /* Smaller label text relative */-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    /* Custom Checkbox styling (Tick Box) - IMPROVED */-->
<!--    .user-input-form .checkbox-option input[type="checkbox"] {-->
<!--        -webkit-appearance: none;-->
<!--        -moz-appearance: none;-->
<!--        appearance: none;-->
<!--        width: 1.5em; /* Slightly larger relative */-->
<!--        height: 1.5em; /* Slightly larger relative */-->
<!--        border-radius: 0.375em; /* rounded-md relative */-->
<!--        border: 3px solid rgba(255, 255, 255, 0.8); /* Bolder border */-->
<!--        background-color: transparent;-->
<!--        margin-right: 0.75rem;-->
<!--        position: relative;-->
<!--        cursor: pointer;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        transition: all 0.2s ease; /* Smooth transition for all properties */-->
<!--    }-->
<!--    .user-input-form .checkbox-option input[type="checkbox"]:hover {-->
<!--        border-color: white; /* Highlight border on hover */-->
<!--        box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2); /* Soft glow on hover */-->
<!--    }-->
<!--    .user-input-form .checkbox-option input[type="checkbox"]:checked {-->
<!--        border-color: var(&#45;&#45;form-button-bg); /* Blue border when checked */-->
<!--        background-color: var(&#45;&#45;form-button-bg); /* Blue background when checked */-->
<!--        box-shadow: 0 0 0 2px var(&#45;&#45;form-button-bg), 0 0 0 5px rgba(0, 123, 255, 0.4); /* Stronger blue outer glow */-->
<!--    }-->
<!--    .user-input-form .checkbox-option input[type="checkbox"]::after {-->
<!--        /* Using SVG for reliable checkmark icon */-->
<!--        content: ''; /* Must be present for ::after to render */-->
<!--        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M9.707 16.707a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L9 14.586l6.293-6.293a1 1 0 0 1 1.414 1.414l-7 7a1 1 0 0 1-.001.001z'/%3E%3C/svg%3E");-->
<!--        background-size: 80%; /* Adjust size of the SVG tick */-->
<!--        background-position: center;-->
<!--        background-repeat: no-repeat;-->
<!--        position: absolute;-->
<!--        width: 100%; /* Take full space of the checkbox */-->
<!--        height: 100%; /* Take full space of the checkbox */-->
<!--        top: 0; left: 0; /* Position correctly */-->
<!--        transform: scale(0); /* Initially hidden */-->
<!--        opacity: 0;-->
<!--        transition: transform 0.2s ease-out, opacity 0.2s ease-out;-->
<!--    }-->
<!--    .user-input-form .checkbox-option input[type="checkbox"]:checked::after {-->
<!--        transform: scale(1); /* Pop in effect */-->
<!--        opacity: 1;-->
<!--    }-->
<!--    .user-input-form .checkbox-option label {-->
<!--        color: white;-->
<!--        font-size: 1em;-->
<!--        cursor: pointer;-->
<!--    }-->


<!--    /* Timetable styles */-->
<!--    .timetable-entry {-->
<!--        background-color: rgba(255, 255, 255, 0.1);-->
<!--        border-radius: 0.75rem;-->
<!--        padding: 1rem;-->
<!--        margin-top: 1rem;-->
<!--        border: 1px solid rgba(255, 255, 255, 0.05);-->
<!--    }-->
<!--    .timetable-entry h3 {-->
<!--        font-size: 1.25em; /* Relative */-->
<!--        font-weight: 600;-->
<!--        margin-bottom: 0.75rem;-->
<!--        color: white;-->
<!--    }-->

<!--    /* Final greeting section */-->
<!--    .final-greeting {-->
<!--        padding: 3rem 2rem;-->
<!--        background: linear-gradient(135deg, var(&#45;&#45;form-button-bg), var(&#45;&#45;form-button-hover));-->
<!--        color: white;-->
<!--        text-align: center;-->
<!--        border-radius: 1.5rem;-->
<!--        box-shadow: 0 10px 25px rgba(0, 123, 255, 0.5);-->
<!--        opacity: 0;-->
<!--        transform: translateY(30px);-->
<!--        transition: all 0.8s ease-out;-->
<!--        margin-top: 1.5rem; /* Space from last message/form */-->
<!--        align-self: center; /* Center the final greeting */-->
<!--    }-->
<!--    .final-greeting.active {-->
<!--        opacity: 1;-->
<!--        transform: translateY(0);-->
<!--    }-->
<!--    .final-greeting h2 {-->
<!--        font-size: 2.5em; /* Relative */-->
<!--        font-weight: 800; /* font-extrabold */-->
<!--        margin-bottom: 1rem;-->
<!--    }-->
<!--    .final-greeting p {-->
<!--        font-size: 1.25em; /* Relative */-->
<!--        line-height: 1.6;-->
<!--    }-->

<!--    /* Dynamic member list styling */-->
<!--    .member-entry-dynamic {-->
<!--        background-color: rgba(255, 255, 255, 0.1);-->
<!--        border-radius: 0.75rem;-->
<!--        padding: 1rem;-->
<!--        margin-bottom: 1rem;-->
<!--        border: 1px solid rgba(255, 255, 255, 0.05);-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        gap: 0.75rem;-->
<!--    }-->
<!--    .member-entry-dynamic .delete-member-button {-->
<!--        background-color: var(&#45;&#45;error-color);-->
<!--        color: white;-->
<!--        padding: 0.5rem 1rem;-->
<!--        border-radius: 0.5rem;-->
<!--        font-size: 0.875em; /* Relative */-->
<!--        align-self: flex-end;-->
<!--        transition: background-color 0.2s ease;-->
<!--    }-->
<!--    .member-entry-dynamic .delete-member-button:hover {-->
<!--        background-color: #dc2626;-->
<!--    }-->


<!--    /* Scrolling container for messages/forms */-->
<!--    /* This section is removed from interaction-window as glass-container now handles scroll */-->
<!--    #interaction-window {-->
<!--        flex-grow: 1; /* Allow it to grow and take available space */-->
<!--        padding: 1rem; /* Padding for the scrollable area */-->
<!--        display: flex;-->
<!--        flex-direction: column; /* Stack elements vertically */-->
<!--        align-items: flex-start; /* Default alignment for messages/forms */-->
<!--        /* scroll-behavior: smooth; -> Removed, handled by parent glass-container */-->
<!--        /* overflow-y: auto; -> Removed, handled by parent glass-container */-->
<!--    }-->


<!--    /* Custom Time Input Styling */-->
<!--    .custom-time-input-group {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 0.5rem;-->
<!--        width: 100%;-->
<!--    }-->
<!--    .custom-time-input-group input[type="number"] {-->
<!--        flex: 1; /* Allows hour/minute inputs to grow */-->
<!--        max-width: 80px; /* Constrain width */-->
<!--        text-align: center;-->
<!--        -moz-appearance: textfield; /* Hide arrows for Firefox */-->
<!--    }-->
<!--    .custom-time-input-group input[type="number"]::-webkit-outer-spin-button,-->
<!--    .custom-time-input-group input[type="number"]::-webkit-inner-spin-button {-->
<!--        -webkit-appearance: none;-->
<!--        margin: 0;-->
<!--    }-->
<!--    .custom-time-input-group select {-->
<!--        width: auto; /* Allow AM/PM dropdown to size content */-->
<!--        min-width: 60px;-->
<!--    }-->

<!--    /* All Good/Success Message Bubble */-->
<!--    @keyframes sparkle-text-pop {-->
<!--        0% { transform: scale(0.8); opacity: 0; }-->
<!--        50% { transform: scale(1.1); opacity: 1; }-->
<!--        100% { transform: scale(1); opacity: 1; }-->
<!--    }-->

<!--    /* Full-screen Success Animation */-->
<!--    #full-screen-success {-->
<!--        background: linear-gradient(45deg, var(&#45;&#45;success-color), #34d399); /* Green gradient */-->
<!--        z-index: 9999; /* Ensure it's on top */-->
<!--    }-->

<!--    #full-screen-success i {-->
<!--        animation: tick-pop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;-->
<!--        transform: scale(0);-->
<!--    }-->

<!--    #full-screen-success p {-->
<!--        animation: text-fade-in 0.8s ease-out forwards;-->
<!--        animation-delay: 0.3s; /* Delay text appearance slightly */-->
<!--        opacity: 0;-->
<!--        transform: translateY(20px);-->
<!--    }-->

<!--    @keyframes tick-pop {-->
<!--        0% { transform: scale(0); opacity: 0; }-->
<!--        50% { transform: scale(1.2); opacity: 1; }-->
<!--        100% { transform: scale(1); opacity: 1; }-->
<!--    }-->

<!--    @keyframes text-fade-in {-->
<!--        0% { opacity: 0; transform: translateY(20px); }-->
<!--        100% { opacity: 1; transform: translateY(0); }-->
<!--    }-->

<!--    /* Summary Specific Styling */-->
<!--    .summary-section {-->
<!--        background-color: rgba(255, 255, 255, 0.1);-->
<!--        border-radius: 0.75rem;-->
<!--        padding: 1.5rem;-->
<!--        margin-bottom: 1.5rem;-->
<!--        border: 1px solid rgba(255, 255, 255, 0.05);-->
<!--    }-->

<!--    .summary-section h3 {-->
<!--        font-size: 1.25em; /* relative to parent font-size */-->
<!--        font-weight: 600;-->
<!--        margin-bottom: 1rem;-->
<!--        color: var(&#45;&#45;text-color-primary);-->
<!--    }-->

<!--    .summary-section p, .summary-section ul li {-->
<!--        font-size: 0.95em; /* slightly smaller relative to parent */-->
<!--        line-height: 1.5;-->
<!--        margin-bottom: 0.5rem;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 0.5rem;-->
<!--    }-->

<!--    .summary-section p strong, .summary-section ul li strong {-->
<!--        color: var(&#45;&#45;text-color-secondary);-->
<!--        min-width: 100px; /* Align labels */-->
<!--    }-->
<!--    .summary-section p span, .summary-section ul li span {-->
<!--        color: var(&#45;&#45;text-color-primary);-->
<!--    }-->

<!--    .summary-attendee-card {-->
<!--        background-color: rgba(255, 255, 255, 0.07);-->
<!--        border-radius: 1rem;-->
<!--        padding: 1.5rem;-->
<!--        border: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);-->
<!--    }-->

<!--    .summary-attendee-card h4 {-->
<!--        font-size: 1.15em; /* relative */-->
<!--        font-weight: 700;-->
<!--        margin-bottom: 1.25rem;-->
<!--        color: black; /* Highlight attendee name */-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--    }-->
<!--    .summary-attendee-card h5 {-->
<!--        font-size: 1em; /* relative */-->
<!--        font-weight: 600;-->
<!--        margin-top: 1.5rem;-->
<!--        margin-bottom: 0.75rem;-->
<!--        color: var(&#45;&#45;text-color-primary);-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--    }-->
<!--    .summary-attendee-card .grid div {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 0.5rem;-->
<!--    }-->
<!--    .summary-attendee-card .grid div strong {-->
<!--        min-width: 80px; /* Align labels within grid */-->
<!--        color: var(&#45;&#45;text-color-secondary);-->
<!--    }-->

<!--    .summary-attendee-card ul.list-none {-->
<!--        padding-left: 0;-->
<!--    }-->
<!--    .summary-attendee-card ul.list-none li {-->
<!--        margin-left: 0;-->
<!--        padding-left: 1rem;-->
<!--        border-left: 2px solid rgba(255,255,255,0.1); /* Subtle separator */-->
<!--    }-->

<!--    /* Ticket Confirmation Styles */-->
<!--    .ticket-confirmation-card {-->
<!--        position: relative;-->
<!--        background: linear-gradient(135deg, #1A202C, #2D3748); /* Dark gradient background */-->
<!--        color: white;-->
<!--        border-radius: 1.5rem;-->
<!--        padding: 2.5rem; /* Increased padding */-->
<!--        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6); /* More prominent shadow */-->
<!--        overflow: hidden; /* Crucial for pseudo-element clipping */-->
<!--        margin-top: 2rem;-->
<!--        text-align: center;-->
<!--        opacity: 0;-->
<!--        transform: translateY(50px) scale(0.9);-->
<!--        animation: ticket-appear 0.8s ease-out forwards;-->
<!--        border: 2px solid rgba(255, 255, 255, 0.2); /* Slight border */-->
<!--        width: 100%; /* Ensure it takes full width of parent */-->
<!--        max-width: 500px; /* Max width for a ticket-like appearance */-->
<!--        align-self: center; /* Center horizontally in flex column */-->
<!--        font-size: 0.9em; /* slightly smaller base font for density */-->
<!--    }-->

<!--    @keyframes ticket-appear {-->
<!--        0% { opacity: 0; transform: translateY(50px) scale(0.9); }-->
<!--        80% { opacity: 1; transform: translateY(-5px) scale(1.02); }-->
<!--        100% { opacity: 1; transform: translateY(0) scale(1); }-->
<!--    }-->

<!--    /* Torn edge effect */-->
<!--    .ticket-confirmation-card::before,-->
<!--    .ticket-confirmation-card::after {-->
<!--        content: '';-->
<!--        position: absolute;-->
<!--        left: 0;-->
<!--        right: 0;-->
<!--        height: 20px; /* Height of the perforation area */-->
<!--        background-size: 20px 20px; /* Size of each perforation circle */-->
<!--        background-repeat: repeat-x;-->
<!--        z-index: 1;-->
<!--    }-->

<!--    .ticket-confirmation-card::before {-->
<!--        top: 6rem; /* Position the top tear line */-->
<!--        background-image: radial-gradient(circle at 10px 10px, transparent 9px, white 10px);-->
<!--        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.1), 0 2px 5px rgba(0,0,0,0.4);-->
<!--    }-->

<!--    .ticket-confirmation-card::after {-->
<!--        bottom: 6rem; /* Position the bottom tear line */-->
<!--        background-image: radial-gradient(circle at 10px 0, transparent 9px, white 10px);-->
<!--        box-shadow: inset 0 -1px 0 rgba(255, 255, 255, 0.1), inset 0 1px 0 rgba(0, 0, 0, 0.1), 0 -2px 5px rgba(0,0,0,0.4);-->
<!--    }-->

<!--    .ticket-header, .ticket-footer {-->
<!--        text-align: center;-->
<!--        position: relative; /* To be above perforations */-->
<!--        z-index: 2;-->
<!--    }-->

<!--    .ticket-header {-->
<!--        margin-bottom: 2rem;-->
<!--    }-->

<!--    .ticket-header h2 {-->
<!--        font-size: 2em; /* Larger title */-->
<!--        font-weight: 800;-->
<!--        text-shadow: 0 2px 5px rgba(0,0,0,0.5);-->
<!--        color: #FFD700; /* Gold-like color */-->
<!--        margin-bottom: 0.5rem;-->
<!--    }-->

<!--    .ticket-header p {-->
<!--        font-size: 1.1em;-->
<!--        font-weight: 500;-->
<!--        color: rgba(255, 255, 255, 0.9);-->
<!--        margin-bottom: 1rem;-->
<!--    }-->

<!--    .registration-id {-->
<!--        font-family: 'monospace', sans-serif; /* Monospace for ID */-->
<!--        font-size: 2.2em; /* Very large for ID */-->
<!--        font-weight: 700;-->
<!--        letter-spacing: 2px;-->
<!--        background: linear-gradient(45deg, #00C6FF, #0072FF); /* Blue gradient for ID */-->
<!--        -webkit-background-clip: text;-->
<!--        -webkit-text-fill-color: transparent;-->
<!--        margin-top: 1.5rem;-->
<!--        padding: 0.5rem 1rem;-->
<!--        border: 1px dashed rgba(255, 255, 255, 0.3);-->
<!--        border-radius: 0.5rem;-->
<!--        display: inline-block;-->
<!--        box-shadow: 0 0 15px rgba(0, 114, 255, 0.6);-->
<!--        transition: all 0.3s ease-in-out;-->
<!--    }-->
<!--    .registration-id:hover {-->
<!--        transform: scale(1.05);-->
<!--        box-shadow: 0 0 25px rgba(0, 114, 255, 0.8);-->
<!--    }-->

<!--    /* Removed QR code styles */-->

<!--    .ticket-details {-->
<!--        text-align: left;-->
<!--        margin-top: 2rem;-->
<!--        padding-top: 1rem;-->
<!--        border-top: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        position: relative;-->
<!--        z-index: 2;-->
<!--    }-->

<!--    .ticket-details h4 {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        margin-bottom: 1rem;-->
<!--        color: #FFD700;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 0.5rem;-->
<!--    }-->

<!--    .ticket-details p, .ticket-details li {-->
<!--        font-size: 0.9em;-->
<!--        margin-bottom: 0.75rem;-->
<!--        line-height: 1.4;-->
<!--        display: flex;-->
<!--        align-items: flex-start; /* Align text start with icon */-->
<!--        gap: 0.5rem;-->
<!--    }-->
<!--    .ticket-details p strong, .ticket-details li strong {-->
<!--        color: rgba(255, 255, 255, 0.7);-->
<!--        /* Removed min-width to allow better responsiveness on small screens */-->
<!--        flex-shrink: 0;-->
<!--    }-->
<!--    .ticket-details ul {-->
<!--        list-style: none;-->
<!--        padding-left: 0;-->
<!--        margin-top: 0.5rem;-->
<!--        margin-bottom: 1rem;-->
<!--    }-->
<!--    .ticket-details ul li {-->
<!--        margin-bottom: 0.5rem;-->
<!--        padding-left: 1rem;-->
<!--        position: relative;-->
<!--    }-->
<!--    .ticket-details ul li::before {-->
<!--        content: '\2022'; /* Bullet point */-->
<!--        color: #FFD700;-->
<!--        position: absolute;-->
<!--        left: 0;-->
<!--        top: 0;-->
<!--    }-->

<!--    .ticket-footer {-->
<!--        margin-top: 2rem;-->
<!--        font-size: 0.85em;-->
<!--        color: rgba(255, 255, 255, 0.7);-->
<!--        border-top: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        padding-top: 1rem;-->
<!--        display: flex; /* Use flex for buttons */-->
<!--        justify-content: center; /* Center buttons */-->
<!--        gap: 1rem;-->
<!--        flex-wrap: wrap; /* Allow wrapping on small screens */-->
<!--    }-->
<!--    .ticket-footer .form-button {-->
<!--        background-color: #4CAF50; /* Green button for positive action */-->
<!--        color: white;-->
<!--        box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);-->
<!--        margin-top: 1.5rem;-->
<!--    }-->
<!--    .ticket-footer .form-button:hover {-->
<!--        background-color: #45a049;-->
<!--    }-->

<!--    /* Modal for delete confirmation */-->
<!--    .modal-overlay {-->
<!--        position: fixed;-->
<!--        inset: 0;-->
<!--        background-color: rgba(0, 0, 0, 0.7);-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        z-index: 10000;-->
<!--        opacity: 0;-->
<!--        transition: opacity 0.3s ease;-->
<!--    }-->
<!--    .modal-overlay.active {-->
<!--        opacity: 1;-->
<!--    }-->
<!--    .modal-content {-->
<!--        background: linear-gradient(135deg, #1A202C, #2D3748);-->
<!--        border-radius: 1rem;-->
<!--        padding: 2rem;-->
<!--        color: white;-->
<!--        text-align: center;-->
<!--        width: 90%;-->
<!--        max-width: 400px;-->
<!--        box-shadow: 0 10px 20px rgba(0,0,0,0.5);-->
<!--        transform: scale(0.9);-->
<!--        transition: transform 0.3s ease;-->
<!--    }-->
<!--    .modal-overlay.active .modal-content {-->
<!--        transform: scale(1);-->
<!--    }-->
<!--    .modal-content h3 {-->
<!--        font-size: 1.5em;-->
<!--        font-weight: 600;-->
<!--        margin-bottom: 1rem;-->
<!--    }-->
<!--    .modal-content p {-->
<!--        margin-bottom: 1.5rem;-->
<!--        color: rgba(255, 255, 255, 0.8);-->
<!--    }-->
<!--    .modal-actions {-->
<!--        display: flex;-->
<!--        justify-content: center;-->
<!--        gap: 1rem;-->
<!--    }-->
<!--    .modal-actions .form-button {-->
<!--        margin-top: 0; /* Override default button margin */-->
<!--        padding: 0.6rem 1.5rem;-->
<!--    }-->

<!--    /* Styles for fixed bottom buttons */-->
<!--    #global-actions {-->
<!--        position: fixed;-->
<!--        bottom: 0;-->
<!--        left: 0;-->
<!--        right: 0;-->
<!--        padding: 1rem;-->
<!--        z-index: 20; /* Ensure it's above other content but below modals */-->
<!--        display: flex;-->
<!--        justify-content: center;-->
<!--        gap: 1rem;-->
<!--        background: rgba(0,0,0,0.7); /* Slightly translucent background */-->
<!--        backdrop-filter: blur(5px);-->
<!--        border-top: 1px solid rgba(255,255,255,0.1);-->
<!--    }-->
<!--    #global-actions .action-button {-->
<!--        background-color: var(&#45;&#45;form-button-bg);-->
<!--        color: white;-->
<!--        padding: 0.75rem 1.5rem;-->
<!--        border-radius: 9999px; /* pill shape */-->
<!--        font-weight: 600;-->
<!--        transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;-->
<!--        display: flex; /* For icon and text alignment */-->
<!--        align-items: center;-->
<!--        gap: 0.5rem;-->
<!--    }-->
<!--    #global-actions .action-button:hover {-->
<!--        background-color: var(&#45;&#45;form-button-hover);-->
<!--        transform: translateY(-2px);-->
<!--        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);-->
<!--    }-->
<!--    #global-actions .action-button:active {-->
<!--        transform: translateY(0);-->
<!--        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);-->
<!--    }-->

<!--    /* Loading Overlay for PDF */-->
<!--    #pdf-loading-overlay {-->
<!--        position: fixed;-->
<!--        inset: 0;-->
<!--        background-color: rgba(0, 0, 0, 0.7);-->
<!--        display: none; /* Hidden by default */-->
<!--        flex-direction: column;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        z-index: 10001;-->
<!--        color: white;-->
<!--        font-size: 1.5em;-->
<!--        gap: 1rem;-->
<!--    }-->
<!--    #pdf-loading-overlay.active {-->
<!--        display: flex;-->
<!--    }-->
<!--    .spinner {-->
<!--        border: 4px solid rgba(255, 255, 255, 0.3);-->
<!--        border-top: 4px solid #fff;-->
<!--        border-radius: 50%;-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        animation: spin 1s linear infinite;-->
<!--    }-->
<!--    @keyframes spin {-->
<!--        0% { transform: rotate(0deg); }-->
<!--        100% { transform: rotate(360deg); }-->
<!--    }-->
<!--  </style>-->
<!--</head>-->

<!--<body class="text-slate-200">-->

<!--  <div id="dynamic-background">-->
<!--    <div class="wave wave-1"></div>-->
<!--    <div class="wave wave-2"></div>-->
<!--    <div class="wave wave-3"></div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Splash Screen &ndash;&gt;-->
<!--  <div id="splash" class="fixed inset-0 z-50 flex flex-col items-center justify-center backdrop-blur-sm">-->
<!--    <img id="splash-image" src="https://placehold.co/250x250/FFC107/000000?text=Guru+Logo" alt="Gurukul Utsav Logo" class="hidden w-40 h-40 md:w-56 md:h-56 object-contain mb-8 shadow-2xl splash-image-style">-->
<!--    <h1 id="splash-text" class="hidden text-white text-3xl sm:text-4xl md:text-5xl font-bold tracking-wide text-center px-4">-->
<!--      Gurukul Utsav Registration-->
<!--    </h1>-->
<!--  </div>-->

<!--  &lt;!&ndash; Full-screen Success Animation Overlay &ndash;&gt;-->
<!--  <div id="full-screen-success" class="fixed inset-0 flex flex-col items-center justify-center hidden opacity-0 transition-opacity duration-500">-->
<!--      <i class="fas fa-check-circle text-white text-9xl"></i>-->
<!--      <p class="text-white text-3xl font-bold mt-8">Registration Successful</p>-->
<!--  </div>-->


<!--  &lt;!&ndash; Custom Confirmation Modal (Shared styling) &ndash;&gt;-->
<!--  <div id="confirmation-modal" class="modal-overlay hidden">-->
<!--      <div class="modal-content">-->
<!--          <h3 id="modal-title"></h3>-->
<!--          <p id="modal-message"></p>-->
<!--          <div class="modal-actions">-->
<!--              <button id="modal-confirm-btn" class="form-button"></button>-->
<!--              <button id="modal-cancel-btn" class="form-button bg-gray-500 hover:bg-gray-600">Cancel</button>-->
<!--          </div>-->
<!--      </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; PDF Loading Overlay &ndash;&gt;-->
<!--  <div id="pdf-loading-overlay">-->
<!--      <div class="spinner"></div>-->
<!--      <p>Generating PDF...</p>-->
<!--  </div>-->


<!--  &lt;!&ndash; main-content now has min-h-screen and will allow glass-container to scroll &ndash;&gt;-->
<!--  <div id="main-content" class="hidden relative z-10 flex items-center justify-center min-h-screen p-2 md:p-4 overflow-hidden">-->
<!--    &lt;!&ndash; glass-container now has max-h-[95vh] and overflow-y-auto &ndash;&gt;-->
<!--    <div class="glass-container flex flex-col w-full rounded-3xl p-6 sm:p-8 pb-20"> &lt;!&ndash; Added pb-20 to make space for fixed footer &ndash;&gt;-->

<!--      <div class="flex items-center justify-between p-4 border-b border-white/10 flex-wrap gap-2 mb-4">-->
<!--        <h1 class="text-xl md:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300 tracking-wide">-->
<!--          Gurukul Utsav Registration-->
<!--        </h1>-->
<!--        <div class="flex gap-2">-->
<!--            <button id="zoom-out-btn" class="theme-button" aria-label="Zoom Out">-->
<!--                <i class="fas fa-minus"></i>-->
<!--            </button>-->
<!--            <button id="zoom-in-btn" class="theme-button" aria-label="Zoom In">-->
<!--                <i class="fas fa-plus"></i>-->
<!--            </button>-->
<!--            <button id="theme-toggle" class="theme-button" aria-label="Toggle theme">-->
<!--                <i class="fas fa-sun text-yellow-300" id="sun-icon"></i>-->
<!--                <i class="fas fa-moon text-blue-300 hidden" id="moon-icon"></i>-->
<!--                <span id="theme-text" class="hidden sm:inline">Dark Mode</span>-->
<!--            </button>-->
<!--            <a href="/" aria-label="Return to Home Page">-->
<!--                <button class="theme-button">-->
<!--                  Return to Home Page-->
<!--                </button>-->
<!--            </a>-->
<!--        </div>-->
<!--      </div>-->

<!--      &lt;!&ndash; Interaction Window: Content will be dynamically added here. It no longer handles its own overflow. &ndash;&gt;-->
<!--      <div id="interaction-window" class="flex-grow">-->
<!--        &lt;!&ndash; Content will be dynamically added here &ndash;&gt;-->
<!--      </div>-->

<!--      &lt;!&ndash; Final Greeting section (initially hidden, dynamically shown) &ndash;&gt;-->
<!--      <div id="final-greeting-section" class="final-greeting hidden">-->
<!--        <h2 id="final-greeting-title"></h2>-->
<!--        <p id="final-greeting-message"></p>-->
<!--        <p class="mt-4 text-sm opacity-80" id="final-greeting-subtext">Thank you for registering.</p>-->
<!--      </div>-->

<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Global Action Buttons (Fixed Footer) &ndash;&gt;-->
<!--  <div id="global-actions">-->
<!--      <button class="action-button" onclick="initFormFlow()">-->
<!--          <i class="fas fa-home"></i> Start New Registration-->
<!--      </button>-->
<!--      <button class="action-button" onclick="window.location.href='/get-registrations'">-->
<!--        <i class="fas fa-eye"></i> View/Edit Existing-->
<!--      </button>-->
<!--  </div>-->


<!--  <script>-->
<!--    // -&#45;&#45; DOM Elements -&#45;&#45;-->
<!--    const splashScreen = document.getElementById('splash');-->
<!--    const splashImage = document.getElementById('splash-image');-->
<!--    const splashText = document.getElementById('splash-text');-->
<!--    const mainContent = document.getElementById('main-content');-->
<!--    const interactionWindow = document.getElementById('interaction-window');-->
<!--    const finalGreetingSection = document.getElementById('final-greeting-section');-->
<!--    const finalGreetingTitle = document.getElementById('final-greeting-title');-->
<!--    const finalGreetingMessage = document.getElementById('final-greeting-message');-->
<!--    const finalGreetingSubtext = document.getElementById('final-greeting-subtext');-->
<!--    const fullScreenSuccess = document.getElementById('full-screen-success');-->
<!--    const themeToggle = document.getElementById('theme-toggle');-->
<!--    const sunIcon = document.getElementById('sun-icon');-->
<!--    const moonIcon = document.getElementById('moon-icon');-->
<!--    const themeText = document.getElementById('theme-text');-->
<!--    const zoomInBtn = document.getElementById('zoom-in-btn');-->
<!--    const zoomOutBtn = document.getElementById('zoom-out-btn');-->
<!--    const pdfLoadingOverlay = document.getElementById('pdf-loading-overlay');-->


<!--    // Modal elements-->
<!--    const confirmationModal = document.getElementById('confirmation-modal');-->
<!--    const modalTitle = document.getElementById('modal-title');-->
<!--    const modalMessage = document.getElementById('modal-message');-->
<!--    const modalConfirmBtn = document.getElementById('modal-confirm-btn');-->
<!--    const modalCancelBtn = document.getElementById('modal-cancel-btn');-->


<!--    // Bot Avatar Image (Placeholder - User will replace this)-->
<!--    const botAvatarSrc = "static/self-me.png"; // AD for Aditya Paranjape-->

<!--    // -&#45;&#45; Dummy Databases / Data Simulation -&#45;&#45;-->
<!--    // In a real application, this would be on your server.-->
<!--    // This array mimics your DynamoDB 'users' table where registrationId is the PK.-->
<!--    let simulatedDynamoDB = {-->
<!--        'REG-2025-44895150': {-->
<!--            registrationId: 'REG-2025-44895150',-->
<!--            mainRegistrant: { mobile: '+919876543210', firstName: 'Krishna', lastName: 'Das', ref1: '+917000000001', ref2: '+917000000002' },-->
<!--            travelDetails: {-->
<!--                members: [-->
<!--                    {-->
<!--                        firstName: 'Krishna', lastName: 'Das', mobile: '+919876543210', age: 40, gender: 'M',-->
<!--                        modeOfTransport: 'Train', cityOfOrigin: 'Mumbai',-->
<!--                        arrivalDate: '08|07|2025', arrivalTime: '08:00',-->
<!--                        departureDate: '10|07|2025', departureTime: '18:00',-->
<!--                        attendingDates: ['2025-07-08', '2025-07-09', '2025-07-10'], //YYYY-MM-DD format-->
<!--                        morningTeaCoffee: { preference: 'tea', sugar: 'sugar' }, // New field-->
<!--                        mealPreferences: {-->
<!--                            '2025-07-08': { breakfast: false, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'tea', teaCoffeeSugar: 'sugar', packedFood: false },-->
<!--                            '2025-07-09': { breakfast: true, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'coffee', teaCoffeeSugar: 'no-sugar', packedFood: false },-->
<!--                            '2025-07-10': { breakfast: true, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'none', teaCoffeeSugar: 'sugar', packedFood: true }-->
<!--                        },-->
<!--                        stayAtHall: true, cotRequired: true, difficultyClimbingStairs: false,-->
<!--                        localAssistance: 'Sankirtan Prabhu',-->
<!--                        recordingsNeeded: 'Morning Lecture',-->
<!--                        specialRequests: 'Needs hot milk for evening prasadam.'-->
<!--                    },-->
<!--                    {-->
<!--                        firstName: 'Radha', lastName: 'Devi', mobile: '+919876543211', age: 38, gender: 'F',-->
<!--                        modeOfTransport: 'Train', cityOfOrigin: 'Mumbai',-->
<!--                        arrivalDate: '08|07|2025', arrivalTime: '08:00',-->
<!--                        departureDate: '10|07|2025', departureTime: '18:00',-->
<!--                        attendingDates: ['2025-07-08', '2025-07-09', '2025-07-10'], //YYYY-MM-DD format-->
<!--                        morningTeaCoffee: { preference: 'both', sugar: 'sugar' },-->
<!--                        mealPreferences: {-->
<!--                            '2025-07-08': { breakfast: false, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'both', teaCoffeeSugar: 'sugar', packedFood: false },-->
<!--                            '2025-07-09': { breakfast: true, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'tea', teaCoffeeSugar: 'no-sugar', packedFood: false },-->
<!--                            '2025-07-10': { breakfast: true, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'none', teaCoffeeSugar: 'sugar', packedFood: true }-->
<!--                        },-->
<!--                        stayAtHall: true, cotRequired: false, difficultyClimbingStairs: true,-->
<!--                        localAssistance: '',-->
<!--                        recordingsNeeded: '',-->
<!--                        specialRequests: ''-->
<!--                    }-->
<!--                ]-->
<!--            }-->
<!--        },-->
<!--        'REG-2025-ABCD1234': {-->
<!--            registrationId: 'REG-2025-ABCD1234',-->
<!--            mainRegistrant: { mobile: '+919988776655', firstName: 'Radha', lastName: 'Priya', ref1: '+917000000003', ref2: '+917000000001' },-->
<!--            travelDetails: {-->
<!--                members: [-->
<!--                    {-->
<!--                        firstName: 'Radha', lastName: 'Priya', mobile: '+919988776655', age: 30, gender: 'F',-->
<!--                        modeOfTransport: 'Flight', cityOfOrigin: 'Delhi',-->
<!--                        arrivalDate: '09|07|2025', arrivalTime: '10:00',-->
<!--                        departureDate: '11|07|2025', departureTime: '14:00',-->
<!--                        attendingDates: ['2025-07-09', '2025-07-10', '2025-07-11'], //YYYY-MM-DD format-->
<!--                        morningTeaCoffee: { preference: 'coffee', sugar: 'no-sugar' },-->
<!--                        mealPreferences: {-->
<!--                            '2025-07-09': { breakfast: false, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'coffee', teaCoffeeSugar: 'no-sugar', packedFood: false },-->
<!--                            '2025-07-10': { breakfast: true, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'both', teaCoffeeSugar: 'no-sugar', packedFood: false },-->
<!--                            '2025-07-11': { breakfast: true, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'tea', teaCoffeeSugar: 'sugar', packedFood: true }-->
<!--                        },-->
<!--                        stayAtHall: false, cotRequired: false, difficultyClimbingStairs: false,-->
<!--                        localAssistance: 'Bhakti Devi Dasi',-->
<!--                        recordingsNeeded: 'Evening Kirtan, Youth Session',-->
<!--                        specialRequests: 'No spicy food for this attendee.'-->
<!--                    }-->
<!--                ]-->
<!--            }-->
<!--        }-->
<!--    };-->

<!--    // This array acts as a dummy for Sampark Group contacts, used for dropdowns-->
<!--    const dummySamparkGroupContacts = [-->
<!--        { name: 'Suhas Joglekar', mobile: '+917000000001' },-->
<!--        { name: 'Sranjay Karande', mobile: '+917000000002' },-->
<!--        { name: 'Madhavacharya Das', mobile: '+917000000003' }-->
<!--    ];-->

<!--    const dummySamparkGroupContactsForHashMap = [-->
<!--        { name: 'Suhas Joglekar', mobile: '+917000000001' },-->
<!--        { name: 'Sranjay Karande', mobile: '+917000000002' },-->
<!--        { name: 'Madhavacharya Das', mobile: '+917000000003' }-->
<!--    ];-->

<!--    // Create a hashmap for quick lookup of Sampark Group contacts by mobile number-->
<!--    // This is the only new global variable added.-->
<!--    const dummySamparkGroupContactsMap = dummySamparkGroupContactsForHashMap.reduce((map, contact) => {-->
<!--        map[contact.mobile] = contact;-->
<!--        return map;-->
<!--    }, {});-->


<!--    // -&#45;&#45; State Variables -&#45;&#45;-->
<!--    let registrationData = {-->
<!--        mainRegistrant: {-->
<!--            mobile: '',-->
<!--            firstName: '',-->
<!--            lastName: '',-->
<!--            ref1: '',-->
<!--            ref2: ''-->
<!--        },-->
<!--        travelDetails: {-->
<!--            members: [] // Array to hold details for each person, including main registrant-->
<!--        },-->
<!--        registrationId: ''-->
<!--    };-->
<!--    let currentMemberIndex = 0; // To track which member's details we are collecting in the "Do Register" flow-->
<!--    let isEditingExisting = false; // This flag will always be false in index.html-->

<!--    // -&#45;&#45; Theme Logic -&#45;&#45;-->
<!--    let isLightMode = false; // Default to dark mode-->

<!--    function toggleTheme() {-->
<!--        isLightMode = !isLightMode;-->
<!--        if (isLightMode) {-->
<!--            document.body.classList.add('light-theme');-->
<!--            sunIcon.classList.add('hidden');-->
<!--            moonIcon.classList.remove('hidden');-->
<!--            themeText.textContent = 'Light Mode';-->
<!--        } else {-->
<!--            document.body.classList.remove('light-theme');-->
<!--            sunIcon.classList.remove('hidden');-->
<!--            moonIcon.classList.add('hidden');-->
<!--            themeText.textContent = 'Dark Mode';-->
<!--        }-->
<!--        localStorage.setItem('theme', isLightMode ? 'light' : 'dark'); // Save preference-->
<!--    }-->

<!--    // Apply saved theme on load-->
<!--    const savedTheme = localStorage.getItem('theme');-->
<!--    if (savedTheme === 'light') {-->
<!--        isLightMode = false; // Will be true after toggleTheme()-->
<!--        toggleTheme();-->
<!--    } else {-->
<!--        isLightMode = true; // Will be false after toggleTheme()-->
<!--        toggleTheme(); // Set to dark mode initially if no preference or 'dark'-->
<!--    }-->

<!--    themeToggle.addEventListener('click', toggleTheme);-->

<!--    // -&#45;&#45; Zoom Logic -&#45;&#45;-->
<!--    let currentZoomLevel = 1.0; // Initial zoom level-->
<!--    const zoomFactor = 1.25; // 25% increase/decrease-->
<!--    const baseFontSize = 16; // px, corresponds to 1rem-->
<!--    const baseChatMaxWidth = 640; // px, corresponds to Tailwind's max-w-xl-->
<!--    const minZoom = 0.64; // Approx 16px * 0.64 = 10.24px. (1/1.25^2)-->
<!--    const maxZoom = 1.95; // Approx 16px * 1.95 = 31.2px. (1.25^2)-->

<!--    function updateZoom() {-->
<!--        // Set global font size for root rem calculation-->
<!--        document.documentElement.style.setProperty('&#45;&#45;global-font-size', `${baseFontSize * currentZoomLevel}px`);-->
<!--        // Adjust the max-width of the glass container for chat size-->
<!--        document.documentElement.style.setProperty('&#45;&#45;chat-max-width', `${baseChatMaxWidth * currentZoomLevel}px`);-->
<!--    }-->

<!--    zoomInBtn.addEventListener('click', () => {-->
<!--        currentZoomLevel = Math.min(maxZoom, currentZoomLevel * zoomFactor);-->
<!--        updateZoom();-->
<!--    });-->

<!--    zoomOutBtn.addEventListener('click', () => {-->
<!--        currentZoomLevel = Math.max(minZoom, currentZoomLevel / zoomFactor);-->
<!--        updateZoom();-->
<!--    });-->

<!--    // Initialize zoom level on load-->
<!--    updateZoom();-->

<!--    // -&#45;&#45; Splash Screen & Initial Load Logic -&#45;&#45;-->
<!--    window.onload = () => {-->
<!--      splashImage.classList.add('splash-image-style');-->
<!--      splashImage.classList.remove('hidden');-->

<!--      setTimeout(() => {-->
<!--        splashImage.style.display = 'none';-->
<!--        splashText.classList.remove('hidden');-->
<!--        splashText.classList.add('animate-splash-text');-->

<!--        setTimeout(() => {-->
<!--          splashScreen.classList.add('animate-fade-out');-->
<!--          splashScreen.addEventListener('animationend', () => {-->
<!--            splashScreen.remove();-->
<!--            mainContent.classList.remove('hidden');-->
<!--            initFormFlow(); // Start the form flow after splash-->
<!--          }, { once: true });-->
<!--        }, 1500);-->
<!--    }, 2000);-->
<!--    };-->

<!--    /**-->
<!--     * Adds a message or form element to the interaction window.-->
<!--     * @param {string} type - 'bot-message' or 'user-input-form'.-->
<!--     * @param {string} contentHtml - HTML string for the content.-->
<!--     * @param {string} [id] - Optional ID for the element.-->
<!--     * @returns {HTMLElement} The created element.-->
<!--     */-->
<!--    function addInteractionElement(type, contentHtml, id = '') {-->
<!--        const element = document.createElement('div');-->
<!--        element.className = `interaction-bubble ${type}`;-->
<!--        if (id) element.id = id;-->

<!--        if (type === 'bot-message') {-->
<!--            element.innerHTML = `-->
<!--                <img src="${botAvatarSrc}" alt="Bot Avatar" class="bot-avatar">-->
<!--                <div class="bot-text-content">-->
<!--                    ${contentHtml}-->
<!--                </div>-->
<!--            `;-->
<!--        } else {-->
<!--            element.innerHTML = contentHtml;-->
<!--        }-->

<!--        interactionWindow.appendChild(element);-->

<!--        // Use a timeout to trigger CSS transition for smooth appearance-->
<!--        setTimeout(() => {-->
<!--            element.classList.add('active'); // Always make new elements active-->
<!--            scrollToBottom();-->
<!--        }, 50); // Small delay to allow element to be added to DOM before transition-->
<!--        return element;-->
<!--    }-->

<!--    /**-->
<!--     * Shows a full-screen success animation and then hides it.-->
<!--     * @param {function} callback - Function to call after the animation completes.-->
<!--     */-->
<!--    function showFullScreenSuccessAnimation(callback) {-->
<!--        // Hide main content-->
<!--        mainContent.classList.add('opacity-0');-->
<!--        setTimeout(() => {-->
<!--            mainContent.classList.add('hidden');-->
<!--            // Show full screen success-->
<!--            fullScreenSuccess.classList.remove('hidden');-->
<!--            setTimeout(() => {-->
<!--                fullScreenSuccess.classList.add('opacity-100');-->
<!--            }, 50); // Small delay to ensure display is set before opacity transition-->

<!--            // Hide full screen success after 2 seconds-->
<!--            setTimeout(() => {-->
<!--                fullScreenSuccess.classList.remove('opacity-100');-->
<!--                fullScreenSuccess.classList.add('opacity-0');-->
<!--                fullScreenSuccess.addEventListener('transitionend', () => {-->
<!--                    fullScreenSuccess.classList.add('hidden');-->
<!--                    // Show main content again-->
<!--                    mainContent.classList.remove('hidden');-->
<!--                    setTimeout(() => {-->
<!--                        mainContent.classList.remove('opacity-0');-->
<!--                        if (callback) callback();-->
<!--                    }, 50); // Small delay for main content to become visible-->
<!--                }, { once: true }); // Ensure event listener is removed after first use-->
<!--            }, 2000); // Animation duration-->
<!--        }, 500); // Fade out main content duration-->
<!--    }-->

<!--    /**-->
<!--     * Displays a temporary message in the interaction window.-->
<!--     * @param {string} message - The message to display.-->
<!--     * @param {string} type - 'success' or 'error'.-->
<!--     */-->
<!--    function displayMessage(message, type) {-->
<!--        const messageDiv = document.createElement('div');-->
<!--        messageDiv.className = `p-3 rounded-lg mt-4 text-center text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;-->
<!--        messageDiv.textContent = message;-->
<!--        interactionWindow.appendChild(messageDiv);-->
<!--        scrollToBottom();-->
<!--        setTimeout(() => {-->
<!--            messageDiv.remove();-->
<!--        }, 3000); // Remove message after 3 seconds-->
<!--    }-->

<!--    /**-->
<!--     * Shows a custom confirmation modal.-->
<!--     * @param {string} title - The title for the modal.-->
<!--     * @param {string} message - The message for the modal.-->
<!--     * @param {string} confirmText - Text for the confirm button.-->
<!--     * @returns {Promise<boolean>} Resolves to true if confirmed, false if cancelled.-->
<!--     */-->
<!--    function showConfirmationModal(title, message, confirmText) {-->
<!--        return new Promise((resolve) => {-->
<!--            modalTitle.textContent = title;-->
<!--            modalMessage.textContent = message;-->
<!--            modalConfirmBtn.textContent = confirmText;-->

<!--            confirmationModal.classList.remove('hidden');-->
<!--            setTimeout(() => confirmationModal.classList.add('active'), 50); // Fade in-->

<!--            const handleConfirm = () => {-->
<!--                confirmationModal.classList.remove('active');-->
<!--                confirmationModal.addEventListener('transitionend', () => {-->
<!--                    confirmationModal.classList.add('hidden');-->
<!--                    resolve(true);-->
<!--                }, { once: true });-->
<!--            };-->

<!--            const handleCancel = () => {-->
<!--                confirmationModal.classList.remove('active');-->
<!--                confirmationModal.addEventListener('transitionend', () => {-->
<!--                    confirmationModal.classList.add('hidden');-->
<!--                    resolve(false);-->
<!--                }, { once: true });-->
<!--            };-->

<!--            modalConfirmBtn.onclick = handleConfirm;-->
<!--            modalCancelBtn.onclick = handleCancel;-->
<!--        });-->
<!--    }-->


<!--    /**-->
<!--     * Disables all interactive elements within a given form element.-->
<!--     * @param {HTMLElement} formElement - The form element to disable.-->
<!--     * @param {boolean} [permanently=false] - If true, elements are disabled without retaining their value.-->
<!--     */-->
<!--    function disableFormElements(formElement, permanently = false) {-->
<!--        formElement.querySelectorAll('input, button, select, textarea').forEach(el => {-->
<!--            el.disabled = true;-->
<!--            if (permanently) {-->
<!--                el.style.pointerEvents = 'none'; // Make them truly unclickable-->
<!--                el.style.opacity = '0.7'; // Visually indicate disabled-->
<!--            }-->
<!--        });-->
<!--        // For radio button groups, ensure only the checked one is visually highlighted-->
<!--        formElement.querySelectorAll('.radio-option input[type="radio"]:not(:checked)').forEach(radio => {-->
<!--            radio.parentElement.style.opacity = '0.5';-->
<!--        });-->
<!--        formElement.querySelectorAll('.checkbox-option input[type="checkbox"]:not(:checked)').forEach(checkbox => {-->
<!--            checkbox.parentElement.style.opacity = '0.5';-->
<!--        });-->
<!--    }-->

<!--    /**-->
<!--     * Enables all interactive elements within a given form element.-->
<!--     * @param {HTMLElement} formElement - The form element to enable.-->
<!--     */-->
<!--    function enableFormElements(formElement) {-->
<!--        formElement.querySelectorAll('input, button, select, textarea').forEach(el => {-->
<!--            el.disabled = false;-->
<!--            el.style.pointerEvents = '';-->
<!--            el.style.opacity = '';-->
<!--        });-->
<!--        formElement.querySelectorAll('.radio-option, .checkbox-option').forEach(option => {-->
<!--            option.style.opacity = '';-->
<!--        });-->
<!--    }-->


<!--    /**-->
<!--     * Scrolls the interaction window (now the glass container) to the bottom.-->
<!--     */-->
<!--    function scrollToBottom() {-->
<!--        const glassContainer = document.querySelector('.glass-container');-->
<!--        if (glassContainer) {-->
<!--            glassContainer.scrollTop = glassContainer.scrollHeight;-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Converts a DD|MM|YYYY date string to a JavaScript Date object.-->
<!--     * @param {string} ddMmYyyy - Date string in DD|MM|YYYY format.-->
<!--     * @returns {Date | null} A Date object or null if invalid format.-->
<!--     */-->
<!--    function convertDDMMYYYYtoJSDate(ddMmYyyy) {-->
<!--        const parts = ddMmYyyy.split('|');-->
<!--        if (parts.length === 3) {-->
<!--            const day = parseInt(parts[0], 10);-->
<!--            const month = parseInt(parts[1], 10) - 1; // Month is 0-indexed-->
<!--            const year = parseInt(parts[2], 10);-->
<!--            const date = new Date(year, month, day);-->
<!--            // Check if the date components actually match, in case of invalid dates (e.g., Feb 30)-->
<!--            if (date.getFullYear() === year && date.getMonth() === month && date.getDate() === day) {-->
<!--                return date;-->
<!--            }-->
<!--        }-->
<!--        return null;-->
<!--    }-->

<!--    /**-->
<!--     * Converts a Date object to YYYY-MM-DD string format (for internal use).-->
<!--     * @param {Date} date - The Date object.-->
<!--     * @returns {string} Date string in YYYY-MM-DD format.-->
<!--     */-->
<!--    function convertDateToYYYYMMDD(date) {-->
<!--        return date.toISOString().split('T')[0];-->
<!--    }-->

<!--    /**-->
<!--     * Converts a Date object to DD|MM|YYYY string format (for user display/input).-->
<!--     * @param {Date} date - The Date object.-->
<!--     * @returns {string} Date string in DD|MM|YYYY format.-->
<!--     */-->
<!--    function convertDateToDDMMYYYY(date) {-->
<!--        const day = String(date.getDate()).padStart(2, '0');-->
<!--        const month = String(date.getMonth() + 1).padStart(2, '0');-->
<!--        const year = date.getFullYear();-->
<!--        return `${day}|${month}|${year}`;-->
<!--    }-->

<!--    // -&#45;&#45; Country Codes for Phone Input -&#45;&#45;-->
<!--    const countryCodes = [-->
<!--        { name: 'United States', code: '+1', placeholder: '123-456-7890' },-->
<!--        { name: 'India', code: '+91', placeholder: '9876543210' },-->
<!--        { name: 'United Kingdom', code: '+44', placeholder: '7911 123456' },-->
<!--        { name: 'Canada', code: '+1', placeholder: '123-456-7890' },-->
<!--        { name: 'Australia', code: '+61', placeholder: '412 345 678' },-->
<!--        { name: 'Germany', code: '+49', placeholder: '170 1234567' },-->
<!--        { name: 'France', code: '+33', placeholder: '6 12 34 56 78' },-->
<!--        { name: 'Brazil', code: '+55', placeholder: '11 91234-5678' },-->
<!--        { name: 'Mexico', code: '+52', placeholder: '55 1234 5678' },-->
<!--        { name: 'China', code: '+86', placeholder: '138 0013 8000' },-->
<!--        { name: 'Japan', code: '+81', placeholder: '90-1234-5678' },-->
<!--        { name: 'South Africa', code: '+27', placeholder: '82 123 4567' },-->
<!--        { name: 'New Zealand', code: '+64', placeholder: '21 123 4567' },-->
<!--        // Add more countries as needed-->
<!--    ];-->

<!--    /**-->
<!--     * Generates the HTML for a country code select dropdown.-->
<!--     * @param {string} selectId - The ID for the select element.-->
<!--     * @param {string} initialSelectedCode - The initially selected country code (e.g., '+91').-->
<!--     * @returns {string} HTML string for the select dropdown.-->
<!--     */-->
<!--    function generateCountryCodeSelectHtml(selectId, initialSelectedCode = '+91') {-->
<!--        const options = countryCodes.map(c =>-->
<!--            `<option value="${c.code}" ${c.code === initialSelectedCode ? 'selected' : ''}>${c.name} (${c.code})</option>`-->
<!--        ).join('');-->
<!--        return `-->
<!--            <select id="${selectId}" class="w-full p-2 rounded-lg bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">-->
<!--                ${options}-->
<!--            </select>-->
<!--        `;-->
<!--    }-->

<!--    /**-->
<!--     * Helper to attach event listener to a country code select to update a mobile input's placeholder.-->
<!--     * @param {string} selectId - ID of the country code select.-->
<!--     * @param {string} mobileInputId - ID of the mobile number input.-->
<!--     */-->
<!--    function setupCountryCodePlaceholderListener(selectId, mobileInputId) {-->
<!--        const countryCodeSelect = document.getElementById(selectId);-->
<!--        const mobileInput = document.getElementById(mobileInputId);-->
<!--        if (countryCodeSelect && mobileInput) {-->
<!--            const updatePlaceholder = () => {-->
<!--                const selectedCode = countryCodeSelect.value;-->
<!--                const selectedCountry = countryCodes.find(c => c.code === selectedCode);-->
<!--                if (selectedCountry) {-->
<!--                    mobileInput.placeholder = selectedCountry.placeholder;-->
<!--                }-->
<!--            };-->
<!--            countryCodeSelect.addEventListener('change', updatePlaceholder);-->
<!--            updatePlaceholder(); // Set initial placeholder-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Adds the "Copy From Previous Member" section to a form.-->
<!--     * @param {HTMLElement} formElement - The form element to add the section to.-->
<!--     * @param {number} currentMemberIndex - The index of the member currently being edited.-->
<!--     * @param {string} formId - The ID of the form, used by the copy function to find elements.-->
<!--     */-->
<!--    function addCopyFromPreviousSection(formElement, currentMemberIndex, formId) {-->
<!--        if (currentMemberIndex === 0 || registrationData.travelDetails.members.length === 0) {-->
<!--            return; // Only show if there are previous members-->
<!--        }-->

<!--        let optionsHtml = '<option value="">Select a member to copy from</option>';-->
<!--        for (let i = 0; i < currentMemberIndex; i++) {-->
<!--            const member = registrationData.travelDetails.members[i];-->
<!--            optionsHtml += `<option value="${i}">${member.firstName} ${member.lastName || ''} (Person ${i + 1})</option>`;-->
<!--        }-->

<!--        const copySectionHtml = `-->
<!--            <div class="bg-gray-700 bg-opacity-50 p-4 rounded-xl mb-6 border border-gray-600">-->
<!--                <h3 class="text-lg font-semibold mb-3 text-white">Copy Details From Previous Member:</h3>-->
<!--                <div class="flex flex-col sm:flex-row gap-3 items-center">-->
<!--                    <select id="copy-from-member-select-${currentMemberIndex}-${formId}" class="flex-grow w-full sm:w-auto p-2 rounded-lg bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">-->
<!--                        ${optionsHtml}-->
<!--                    </select>-->
<!--                    <button type="button" class="form-button flex-shrink-0" onclick="window.copyAndApplyMemberDetails(parseInt(document.getElementById('copy-from-member-select-${currentMemberIndex}-${formId}').value), ${currentMemberIndex}, '${formId}')">-->
<!--                        <i class="fas fa-copy mr-2"></i> Copy-->
<!--                    </button>-->
<!--                </div>-->
<!--            </div>-->
<!--        `;-->
<!--        // Insert at the beginning of the form content-->
<!--        formElement.insertAdjacentHTML('afterbegin', copySectionHtml);-->
<!--    }-->

<!--    /**-->
<!--     * Copies relevant data from a source member to a target member and updates the form UI.-->
<!--     * Excludes copying `firstName` and `lastName`.-->
<!--     * @param {number} sourceIndex - The index of the member to copy data FROM.-->
<!--     * @param {number} targetIndex - The index of the member to copy data TO.-->
<!--     * @param {string} formId - The ID of the current form being displayed.-->
<!--     */-->
<!--    window.copyAndApplyMemberDetails = function(sourceIndex, targetIndex, formId) {-->
<!--        if (sourceIndex === "" || isNaN(sourceIndex) || sourceIndex === null) {-->
<!--            displayMessage('Please select a member to copy from.', 'error');-->
<!--            return;-->
<!--        }-->

<!--        const sourceMember = registrationData.travelDetails.members[sourceIndex];-->
<!--        const targetMember = registrationData.travelDetails.members[targetIndex];-->
<!--        const formElement = document.getElementById(formId);-->

<!--        if (!sourceMember || !targetMember || !formElement) {-->
<!--            console.error('Error: Source member, target member, or form element not found during copy operation.');-->
<!--            displayMessage('An internal error occurred during copy. Please try again.', 'error');-->
<!--            return;-->
<!--        }-->

<!--        console.log(`Copying from member ${sourceIndex} to member ${targetIndex} for form ${formId}`);-->
<!--        console.log("Source data:", sourceMember);-->

<!--        // Temporarily disable inputs to prevent user interaction during copy, then re-enable-->
<!--        disableFormElements(formElement);-->

<!--        // Use a short delay to ensure DOM is fully ready for updates after (re)rendering and disabling-->
<!--        setTimeout(() => {-->
<!--            try {-->
<!--                // **DO NOT copy firstName and lastName directly to targetMember**-->
<!--                // Create a shallow copy of sourceMember and then delete the properties you don't want to copy.-->
<!--                // This ensures other nested objects like mealPreferences are deep copied.-->
<!--                let tempSourceCopy = JSON.parse(JSON.stringify(sourceMember));-->
<!--                delete tempSourceCopy.firstName;-->
<!--                delete tempSourceCopy.lastName;-->

<!--                // Merge the properties of tempSourceCopy into targetMember-->
<!--                Object.assign(targetMember, tempSourceCopy);-->


<!--                // Update inputs on the "Add People Form" if it's currently displayed-->
<!--                // ONLY copy non-name fields-->
<!--                // The name fields should remain untouched by this copy operation-->
<!--                const memberAgeInput = document.getElementById(`member-age-${targetIndex}`);-->
<!--                const memberGenderSelect = document.getElementById(`member-gender-${targetIndex}`);-->
<!--                const memberMobileCountryCodeSelect = document.getElementById(`member-country-code-${targetIndex}`);-->
<!--                const memberMobileInput = document.getElementById(`member-mobile-${targetIndex}`);-->

<!--                if (memberAgeInput) {-->
<!--                    memberAgeInput.value = targetMember.age;-->
<!--                }-->
<!--                if (memberGenderSelect) {-->
<!--                    memberGenderSelect.value = targetMember.gender;-->
<!--                    memberGenderSelect.dispatchEvent(new Event('change'));-->
<!--                }-->
<!--                if (memberMobileCountryCodeSelect) {-->
<!--                    const initialCountryCode = targetMember.mobile ? targetMember.mobile.substring(0, targetMember.mobile.length - (targetMember.mobile.match(/\d/) ? targetMember.mobile.substring(targetMember.mobile.indexOf(targetMember.mobile.match(/\d/))).length : 0)) : '+91';-->
<!--                    memberMobileCountryCodeSelect.value = initialCountryCode;-->
<!--                    memberMobileCountryCodeSelect.dispatchEvent(new Event('change'));-->
<!--                }-->
<!--                if (memberMobileInput) {-->
<!--                    memberMobileInput.value = targetMember.mobile ? targetMember.mobile.substring(targetMember.mobile.indexOf(targetMember.mobile.match(/\d/))) : '';-->
<!--                }-->


<!--                // Handle form-specific copying and UI updates for other forms-->
<!--                switch (formId) {-->
<!--                    case `arrival-departure-dates-form-${targetIndex}`:-->
<!--                        formElement.querySelectorAll(`input[type="checkbox"][id^="attend-"]`).forEach(cb => {-->
<!--                            cb.checked = targetMember.attendingDates.includes(cb.value);-->
<!--                            cb.dispatchEvent(new Event('change')); // Ensure change is dispatched-->
<!--                        });-->

<!--                        const arrival12hr = convert24hrTo12hr(targetMember.arrivalTime);-->
<!--                        const arrivalHourInput = document.getElementById(`arrival-hour-${targetIndex}`);-->
<!--                        const arrivalMinuteInput = document.getElementById(`arrival-minute-${targetIndex}`);-->
<!--                        const arrivalAmPmSelect = document.getElementById(`arrival-ampm-${targetIndex}`);-->
<!--                        if(arrivalHourInput) arrivalHourInput.value = arrival12hr.hour;-->
<!--                        if(arrivalMinuteInput) arrivalMinuteInput.value = arrival12hr.minute;-->
<!--                        if(arrivalAmPmSelect) {-->
<!--                            arrivalAmPmSelect.value = arrival12hr.ampm;-->
<!--                            arrivalAmPmSelect.dispatchEvent(new Event('change'));-->
<!--                        }-->

<!--                        const departure12hr = convert24hrTo12hr(targetMember.departureTime);-->
<!--                        const departureHourInput = document.getElementById(`departure-hour-${targetIndex}`);-->
<!--                        const departureMinuteInput = document.getElementById(`departure-minute-${targetIndex}`);-->
<!--                        const departureAmPmSelect = document.getElementById(`departure-ampm-${targetIndex}`);-->
<!--                        if(departureHourInput) departureHourInput.value = departure12hr.hour;-->
<!--                        if(departureMinuteInput) departureMinuteInput.value = departure12hr.minute;-->
<!--                        if(departureAmPmSelect) {-->
<!--                            departureAmPmSelect.value = departure12hr.ampm;-->
<!--                            departureAmPmSelect.dispatchEvent(new Event('change'));-->
<!--                        }-->

<!--                        const travelModeSelect = document.getElementById(`travel-mode-${targetIndex}`);-->
<!--                        if(travelModeSelect) {-->
<!--                            travelModeSelect.value = targetMember.modeOfTransport;-->
<!--                            travelModeSelect.dispatchEvent(new Event('change'));-->
<!--                        }-->
<!--                        const cityOfOriginInput = document.getElementById(`city-of-origin-${targetIndex}`);-->
<!--                        if(cityOfOriginInput) cityOfOriginInput.value = targetMember.cityOfOrigin;-->
<!--                        break;-->

<!--                    case `accommodation-form-${targetIndex}`:-->
<!--                        const stayYesRadio = document.getElementById(`stay-yes-${targetIndex}`);-->
<!--                        const stayNoRadio = document.getElementById(`stay-no-${targetIndex}`);-->
<!--                        if (stayYesRadio && stayNoRadio) {-->
<!--                            if (targetMember.stayAtHall) {-->
<!--                                stayYesRadio.checked = true;-->
<!--                                stayYesRadio.dispatchEvent(new Event('change'));-->
<!--                            } else {-->
<!--                                stayNoRadio.checked = true;-->
<!--                                stayNoRadio.dispatchEvent(new Event('change'));-->
<!--                            }-->
<!--                        }-->

<!--                        const cotYesRadio = document.getElementById(`cot-yes-${targetIndex}`);-->
<!--                        const cotNoRadio = document.getElementById(`cot-no-${targetIndex}`);-->
<!--                        if (cotYesRadio && cotNoRadio) {-->
<!--                            if (targetMember.cotRequired) {-->
<!--                                cotYesRadio.checked = true;-->
<!--                                cotYesRadio.dispatchEvent(new Event('change'));-->
<!--                            } else {-->
<!--                                cotNoRadio.checked = true;-->
<!--                                cotNoRadio.dispatchEvent(new Event('change'));-->
<!--                            }-->
<!--                        }-->

<!--                        const stairsYesRadio = document.getElementById(`stairs-yes-${targetIndex}`);-->
<!--                        const stairsNoRadio = document.getElementById(`stairs-no-${targetIndex}`);-->
<!--                        if (stairsYesRadio && stairsNoRadio) {-->
<!--                            if (targetMember.difficultyClimbingStairs) {-->
<!--                                stairsYesRadio.checked = true;-->
<!--                                stairsYesRadio.dispatchEvent(new Event('change'));-->
<!--                            } else {-->
<!--                                stairsNoRadio.checked = true;-->
<!--                                stairsNoRadio.dispatchEvent(new Event('change'));-->
<!--                            }-->
<!--                        }-->
<!--                        // Re-trigger the toggleCotQuestion if applicable to update hidden/shown state-->
<!--                        if (formId.includes('accommodation-form')) {-->
<!--                            const cotQuestionDiv = document.getElementById(`cot-question-${targetIndex}`);-->
<!--                            if (cotQuestionDiv) {-->
<!--                                if (targetMember.stayAtHall) {-->
<!--                                    cotQuestionDiv.classList.remove('hidden');-->
<!--                                } else {-->
<!--                                    cotQuestionDiv.classList.add('hidden');-->
<!--                                }-->
<!--                            }-->
<!--                        }-->
<!--                        break;-->

<!--                    case `meal-preferences-form-${targetIndex}`:-->
<!--                        const morningPrefRadio = document.getElementById(`morning-${targetMember.morningTeaCoffee.preference}-${targetIndex}`);-->
<!--                        if (morningPrefRadio) {-->
<!--                            morningPrefRadio.checked = true;-->
<!--                            morningPrefRadio.dispatchEvent(new Event('change'));-->
<!--                            if (['tea', 'coffee', 'both'].includes(targetMember.morningTeaCoffee.preference)) {-->
<!--                                const morningSugarRadio = document.getElementById(`morning-sugar-${targetMember.morningTeaCoffee.sugar === 'sugar' ? 'yes' : 'no'}-${targetIndex}`);-->
<!--                                if (morningSugarRadio) morningSugarRadio.checked = true;-->
<!--                            }-->
<!--                        }-->

<!--                        targetMember.attendingDates.forEach(dateYYYYMMDD => {-->
<!--                            const prefs = targetMember.mealPreferences[dateYYYYMMDD];-->
<!--                            if (prefs) {-->
<!--                                const breakfastCheckbox = document.getElementById(`breakfast-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                if (breakfastCheckbox) {-->
<!--                                     breakfastCheckbox.checked = prefs.breakfast;-->
<!--                                     breakfastCheckbox.dispatchEvent(new Event('change'));-->
<!--                                }-->
<!--                                const lunchCheckbox = document.getElementById(`lunch-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                if (lunchCheckbox) {-->
<!--                                    lunchCheckbox.checked = prefs.lunch;-->
<!--                                    lunchCheckbox.dispatchEvent(new Event('change'));-->
<!--                                }-->
<!--                                const highTeaCheckbox = document.getElementById(`high-tea-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                if (highTeaCheckbox) {-->
<!--                                    highTeaCheckbox.checked = prefs.highTea;-->
<!--                                    highTeaCheckbox.dispatchEvent(new Event('change'));-->
<!--                                }-->
<!--                                const dinnerCheckbox = document.getElementById(`dinner-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                if (dinnerCheckbox) {-->
<!--                                    dinnerCheckbox.checked = prefs.dinner;-->
<!--                                    dinnerCheckbox.dispatchEvent(new Event('change'));-->
<!--                                }-->

<!--                                const teaCoffeePrefRadio = document.getElementById(`${prefs.teaCoffeePreference}-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                if (teaCoffeePrefRadio) {-->
<!--                                    teaCoffeePrefRadio.checked = true;-->
<!--                                    teaCoffeePrefRadio.dispatchEvent(new Event('change'));-->
<!--                                    if (['tea', 'coffee', 'both'].includes(prefs.teaCoffeePreference)) {-->
<!--                                        const sugarRadio = document.getElementById(`sugar-${prefs.teaCoffeeSugar === 'sugar' ? 'yes' : 'no'}-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                        if (sugarRadio) sugarRadio.checked = true;-->
<!--                                    }-->
<!--                                }-->

<!--                                const packedFoodYesRadio = document.getElementById(`packed-food-yes-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                const packedFoodNoRadio = document.getElementById(`packed-food-no-${targetIndex}-${dateYYYYMMDD}`);-->
<!--                                if (packedFoodYesRadio && packedFoodNoRadio) {-->
<!--                                    if (prefs.packedFood) {-->
<!--                                        packedFoodYesRadio.checked = true;-->
<!--                                        packedFoodYesRadio.dispatchEvent(new Event('change'));-->
<!--                                    } else {-->
<!--                                        packedFoodNoRadio.checked = true;-->
<!--                                        packedFoodNoRadio.dispatchEvent(new Event('change'));-->
<!--                                    }-->
<!--                                }-->
<!--                            }-->
<!--                        });-->
<!--                        // Re-trigger sugar visibility logic for morning tea/coffee and daily meals-->
<!--                        formElement.querySelectorAll(`input[name="morning-tea-coffee-${targetIndex}"]`).forEach(radio => {-->
<!--                            if (radio.checked) radio.dispatchEvent(new Event('change'));-->
<!--                        });-->
<!--                        targetMember.attendingDates.forEach(dateYYYYMMDD => {-->
<!--                            formElement.querySelectorAll(`input[name="tea-coffee-preference-${targetIndex}-${dateYYYYMMDD}"]`).forEach(radio => {-->
<!--                                if (radio.checked) radio.dispatchEvent(new Event('change'));-->
<!--                            });-->
<!--                        });-->
<!--                        break;-->

<!--                    case `local-assistance-form-${targetIndex}`:-->
<!--                        const assistanceYesRadio = document.getElementById(`assistance-yes-${targetIndex}`);-->
<!--                        const assistanceNoRadio = document.getElementById(`assistance-no-${targetIndex}`);-->
<!--                        const localAssistanceModeSelect = document.getElementById(`local-assistance-mode-${targetIndex}`);-->

<!--                        if (assistanceYesRadio && assistanceNoRadio) {-->
<!--                            if (targetMember.localAssistance) {-->
<!--                                assistanceYesRadio.checked = true;-->
<!--                                assistanceYesRadio.dispatchEvent(new Event('change'));-->
<!--                                if (localAssistanceModeSelect) {-->
<!--                                    localAssistanceModeSelect.value = targetMember.localAssistance;-->
<!--                                    localAssistanceModeSelect.dispatchEvent(new Event('change'));-->
<!--                                }-->
<!--                            } else {-->
<!--                                assistanceNoRadio.checked = true;-->
<!--                                assistanceNoRadio.dispatchEvent(new Event('change'));-->
<!--                            }-->
<!--                        }-->

<!--                        const recordingsTextarea = document.getElementById(`recordings-text-${targetIndex}`);-->
<!--                        if (recordingsTextarea) recordingsTextarea.value = targetMember.recordingsNeeded;-->

<!--                        const specialRequestsToggleYes = document.getElementById(`special-requests-toggle-${targetIndex}-yes`);-->
<!--                        const specialRequestsToggleNo = document.getElementById(`special-requests-toggle-${targetIndex}-no`);-->
<!--                        const specialRequestsTextarea = document.getElementById(`special-requests-text-${targetIndex}`);-->

<!--                        if (specialRequestsToggleYes && specialRequestsToggleNo) {-->
<!--                            if (targetMember.specialRequests) {-->
<!--                                specialRequestsToggleYes.checked = true;-->
<!--                                specialRequestsToggleYes.dispatchEvent(new Event('change'));-->
<!--                                if (specialRequestsTextarea) specialRequestsTextarea.value = targetMember.specialRequests;-->
<!--                            } else {-->
<!--                                specialRequestsToggleNo.checked = true;-->
<!--                                specialRequestsToggleNo.dispatchEvent(new Event('change'));-->
<!--                            }-->
<!--                        }-->
<!--                        // Re-trigger assistance dropdown and special requests textarea visibility logic-->
<!--                        if (formId.includes('local-assistance-form')) {-->
<!--                            const assistanceChoiceRadios = formElement.querySelectorAll(`input[name="local-assistance-choice-${targetIndex}"]`);-->
<!--                            assistanceChoiceRadios.forEach(radio => {-->
<!--                                if (radio.checked) radio.dispatchEvent(new Event('change'));-->
<!--                            });-->
<!--                            const specialRequestsToggleRadios = formElement.querySelectorAll(`input[name="special-requests-toggle-${targetIndex}"]`);-->
<!--                            specialRequestsToggleRadios.forEach(radio => {-->
<!--                                if (radio.checked) radio.dispatchEvent(new Event('change'));-->
<!--                            });-->
<!--                        }-->
<!--                        break;-->
<!--                }-->

<!--                displayMessage(`Details (excluding name) copied from ${sourceMember.firstName} ${sourceMember.lastName || ''}!`, 'success');-->
<!--            } catch (e) {-->
<!--                console.error('Error applying copied details to form UI:', e);-->
<!--                displayMessage('An error occurred while copying details. Please check manually.', 'error');-->
<!--            } finally {-->
<!--                enableFormElements(formElement); // Always re-enable inputs-->
<!--                scrollToBottom();-->
<!--            }-->
<!--        }, 50); // Small delay to allow DOM to settle after initial disable-->
<!--    };-->


<!--    // -&#45;&#45; Core Form Flow Steps -&#45;&#45;-->

<!--    /**-->
<!--     * Initializes the form flow. This now always starts a new registration.-->
<!--     */-->
<!--    function initFormFlow() {-->
<!--        interactionWindow.innerHTML = ''; // Clear previous content-->
<!--        finalGreetingSection.classList.remove('active');-->
<!--        finalGreetingSection.classList.add('hidden');-->
<!--        registrationData = { // Reset registrationData for new session-->
<!--            mainRegistrant: { mobile: '', firstName: '', lastName: '', ref1: '', ref2: '' },-->
<!--            travelDetails: { members: [] },-->
<!--            registrationId: ''-->
<!--        };-->
<!--        currentMemberIndex = 0;-->
<!--        isEditingExisting = false; // Always false for new registration flow-->

<!--        // Initial bot greeting message-->
<!--        addInteractionElement(-->
<!--            'bot-message',-->
<!--            `<span>Hello, I am Aditya Paranjape and I am here to help you with the July 2025 Pune Utsav Registration. The Utsav is held at the Swapnapoorti Hall, Pune. <a href="https://maps.app.goo.gl/YourGoogleMapsLink" target="_blank" class="text-blue-300 hover:underline">Click here</a> to see the Karyalaya venue. We are eagerly expecting you here!</span>`,-->
<!--            'bot-initial-greeting'-->
<!--        );-->
<!--        // Directly proceed to asking for mobile number-->
<!--        setTimeout(() => {-->
<!--            addInteractionElement(-->
<!--                'bot-message',-->
<!--                `<span>Great! Let's get you registered. Please provide your contact number.</span>`,-->
<!--                null-->
<!--            );-->
<!--            displayMobileInputForm(); // Directly proceed to mobile input-->
<!--        }, 1500);-->
<!--    }-->

<!--    /**-->
<!--     * Displays the mobile number input form with country code selector.-->
<!--     */-->
<!--    function displayMobileInputForm() {-->
<!--        const formHtml = `-->
<!--            <h2>Enter Contact Number</h2>-->
<!--            <div class="form-field-group">-->
<!--                <label for="country-code">Country Code:</label>-->
<!--                ${generateCountryCodeSelectHtml('country-code')}-->
<!--            </div>-->
<!--            <div class="form-field-group">-->
<!--                <label for="mobile-number">Mobile Number:</label>-->
<!--                <input type="tel" id="mobile-number" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-[var(&#45;&#45;form-button-bg)]" placeholder="9876543210">-->
<!--                <div id="mobile-error" class="error-message"></div>-->
<!--            </div>-->
<!--            <button class="form-button" onclick="submitMobileNumber(this)">Continue</button>-->
<!--        `;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, 'mobile-input-form');-->

<!--        setupCountryCodePlaceholderListener('country-code', 'mobile-number');-->

<!--        setTimeout(() => {-->
<!--            const mobileInput = formElement.querySelector('#mobile-number');-->
<!--            if (mobileInput) mobileInput.focus();-->
<!--        }, 550);-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of the mobile number.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     */-->
<!--    function submitMobileNumber(button) {-->
<!--        const countryCodeSelect = document.getElementById('country-code');-->
<!--        const mobileInput = document.getElementById('mobile-number');-->
<!--        const errorDiv = document.getElementById('mobile-error');-->
<!--        const formElement = button.closest('.user-input-form');-->

<!--        const countryCode = countryCodeSelect.value;-->
<!--        const mobile = mobileInput.value.trim();-->
<!--        const fullMobileNumber = countryCode + mobile;-->

<!--        // Basic mobile number validation (digits only after country code)-->
<!--        const mobileRegex = /^\+?\d{1,4}\d{7,15}$/; // Allows 7 to 15 digits after country code-->

<!--        if (mobileRegex.test(fullMobileNumber)) {-->
<!--            registrationData.mainRegistrant.mobile = fullMobileNumber;-->

<!--            disableFormElements(formElement);-->
<!--            button.textContent = 'Submitted!';-->
<!--            addInteractionElement('user-input-form', `<span>My contact number is: ${fullMobileNumber}</span>`);-->

<!--            // Always proceed to asking for name-->
<!--            setTimeout(() => {-->
<!--                addInteractionElement(-->
<!--                    'bot-message',-->
<!--                    `<span>Thank you. Now, please provide your first and last name. These are mandatory fields.</span>`,-->
<!--                    null-->
<!--                );-->
<!--                displayManualMainRegistrantNameInput(); // Go straight to entering name-->
<!--            }, 1000);-->
<!--        } else {-->
<!--            errorDiv.textContent = 'Please enter a valid mobile number (e.g., 9876543210 for +91)';-->
<!--        }-->
<!--    }-->


<!--    /**-->
<!--     * Displays form for user to manually input main registrant's first and last name.-->
<!--     */-->
<!--    function displayManualMainRegistrantNameInput() {-->
<!--        const formHtml = `-->
<!--            <h2>Enter Your Full Name</h2>-->
<!--            <div class="form-field-group">-->
<!--                <label for="manual-first-name">First Name:</label>-->
<!--                <input type="text" id="manual-first-name" value="${registrationData.mainRegistrant.firstName}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="Your First Name">-->
<!--                <div id="manual-first-name-error" class="error-message"></div>-->
<!--            </div>-->
<!--            <div class="form-field-group">-->
<!--                <label for="manual-last-name">Last Name:</label>-->
<!--                <input type="text" id="manual-last-name" value="${registrationData.mainRegistrant.lastName}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="Your Last Name">-->
<!--                <div id="manual-last-name-error" class="error-message"></div>-->
<!--            </div>-->
<!--            <button class="form-button" onclick="submitManualNameInput(this)">Continue</button>-->
<!--        `;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, 'manual-name-input-form');-->
<!--        setTimeout(() => {-->
<!--            const input = formElement.querySelector('#manual-first-name');-->
<!--            if (input) input.focus();-->
<!--        }, 550);-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of manually entered main registrant name.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     */-->
<!--    function submitManualNameInput(button) {-->
<!--        const firstNameInput = document.getElementById('manual-first-name');-->
<!--        const lastNameInput = document.getElementById('manual-last-name');-->
<!--        const firstNameError = document.getElementById('manual-first-name-error');-->
<!--        const lastNameError = document.getElementById('manual-last-name-error');-->
<!--        const formElement = button.closest('.user-input-form');-->

<!--        const firstName = firstNameInput.value.trim();-->
<!--        const lastName = lastNameInput.value.trim();-->

<!--        let isValid = true;-->
<!--        if (firstName.length < 2) {-->
<!--            firstNameError.textContent = 'First Name is required (min 2 chars).';-->
<!--            isValid = false;-->
<!--        } else {-->
<!--            firstNameError.textContent = '';-->
<!--        }-->

<!--        if (lastName.length < 2) { // Last name is now mandatory-->
<!--            lastNameError.textContent = 'Last Name is required (min 2 chars).';-->
<!--            isValid = false;-->
<!--        } else {-->
<!--            lastNameError.textContent = '';-->
<!--        }-->

<!--        if (isValid) {-->
<!--            registrationData.mainRegistrant.firstName = firstName;-->
<!--            registrationData.mainRegistrant.lastName = lastName;-->

<!--            disableFormElements(formElement);-->
<!--            button.textContent = 'Submitted!';-->
<!--            addInteractionElement('user-input-form', `<span>My name is: ${firstName} ${lastName}</span>`);-->

<!--            // Proceed to Sampark Group details-->
<!--            setTimeout(() => {-->
<!--                addInteractionElement(-->
<!--                    'bot-message',-->
<!--                    `<span>Thank you, ${firstName}! Please provide two reference numbers from a Sampark Group for validation.</span>`,-->
<!--                    null-->
<!--                );-->
<!--                displaySamparkGroupDetailsForm();-->
<!--            }, 1000);-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Displays form for Sampark Group reference numbers.-->
<!--     */-->
<!--    function displaySamparkGroupDetailsForm() {-->
<!--        // Correctly handle mobile number for display by removing country code part-->
<!--        const getMobileNumberOnly = (fullMobile) => {-->
<!--            const match = fullMobile.match(/\d/);-->
<!--            return match ? fullMobile.substring(fullMobile.indexOf(match[0])) : '';-->
<!--        };-->

<!--        const formHtml = `-->
<!--            <h2>Sampark Group Details</h2>-->
<!--            <p>Please enter two contact numbers from a Sampark Group for validation. <span class="text-sm text-yellow-200">(Note: This validation is currently simulated and will be integrated with a database later.)</span></p>-->
<!--            <div class="form-field-group">-->
<!--                <label for="sampark-ref1-country-code">Sampark Group Contact 1 (Country Code):</label>-->
<!--                ${generateCountryCodeSelectHtml('sampark-ref1-country-code', registrationData.mainRegistrant.ref1 ? registrationData.mainRegistrant.ref1.substring(0, registrationData.mainRegistrant.ref1.length - getMobileNumberOnly(registrationData.mainRegistrant.ref1).length) : '+91')}-->
<!--                <label for="sampark-ref1">Mobile Number:</label>-->
<!--                <input type="tel" id="sampark-ref1" value="${getMobileNumberOnly(registrationData.mainRegistrant.ref1)}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="1234567890">-->
<!--                <div id="sampark-ref1-error" class="error-message"></div>-->
<!--            </div>-->
<!--            <div class="form-field-group">-->
<!--                <label for="sampark-ref2-country-code">Sampark Group Contact 2 (Country Code):</label>-->
<!--                ${generateCountryCodeSelectHtml('sampark-ref2-country-code', registrationData.mainRegistrant.ref2 ? registrationData.mainRegistrant.ref2.substring(0, registrationData.mainRegistrant.ref2.length - getMobileNumberOnly(registrationData.mainRegistrant.ref2).length) : '+91')}-->
<!--                <label for="sampark-ref2">Mobile Number:</label>-->
<!--                <input type="tel" id="sampark-ref2" value="${getMobileNumberOnly(registrationData.mainRegistrant.ref2)}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="0987654321">-->
<!--                <div id="sampark-ref2-error" class="error-message"></div>-->
<!--            </div>-->
<!--            <button class="form-button" onclick="submitSamparkGroupDetails(this)">Submit</button>-->
<!--        `;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, 'sampark-group-form');-->

<!--        setupCountryCodePlaceholderListener('sampark-ref1-country-code', 'sampark-ref1');-->
<!--        setupCountryCodePlaceholderListener('sampark-ref2-country-code', 'sampark-ref2');-->

<!--        setTimeout(() => {-->
<!--            const input = formElement.querySelector('#sampark-ref1');-->
<!--            if (input) input.focus();-->
<!--        }, 550);-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of Sampark Group reference numbers.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     */-->
<!--    function submitSamparkGroupDetails(button) {-->
<!--        const ref1Input = document.getElementById('sampark-ref1');-->
<!--        const ref1CountryCode = document.getElementById('sampark-ref1-country-code');-->
<!--        const ref2Input = document.getElementById('sampark-ref2');-->
<!--        const ref2CountryCode = document.getElementById('sampark-ref2-country-code');-->

<!--        const ref1Error = document.getElementById('sampark-ref1-error');-->
<!--        const ref2Error = document.getElementById('sampark-ref2-error');-->
<!--        const formElement = button.closest('.user-input-form');-->

<!--        const fullRef1 = ref1CountryCode.value + ref1Input.value.trim();-->
<!--        const fullRef2 = ref2CountryCode.value + ref2Input.value.trim();-->
<!--        const mobileRegex = /^\+?\d{1,4}\d{7,15}$/;-->

<!--        let isValid = true;-->
<!--        if (!mobileRegex.test(fullRef1)) {-->
<!--            ref1Error.textContent = 'Please enter a valid mobile number.';-->
<!--            isValid = false;-->
<!--        } else {-->
<!--            ref1Error.textContent = '';-->
<!--        }-->

<!--        if (!mobileRegex.test(fullRef2)) {-->
<!--            ref2Error.textContent = 'Please enter a valid mobile number.';-->
<!--            isValid = false;-->
<!--        } else {-->
<!--            ref2Error.textContent = '';-->
<!--        }-->

<!--        // Check if both reference numbers exist in the hashmap-->
<!--        const ref1Exists = !!dummySamparkGroupContactsMap[fullRef1];-->
<!--        const ref2Exists = !!dummySamparkGroupContactsMap[fullRef2];-->

<!--        if (isValid && ref1Exists && ref2Exists) {-->
<!--            // *** DATABASE INTEGRATION POINT ***-->
<!--            // In a real application, you would send ref1 and ref2 to a backend-->
<!--            // for validation against a Sampark Group database.-->
<!--            // For now, we simulate success if they are valid mobile numbers.-->
<!--            console.log("Simulating Sampark Group validation...");-->
<!--            registrationData.mainRegistrant.ref1 = fullRef1;-->
<!--            registrationData.mainRegistrant.ref2 = fullRef2;-->

<!--            disableFormElements(formElement);-->
<!--            button.textContent = 'Submitted!';-->
<!--            addInteractionElement('user-input-form', `<span>Sampark Group details submitted.</span>`);-->

<!--            // Clear current chat messages for the full screen animation-->
<!--            interactionWindow.innerHTML = '';-->

<!--            showFullScreenSuccessAnimation(() => {-->
<!--                // This callback runs AFTER the animation completes and main-content is back-->
<!--                addInteractionElement(-->
<!--                    'bot-message',-->
<!--                    `<span>Welcome to Gurukul Utsav! Please select the number of people attending, including yourself, and provide their details.</span>`,-->
<!--                    null-->
<!--                );-->
<!--                // Initialize main registrant as first member-->
<!--                registrationData.travelDetails.members = [{-->
<!--                    firstName: registrationData.mainRegistrant.firstName,-->
<!--                    lastName: registrationData.mainRegistrant.lastName,-->
<!--                    mobile: registrationData.mainRegistrant.mobile,-->
<!--                    age: '', gender: '',-->
<!--                    arrivalDate: '', arrivalTime: '', departureDate: '', departureTime: '',-->
<!--                    attendingDates: [],-->
<!--                    morningTeaCoffee: { preference: 'none', sugar: 'sugar' }, // Initialize new field-->
<!--                    mealPreferences: {},-->
<!--                    stayAtHall: false, cotRequired: false, difficultyClimbingStairs: false, // Initialize new field-->
<!--                    modeOfTransport: '', cityOfOrigin: '',-->
<!--                    localAssistance: '', recordingsNeeded: '',-->
<!--                    specialRequests: '' // New field-->
<!--                }];-->
<!--                displayAddPeopleForm();-->
<!--            });-->
<!--        } else {-->
<!--            // If validation fails (either regex or hashmap lookup)-->
<!--            if (!ref1Exists || !ref2Exists) {-->
<!--                ref1Error.textContent = 'One or both reference numbers are not recognized.';-->
<!--                ref2Error.textContent = 'This activity seems suspicious. Please check the provided reference numbers.';-->
<!--            }-->
<!--            // Display bot message indicating the suspicious activity-->
<!--            addInteractionElement('bot-message', `<span>This activity seems suspicious. Please check the provided reference numbers.</span>`);-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Displays form to add multiple people to the registration.-->
<!--     */-->
<!--    function displayAddPeopleForm() {-->
<!--        let membersHtml = '';-->
<!--        registrationData.travelDetails.members.forEach((member, index) => {-->
<!--            membersHtml += generateMemberInputsHtml(member, index);-->
<!--        });-->

<!--        const formHtml = `-->
<!--            <h2>Attendees for Utsav</h2>-->
<!--            <p>Please enter details for each person attending, including yourself. You can add or remove members.</p>-->
<!--            <div id="dynamic-members-container">-->
<!--                ${membersHtml}-->
<!--            </div>-->
<!--            <button class="form-button flex items-center justify-center gap-2 mt-4 mb-4" onclick="addDynamicMember()">-->
<!--                <i class="fas fa-plus-circle"></i> Add Another Person-->
<!--            </button>-->
<!--            <button class="form-button" onclick="submitAddPeopleForm(this)">Continue to Details</button>-->
<!--        `;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, 'add-people-form');-->

<!--        // Initial focus on first member's first name-->
<!--        setTimeout(() => {-->
<!--            const firstMemberFirstNameInput = formElement.querySelector('#member-first-name-0');-->
<!--            if (firstMemberFirstNameInput) firstMemberFirstNameInput.focus();-->
<!--        }, 550);-->

<!--        // Setup country code listeners for dynamically added members-->
<!--        registrationData.travelDetails.members.forEach((member, index) => {-->
<!--            setupCountryCodePlaceholderListener(`member-country-code-${index}`, `member-mobile-${index}`);-->
<!--        });-->
<!--    }-->

<!--    /**-->
<!--     * Generates HTML for a single member's input fields.-->
<!--     * @param {Object} memberData - The member object from registrationData.travelDetails.members.-->
<!--     * @param {number} index - The index of the member.-->
<!--     * @returns {string} HTML string.-->
<!--     */-->
<!--    function generateMemberInputsHtml(memberData, index) {-->
<!--        const firstName = memberData.firstName || '';-->
<!--        const lastName = memberData.lastName || '';-->
<!--        const age = memberData.age || '';-->
<!--        // Extract country code from existing mobile number if available, otherwise default to +91-->
<!--        const initialCountryCode = memberData.mobile ? memberData.mobile.substring(0, memberData.mobile.indexOf(memberData.mobile.match(/\d/))) : '+91';-->
<!--        const mobileNumberOnly = memberData.mobile ? memberData.mobile.substring(memberData.mobile.indexOf(memberData.mobile.match(/\d/))) : '';-->
<!--        const gender = memberData.gender || '';-->

<!--        return `-->
<!--            <div class="member-entry-dynamic" id="member-entry-${index}">-->
<!--                <h4 class="text-lg font-medium mb-2">Person ${index + 1} ${index === 0 ? '(Main Registrant)' : ''}</h4>-->
<!--                <div class="form-field-group flex flex-col sm:flex-row gap-4">-->
<!--                    <div class="w-full sm:w-1/2">-->
<!--                        <label for="member-first-name-${index}">First Name:</label>-->
<!--                        <input type="text" id="member-first-name-${index}" value="${firstName}" class="w-full p-2 rounded-lg bg-[var(&#45;&#45;form-field-bg)]" placeholder="First Name">-->
<!--                        <div id="member-first-name-${index}-error" class="error-message"></div>-->
<!--                    </div>-->
<!--                    <div class="w-full sm:w-1/2">-->
<!--                        <label for="member-last-name-${index}">Last Name:</label>-->
<!--                        <input type="text" id="member-last-name-${index}" value="${lastName}" class="w-full p-2 rounded-lg bg-[var(&#45;&#45;form-field-bg)]" placeholder="Last Name">-->
<!--                        <div id="member-last-name-${index}-error" class="error-message"></div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="flex flex-col sm:flex-row gap-4">-->
<!--                    <div class="w-full sm:w-1/2 form-field-group">-->
<!--                        <label for="member-age-${index}">Age:</label>-->
<!--                        <input type="number" id="member-age-${index}" value="${age}" class="w-full p-2 rounded-lg bg-[var(&#45;&#45;form-field-bg)]" placeholder="Age">-->
<!--                        <div id="member-age-${index}-error" class="error-message"></div>-->
<!--                    </div>-->
<!--                    <div class="w-full sm:w-1/2 form-field-group">-->
<!--                        <label for="member-gender-${index}">Gender:</label>-->
<!--                        <select id="member-gender-${index}" class="w-full p-2 rounded-lg bg-[var(&#45;&#45;form-field-bg)]">-->
<!--                            <option value="">Select</option>-->
<!--                            <option value="M" ${gender === 'M' ? 'selected' : ''}>Male</option>-->
<!--                            <option value="F" ${gender === 'F' ? 'selected' : ''}>Female</option>-->
<!--                        </select>-->
<!--                        <div id="member-gender-${index}-error" class="error-message"></div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="form-field-group">-->
<!--                    <label for="member-country-code-${index}">Contact Details (Country Code):</label>-->
<!--                    ${generateCountryCodeSelectHtml(`member-country-code-${index}`, initialCountryCode)}-->
<!--                    <label for="member-mobile-${index}">Phone Number:</label>-->
<!--                    <input type="tel" id="member-mobile-${index}" value="${mobileNumberOnly}" class="w-full p-2 rounded-lg bg-[var(&#45;&#45;form-field-bg)]" placeholder="e.g., 9876543210">-->
<!--                    <div id="member-mobile-${index}-error" class="error-message"></div>-->
<!--                </div>-->
<!--                ${index > 0 ? `<button type="button" class="delete-member-button" onclick="removeDynamicMember(${index})"><i class="fas fa-trash-alt pr-1"></i>Remove</button>` : ''}-->
<!--            </div>-->
<!--        `;-->
<!--    }-->

<!--    /**-->
<!--     * Adds a new set of member input fields dynamically.-->
<!--     */-->
<!--    function addDynamicMember() {-->
<!--        const newIndex = registrationData.travelDetails.members.length;-->
<!--        registrationData.travelDetails.members.push({-->
<!--            firstName: '', lastName: '', age: '', gender: '', mobile: registrationData.mainRegistrant.mobile, // Default to main registrant's mobile-->
<!--            arrivalDate: '', arrivalTime: '', departureDate: '', departureTime: '',-->
<!--            attendingDates: [],-->
<!--            morningTeaCoffee: { preference: 'none', sugar: 'sugar' }, // Initialize new field-->
<!--            mealPreferences: {},-->
<!--            stayAtHall: false, cotRequired: false, difficultyClimbingStairs: false, // Initialize new field-->
<!--            modeOfTransport: '', cityOfOrigin: '',-->
<!--            localAssistance: '', recordingsNeeded: '',-->
<!--            specialRequests: '' // New field-->
<!--        });-->
<!--        const container = document.getElementById('dynamic-members-container');-->
<!--        container.insertAdjacentHTML('beforeend', generateMemberInputsHtml(registrationData.travelDetails.members[newIndex], newIndex));-->
<!--        scrollToBottom();-->
<!--        // Setup country code listener for the newly added member-->
<!--        setupCountryCodePlaceholderListener(`member-country-code-${newIndex}`, `member-mobile-${newIndex}`);-->
<!--        document.getElementById(`member-first-name-${newIndex}`).focus();-->
<!--    }-->

<!--    /**-->
<!--     * Removes a dynamically added member.-->
<!--     * @param {number} indexToRemove - The index of the member to remove.-->
<!--     */-->
<!--    function removeDynamicMember(indexToRemove) {-->
<!--        if (indexToRemove === 0) { // Prevent removing the main registrant-->
<!--            // Using a custom modal for alert, as requested in previous instructions-->
<!--            showConfirmationModal('Cannot Remove', 'The main registrant cannot be removed.', 'OK');-->
<!--            return;-->
<!--        }-->
<!--        registrationData.travelDetails.members.splice(indexToRemove, 1);-->
<!--        document.getElementById(`member-entry-${indexToRemove}`).remove();-->
<!--        // Re-render the remaining members to update their indices and IDs-->
<!--        const container = document.getElementById('dynamic-members-container');-->
<!--        container.innerHTML = ''; // Clear existing-->
<!--        registrationData.travelDetails.members.forEach((member, index) => {-->
<!--            container.insertAdjacentHTML('beforeend', generateMemberInputsHtml(member, index));-->
<!--        });-->
<!--        scrollToBottom();-->
<!--        // Re-setup country code listeners after re-rendering-->
<!--        registrationData.travelDetails.members.forEach((member, index) => {-->
<!--            setupCountryCodePlaceholderListener(`member-country-code-${index}`, `member-mobile-${index}`);-->
<!--        });-->
<!--    }-->

<!--    /**-->
<!--     * Submits the dynamic people form, validates, and proceeds.-->
<!--     * @param {HTMLButtonElement} button - The button element.-->
<!--     */-->
<!--    function submitAddPeopleForm(button) {-->
<!--        const formElement = button.closest('.user-input-form');-->
<!--        let isValid = true;-->
<!--        const mobileRegex = /^\+?\d{1,4}\d{7,15}$/;-->

<!--        registrationData.travelDetails.members.forEach((member, index) => {-->
<!--            const firstNameInput = document.getElementById(`member-first-name-${index}`);-->
<!--            const lastNameInput = document.getElementById(`member-last-name-${index}`);-->
<!--            const ageInput = document.getElementById(`member-age-${index}`);-->
<!--            const genderSelect = document.getElementById(`member-gender-${index}`);-->
<!--            const mobileCountryCodeSelect = document.getElementById(`member-country-code-${index}`);-->
<!--            const mobileInput = document.getElementById(`member-mobile-${index}`);-->

<!--            const firstNameError = document.getElementById(`member-first-name-${index}-error`);-->
<!--            const lastNameError = document.getElementById(`member-last-name-${index}-error`);-->
<!--            const ageError = document.getElementById(`member-age-${index}-error`);-->
<!--            const genderError = document.getElementById(`member-gender-${index}-error`);-->
<!--            const mobileError = document.getElementById(`member-mobile-${index}-error`);-->

<!--            // First Name Validation - MANDATORY-->
<!--            if (firstNameInput.value.trim().length < 2) {-->
<!--                firstNameError.textContent = 'First Name is required (min 2 chars).';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                firstNameError.textContent = '';-->
<!--                member.firstName = firstNameInput.value.trim();-->
<!--            }-->

<!--            // Last Name Validation - MANDATORY-->
<!--            if (lastNameInput.value.trim().length < 2) {-->
<!--                lastNameError.textContent = 'Last Name is required (min 2 chars).';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                lastNameError.textContent = '';-->
<!--                member.lastName = lastNameInput.value.trim();-->
<!--            }-->

<!--            const age = parseInt(ageInput.value, 10);-->
<!--            if (isNaN(age) || age < 1 || age > 120) {-->
<!--                ageError.textContent = 'Valid age (1-120) is required.';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                ageError.textContent = '';-->
<!--                member.age = age;-->
<!--            }-->

<!--            if (!genderSelect.value) {-->
<!--                genderError.textContent = 'Gender is required.';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                genderError.textContent = '';-->
<!--                member.gender = genderSelect.value;-->
<!--            }-->

<!--            const fullMemberMobileNumber = mobileCountryCodeSelect.value + mobileInput.value.trim();-->
<!--            if (!mobileRegex.test(fullMemberMobileNumber)) {-->
<!--                mobileError.textContent = 'Valid contact number required (e.g., +919876543210).';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                mobileError.textContent = '';-->
<!--                member.mobile = fullMemberMobileNumber;-->
<!--            }-->
<!--        });-->

<!--        if (isValid) {-->
<!--            disableFormElements(formElement);-->
<!--            button.textContent = 'Submitted!';-->
<!--            addInteractionElement('user-input-form', `<span>Details for ${registrationData.travelDetails.members.length} person(s) collected.</span>`);-->
<!--            currentMemberIndex = 0; // Reset for per-person detail collection-->
<!--            setTimeout(() => displayArrivalDepartureAndDatesForm(currentMemberIndex), 1000);-->
<!--        } else {-->
<!--            addInteractionElement('bot-message', `<span>Please correct the highlighted errors in the attendee details.</span>`);-->
<!--        }-->
<!--    }-->


<!--    /**-->
<!--     * Displays the arrival/departure dates (checkboxes) and time input for a specific member.-->
<!--     * @param {number} memberIndex - The index of the member in registrationData.travelDetails.members.-->
<!--     */-->
<!--    function displayArrivalDepartureAndDatesForm(memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;-->

<!--        // Convert 24-hour time to 12-hour for initial display-->
<!--        const arrival12hr = convert24hrTo12hr(member.arrivalTime);-->
<!--        const departure12hr = convert24hrTo12hr(member.departureTime);-->

<!--        const formId = `arrival-departure-dates-form-${memberIndex}`;-->
<!--        const formHtml = `-->
<!--            <h2>Dates & Travel for ${memberName}</h2>-->
<!--            <p>Please select the specific dates ${memberName} will be attending (July 2025) and provide arrival/departure times, and travel details.</p>-->

<!--            <div class="form-field-group">-->
<!--                <label>Which dates will ${memberName} be attending?</label>-->
<!--                <div class="flex flex-wrap gap-x-4 gap-y-2">-->
<!--                    <div class="checkbox-option">-->
<!--                        <input type="checkbox" id="attend-08-jul-${memberIndex}" value="2025-07-08" ${member.attendingDates.includes('2025-07-08') ? 'checked' : ''}>-->
<!--                        <label for="attend-08-jul-${memberIndex}">8 July</label>-->
<!--                    </div>-->
<!--                    <div class="checkbox-option">-->
<!--                        <input type="checkbox" id="attend-09-jul-${memberIndex}" value="2025-07-09" ${member.attendingDates.includes('2025-07-09') ? 'checked' : ''}>-->
<!--                        <label for="attend-09-jul-${memberIndex}">9 July</label>-->
<!--                    </div>-->
<!--                    <div class="checkbox-option">-->
<!--                        <input type="checkbox" id="attend-10-jul-${memberIndex}" value="2025-07-10" ${member.attendingDates.includes('2025-07-10') ? 'checked' : ''}>-->
<!--                        <label for="attend-10-jul-${memberIndex}">10 July</label>-->
<!--                    </div>-->
<!--                    <div class="checkbox-option">-->
<!--                        <input type="checkbox" id="attend-11-jul-${memberIndex}" value="2025-07-11" ${member.attendingDates.includes('2025-07-11') ? 'checked' : ''}>-->
<!--                        <label for="attend-11-jul-${memberIndex}">11 July</label>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div id="attending-dates-error-${memberIndex}" class="error-message"></div>-->
<!--            </div>-->

<!--            <div class="form-field-group">-->
<!--                <label>Expected Arrival Time:</label>-->
<!--                <div class="custom-time-input-group">-->
<!--                    <input type="number" id="arrival-hour-${memberIndex}" min="1" max="12" value="${arrival12hr.hour}" class="p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] text-white" placeholder="HH">-->
<!--                    <span class="text-white text-lg font-semibold">:</span>-->
<!--                    <input type="number" id="arrival-minute-${memberIndex}" min="0" max="59" value="${arrival12hr.minute}" class="p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] text-white" placeholder="MM">-->
<!--                    <select id="arrival-ampm-${memberIndex}" class="p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] text-white">-->
<!--                        <option value="AM" ${arrival12hr.ampm === 'AM' ? 'selected' : ''}>AM</option>-->
<!--                        <option value="PM" ${arrival12hr.ampm === 'PM' ? 'selected' : ''}>PM</option>-->
<!--                    </select>-->
<!--                </div>-->
<!--                <div id="arrival-time-error-${memberIndex}" class="error-message"></div>-->
<!--            </div>-->

<!--            <div class="form-field-group">-->
<!--                <label>Expected Departure Time:</label>-->
<!--                <div class="custom-time-input-group">-->
<!--                    <input type="number" id="departure-hour-${memberIndex}" min="1" max="12" value="${departure12hr.hour}" class="p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] text-white" placeholder="HH">-->
<!--                    <span class="text-white text-lg font-semibold">:</span>-->
<!--                    <input type="number" id="departure-minute-${memberIndex}" min="0" max="59" value="${departure12hr.minute}" class="p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] text-white" placeholder="MM">-->
<!--                    <select id="departure-ampm-${memberIndex}" class="p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] text-white">-->
<!--                        <option value="AM" ${departure12hr.ampm === 'AM' ? 'selected' : ''}>AM</option>-->
<!--                        <option value="PM" ${departure12hr.ampm === 'PM' ? 'selected' : ''}>PM</option>-->
<!--                    </select>-->
<!--                </div>-->
<!--                <div id="departure-time-error-${memberIndex}" class="error-message"></div>-->
<!--            </div>-->

<!--            <div class="form-field-group">-->
<!--                <label for="travel-mode-${memberIndex}">How are you coming? (Mode of Transport)</label>-->
<!--                <select id="travel-mode-${memberIndex}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">-->
<!--                    <option value="">Select Mode</option>-->
<!--                    <option value="Car" ${member.modeOfTransport === 'Car' ? 'selected' : ''}>Car</option>-->
<!--                    <option value="Train" ${member.modeOfTransport === 'Train' ? 'selected' : ''}>Train</option>-->
<!--                    <option value="Flight" ${member.modeOfTransport === 'Flight' ? 'selected' : ''}>Flight</option>-->
<!--                    <option value="Bus" ${member.modeOfTransport === 'Bus' ? 'selected' : ''}>Bus</option>-->
<!--                    <option value="Other" ${member.modeOfTransport === 'Other' ? 'selected' : ''}>Other</option>-->
<!--                </select>-->
<!--                <div id="travel-mode-${memberIndex}-error" class="error-message"></div>-->
<!--            </div>-->
<!--            <div class="form-field-group">-->
<!--                <label for="city-of-origin-${memberIndex}">From Where? (City of Origin)</label>-->
<!--                <input type="text" id="city-of-origin-${memberIndex}" value="${member.cityOfOrigin}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="e.g., Pune, Mumbai">-->
<!--                <div id="city-of-origin-${memberIndex}-error" class="error-message"></div>-->
<!--            </div>-->

<!--            <button class="form-button mt-4" onclick="submitArrivalDepartureAndDates(this, ${memberIndex})">Continue</button>-->
<!--        `;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, formId);-->

<!--        // Add Copy From Previous Section-->
<!--        addCopyFromPreviousSection(formElement, memberIndex, formId);-->


<!--        setTimeout(() => {-->
<!--            const firstCheckbox = formElement.querySelector(`input[type="checkbox"][id^="attend-"]`);-->
<!--            if (firstCheckbox) firstCheckbox.focus();-->
<!--        }, 550);-->
<!--    }-->

<!--    /**-->
<!--     * Converts 24-hour time string (HH:MM) to 12-hour object {hour, minute, ampm}.-->
<!--     * @param {string} time24 - Time in 24-hour format (e.g., "14:30").-->
<!--     * @returns {Object} - Object with hour (1-12), minute, and ampm (AM/PM).-->
<!--     */-->
<!--    function convert24hrTo12hr(time24) {-->
<!--        if (!time24) return { hour: '', minute: '', ampm: 'AM' };-->
<!--        const [hour24, minute] = time24.split(':').map(Number);-->
<!--        let hour = hour24 % 12;-->
<!--        hour = hour === 0 ? 12 : hour; // Convert 0 to 12 AM, 12 to 12 PM-->
<!--        const ampm = hour24 < 12 ? 'AM' : 'PM';-->
<!--        return { hour: String(hour).padStart(2, '0'), minute: String(minute).padStart(2, '0'), ampm };-->
<!--    }-->

<!--    /**-->
<!--     * Converts 12-hour components to 24-hour time string (HH:MM).-->
<!--     * @param {string} hour12 - Hour in 12-hour format (1-12).-->
<!--     * @param {string} minute - Minute (00-59).-->
<!--     * @param {string} ampm - "AM" or "PM".-->
<!--     * @returns {string} - Time in 24-hour format (e.g., "14:30").-->
<!--     */-->
<!--    function convert12hrTo24hr(hour12, minute, ampm) {-->
<!--        let hour = parseInt(hour12, 10);-->
<!--        if (ampm === 'PM' && hour !== 12) {-->
<!--            hour += 12;-->
<!--        } else if (ampm === 'AM' && hour === 12) {-->
<!--            hour = 0; // 12 AM (midnight) is 00 in 24-hour-->
<!--        }-->
<!--        return `${String(hour).padStart(2, '0')}:${String(parseInt(minute, 10)).padStart(2, '0')}`;-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of arrival/departure dates and times, plus travel details.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     * @param {number} memberIndex - The index of the current member.-->
<!--     */-->
<!--    function submitArrivalDepartureAndDates(button, memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const formElement = button.closest('.user-input-form');-->
<!--        let isValid = true;-->

<!--        const attendingDatesCheckboxes = Array.from(formElement.querySelectorAll(`input[type="checkbox"][id^="attend-"]:checked`)).map(cb => cb.value);-->
<!--        const attendingDatesError = document.getElementById(`attending-dates-error-${memberIndex}`);-->

<!--        if (attendingDatesCheckboxes.length === 0) {-->
<!--            attendingDatesError.textContent = 'Please select at least one attending date.';-->
<!--            isValid = false;-->
<!--        } else {-->
<!--            attendingDatesError.textContent = '';-->
<!--            // Sort the dates to correctly determine arrival and departure-->
<!--            attendingDatesCheckboxes.sort(); // Sorts YYYY-MM-DD strings lexicographically-->
<!--            member.attendingDates = attendingDatesCheckboxes;-->
<!--            member.arrivalDate = convertDateToDDMMYYYY(new Date(attendingDatesCheckboxes[0] + 'T00:00:00')); // Use 'T00:00:00' to avoid timezone issues-->
<!--            member.departureDate = convertDateToDDMMYYYY(new Date(attendingDatesCheckboxes[attendingDatesCheckboxes.length - 1] + 'T00:00:00'));-->
<!--        }-->

<!--        const arrivalTimeError = document.getElementById(`arrival-time-error-${memberIndex}`);-->
<!--        const departureTimeError = document.getElementById(`departure-time-error-${memberIndex}`);-->
<!--        const travelModeError = document.getElementById(`travel-mode-${memberIndex}-error`);-->
<!--        const cityOfOriginError = document.getElementById(`city-of-origin-${memberIndex}-error`);-->

<!--        // If initial date validation passed, proceed with other validations-->
<!--        if (isValid) {-->
<!--            const arrivalHourInput = document.getElementById(`arrival-hour-${memberIndex}`);-->
<!--            const arrivalMinuteInput = document.getElementById(`arrival-minute-${memberIndex}`);-->
<!--            const arrivalAmPmSelect = document.getElementById(`arrival-ampm-${memberIndex}`);-->

<!--            const departureHourInput = document.getElementById(`departure-hour-${memberIndex}`);-->
<!--            const departureMinuteInput = document.getElementById(`departure-minute-${memberIndex}`);-->
<!--            const departureAmPmSelect = document.getElementById(`departure-ampm-${memberIndex}`);-->

<!--            const travelModeSelect = document.getElementById(`travel-mode-${memberIndex}`);-->
<!--            const cityOfOriginInput = document.getElementById(`city-of-origin-${memberIndex}`);-->

<!--            // Arrival Time Validation-->
<!--            const arrivalHour = arrivalHourInput.value.trim();-->
<!--            const arrivalMinute = arrivalMinuteInput.value.trim();-->
<!--            const arrivalAmPm = arrivalAmPmSelect.value;-->
<!--            if (!arrivalHour || !arrivalMinute || !arrivalAmPm || isNaN(parseInt(arrivalHour)) || parseInt(arrivalHour) < 1 || parseInt(arrivalHour) > 12 || isNaN(parseInt(arrivalMinute)) || parseInt(arrivalMinute) < 0 || parseInt(arrivalMinute) > 59) {-->
<!--                arrivalTimeError.textContent = 'Please enter a valid arrival time (HH:MM AM/PM).';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                arrivalTimeError.textContent = '';-->
<!--                member.arrivalTime = convert12hrTo24hr(arrivalHour, arrivalMinute, arrivalAmPm);-->
<!--            }-->

<!--            // Departure Time Validation-->
<!--            const departureHour = departureHourInput.value.trim();-->
<!--            const departureMinute = departureMinuteInput.value.trim();-->
<!--            const departureAmPm = departureAmPmSelect.value;-->
<!--            if (!departureHour || !departureMinute || !departureAmPm || isNaN(parseInt(departureHour)) || parseInt(departureHour) < 1 || parseInt(departureHour) > 12 || isNaN(parseInt(departureMinute)) || parseInt(departureMinute) < 0 || parseInt(departureMinute) > 59) {-->
<!--                departureTimeError.textContent = 'Please enter a valid departure time (HH:MM AM/PM).';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                departureTimeError.textContent = '';-->
<!--                member.departureTime = convert12hrTo24hr(departureHour, departureMinute, departureAmPm);-->
<!--            }-->

<!--            if (travelModeSelect.value === "") {-->
<!--                travelModeError.textContent = 'Please select a mode of transport.';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                travelModeError.textContent = '';-->
<!--                member.modeOfTransport = travelModeSelect.value;-->
<!--            }-->

<!--            if (cityOfOriginInput.value.trim().length < 2) {-->
<!--                cityOfOriginError.textContent = 'Please enter your city of origin.';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                cityOfOriginError.textContent = '';-->
<!--                member.cityOfOrigin = cityOfOriginInput.value.trim();-->
<!--            }-->
<!--        }-->

<!--        if (isValid) {-->
<!--            disableFormElements(formElement);-->
<!--            button.textContent = 'Submitted!';-->
<!--            addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s travel details confirmed.</span>`);-->

<!--            setTimeout(() => displayAccommodationForm(memberIndex), 1000);-->
<!--        } else {-->
<!--            addInteractionElement('bot-message', `<span>Please correct the highlighted errors.</span>`);-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Displays accommodation questions for a specific member.-->
<!--     * @param {number} memberIndex - The index of the member.-->
<!--     */-->
<!--    function displayAccommodationForm(memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;-->

<!--        const formId = `accommodation-form-${memberIndex}`;-->
<!--        const formHtml = `-->
<!--            <h2>Accommodation for ${memberName}</h2>-->
<!--            <div class="form-field-group">-->
<!--                <label>Will ${memberName} be staying at Swapnapoorti Hall overnight?</label>-->
<!--                <div class="flex items-center space-x-4">-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="stay-yes-${memberIndex}" name="stay-at-hall-${memberIndex}" value="yes" ${member.stayAtHall ? 'checked' : ''}>-->
<!--                        <label for="stay-yes-${memberIndex}">Yes</label>-->
<!--                    </div>-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="stay-no-${memberIndex}" name="stay-at-hall-${memberIndex}" value="no" ${!member.stayAtHall ? 'checked' : ''}>-->
<!--                        <label for="stay-no-${memberIndex}">No</label>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div id="cot-question-${memberIndex}" class="form-field-group ${member.stayAtHall ? '' : 'hidden'}">-->
<!--                <label>Do you require a cot?</label>-->
<!--                <div class="flex items-center space-x-4">-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="cot-yes-${memberIndex}" name="cot-required-${memberIndex}" value="yes" ${member.cotRequired ? 'checked' : ''}>-->
<!--                        <label for="cot-yes-${memberIndex}">Yes</label>-->
<!--                    </div>-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="cot-no-${memberIndex}" name="cot-required-${memberIndex}" value="no" ${!member.cotRequired ? 'checked' : ''}>-->
<!--                        <label for="cot-no-${memberIndex}">No</label>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; New: Difficulty Climbing Stairs &ndash;&gt;-->
<!--            <div class="form-field-group">-->
<!--                <label>Do you have difficulty climbing stairs?</label>-->
<!--                <div class="flex items-center space-x-4">-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="stairs-yes-${memberIndex}" name="difficulty-climbing-stairs-${memberIndex}" value="yes" ${member.difficultyClimbingStairs ? 'checked' : ''}>-->
<!--                        <label for="stairs-yes-${memberIndex}">Yes</label>-->
<!--                    </div>-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="stairs-no-${memberIndex}" name="difficulty-climbing-stairs-${memberIndex}" value="no" ${!member.difficultyClimbingStairs ? 'checked' : ''}>-->
<!--                        <label for="stairs-no-${memberIndex}">No</label>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <button class="form-button mt-4" onclick="submitAccommodation(this, ${memberIndex})">Continue</button>-->
<!--        `;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, formId);-->

<!--        // Add Copy From Previous Section-->
<!--        addCopyFromPreviousSection(formElement, memberIndex, formId);-->

<!--        // Add event listener to show/hide cot question-->
<!--        const stayYesRadio = document.getElementById(`stay-yes-${memberIndex}`);-->
<!--        const stayNoRadio = document.getElementById(`stay-no-${memberIndex}`);-->
<!--        const cotQuestionDiv = document.getElementById(`cot-question-${memberIndex}`);-->

<!--        const toggleCotQuestion = () => {-->
<!--            if (stayYesRadio.checked) {-->
<!--                cotQuestionDiv.classList.remove('hidden');-->
<!--            } else {-->
<!--                cotQuestionDiv.classList.add('hidden');-->
<!--            }-->
<!--        };-->

<!--        if (stayYesRadio && stayNoRadio && cotQuestionDiv) {-->
<!--            stayYesRadio.addEventListener('change', toggleCotQuestion);-->
<!--            stayNoRadio.addEventListener('change', toggleCotQuestion);-->
<!--            toggleCotQuestion(); // Call initially to set correct state-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of accommodation details.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     * @param {number} memberIndex - The index of the current member.-->
<!--     */-->
<!--    function submitAccommodation(button, memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const formElement = button.closest('.user-input-form');-->

<!--        member.stayAtHall = document.querySelector(`input[name="stay-at-hall-${memberIndex}"]:checked`)?.value === 'yes' || false;-->
<!--        if (member.stayAtHall) {-->
<!--            member.cotRequired = document.querySelector(`input[name="cot-required-${memberIndex}"]:checked`)?.value === 'yes' || false;-->
<!--        } else {-->
<!--            member.cotRequired = false; // Reset if not staying at hall-->
<!--        }-->

<!--        // New: Difficulty Climbing Stairs-->
<!--        member.difficultyClimbingStairs = document.querySelector(`input[name="difficulty-climbing-stairs-${memberIndex}"]:checked`)?.value === 'yes' || false;-->

<!--        disableFormElements(formElement);-->
<!--        button.textContent = 'Submitted!';-->
<!--        addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s accommodation details confirmed.</span>`);-->

<!--        // Now, proceed to meal preferences based on stayAtHall-->
<!--        if (member.stayAtHall) {-->
<!--            setTimeout(() => {-->
<!--                addInteractionElement(-->
<!--                    'bot-message',-->
<!--                    `<span>As ${member.firstName} ${member.lastName} will be staying at Swapnapoorti Hall, it is assumed that they will have all morning tea, breakfast, lunch, high tea, and dinner at the Karyalaya itself. You can still customize these preferences below if needed.</span>`,-->
<!--                    null-->
<!--                );-->
<!--                displayMealPreferencesForm(memberIndex, true); // Pass true for auto-tick-->
<!--            }, 1000);-->
<!--        } else {-->
<!--            // Conditional question: "Do you need lunch on 8th?" if attending on 8th AND NOT staying at hall-->
<!--            if (member.attendingDates.includes('2025-07-08')) {-->
<!--                setTimeout(() => {-->
<!--                    addInteractionElement(-->
<!--                        'bot-message',-->
<!--                        `<span>As ${member.firstName} ${member.lastName} will be attending on 8th July, do they need afternoon lunch on that day?</span>`,-->
<!--                        null-->
<!--                    );-->
<!--                    displayLunchOn8thForm(memberIndex);-->
<!--                }, 1000);-->
<!--            } else {-->
<!--                // If not attending on 8th, proceed directly to general meal preferences-->
<!--                setTimeout(() => displayMealPreferencesForm(memberIndex, false), 1000);-->
<!--            }-->
<!--        }-->
<!--    }-->


<!--    /**-->
<!--     * Displays a form asking if lunch is needed on July 8th (if attending on that day).-->
<!--     * This is only for non-hall stayers.-->
<!--     * @param {number} memberIndex - The index of the member.-->
<!--     */-->
<!--    function displayLunchOn8thForm(memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const formId = `lunch-8th-form-${memberIndex}`;-->
<!--        const formHtml = `-->
<!--            <h2>Lunch on 8th July for ${member.firstName} ${member.lastName}?</h2>-->
<!--            <p>Since ${member.firstName} ${member.lastName} will be attending on July 8th, would they like lunch on that day?</p>-->
<!--            <div class="space-y-4">-->
<!--                <div class="radio-option">-->
<!--                    <input type="radio" id="lunch-8th-yes-${memberIndex}" name="lunch-8th-${memberIndex}" value="yes" ${member.mealPreferences['2025-07-08']?.lunch ? 'checked' : ''}>-->
<!--                    <label for="lunch-8th-yes-${memberIndex}">Yes, I need lunch.</label>-->
<!--                </div>-->
<!--                <div class="radio-option">-->
<!--                    <input type="radio" id="lunch-8th-no-${memberIndex}" name="lunch-8th-${memberIndex}" value="no" ${!member.mealPreferences['2025-07-08']?.lunch ? 'checked' : ''}>-->
<!--                    <label for="lunch-8th-no-${memberIndex}">No, thank you.</label>-->
<!--                </div>-->
<!--            </div>-->
<!--            <button class="form-button mt-4" onclick="submitLunchOn8th(this, ${memberIndex})">Submit</button>-->
<!--        `;-->
<!--        addInteractionElement('user-input-form', formHtml, formId);-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of lunch preference for July 8th.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     * @param {number} memberIndex - The index of the member.-->
<!--     */-->
<!--    function submitLunchOn8th(button, memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const lunchOn8th = document.querySelector(`input[name="lunch-8th-${memberIndex}"]:checked`)?.value === 'yes' || false;-->
<!--        const formElement = button.closest('.user-input-form');-->

<!--        disableFormElements(formElement);-->
<!--        button.textContent = 'Submitted!';-->
<!--        addInteractionElement('user-input-form', `<span>Lunch on 8th July for ${member.firstName} ${member.lastName}: ${lunchOn8th ? 'Yes' : 'No'}</span>`);-->

<!--        const july8thYYYYMMDD = '2025-07-08';-->
<!--        // Initialize meal preferences for 8th July if it's not already there-->
<!--        if (!member.mealPreferences[july8thYYYYMMDD]) {-->
<!--            member.mealPreferences[july8thYYYYMMDD] = { breakfast: false, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'none', teaCoffeeSugar: 'sugar', packedFood: false };-->
<!--        }-->
<!--        member.mealPreferences[july8thYYYYMMDD].lunch = lunchOn8th;-->

<!--        setTimeout(() => displayMealPreferencesForm(memberIndex, false), 1000); // Now proceed to full meal prefs, explicitly NOT auto-ticking-->
<!--    }-->


<!--    /**-->
<!--     * Displays meal preferences form for a specific member based on their attending dates.-->
<!--     * @param {number} memberIndex - The index of the member.-->
<!--     * @param {boolean} [autoTickMeals=false] - If true, pre-selects all meals and coffee/sugar.-->
<!--     */-->
<!--    function displayMealPreferencesForm(memberIndex, autoTickMeals = false) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;-->
<!--        const attendingDatesYYYYMMDD = member.attendingDates; // Array of YYYY-MM-DD strings-->
<!--        const derivedDepartureDateYYYYMMDD = attendingDatesYYYYMMDD.length > 0 ? attendingDatesYYYYMMDD[attendingDatesYYYYMMDD.length - 1] : '';-->

<!--        const formId = `meal-preferences-form-${memberIndex}`;-->
<!--        let formHtml = `-->
<!--            <h2>Meal Preferences for ${memberName}</h2>-->
<!--            <p>Please select meal and drink preferences for each day ${memberName} will be attending.</p>-->
<!--        `;-->

<!--        // Pre-fill existing morning tea/coffee preferences or set auto-tick defaults-->
<!--        const defaultMorningTeaCoffeePref = autoTickMeals ? 'coffee' : (member.morningTeaCoffee.preference || 'none');-->
<!--        const defaultMorningTeaCoffeeSugar = autoTickMeals ? 'sugar' : (member.morningTeaCoffee.sugar || 'sugar');-->

<!--        formHtml += `-->
<!--            <div class="timetable-entry">-->
<!--                <h3>Morning Tea/Coffee</h3>-->
<!--                <div class="form-field-group">-->
<!--                    <label>Preference:</label>-->
<!--                    <div class="flex items-center space-x-4">-->
<!--                        <div class="radio-option">-->
<!--                            <input type="radio" id="morning-tea-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="tea" ${defaultMorningTeaCoffeePref === 'tea' ? 'checked' : ''}>-->
<!--                            <label for="morning-tea-${memberIndex}">Tea</label>-->
<!--                        </div>-->
<!--                        <div class="radio-option">-->
<!--                            <input type="radio" id="morning-coffee-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="coffee" ${defaultMorningTeaCoffeePref === 'coffee' ? 'checked' : ''}>-->
<!--                            <label for="morning-coffee-${memberIndex}">Coffee</label>-->
<!--                        </div>-->
<!--                        <div class="radio-option">-->
<!--                            <input type="radio" id="morning-both-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="both" ${defaultMorningTeaCoffeePref === 'both' ? 'checked' : ''}>-->
<!--                            <label for="morning-both-${memberIndex}">Both</label>-->
<!--                        </div>-->
<!--                        <div class="radio-option">-->
<!--                            <input type="radio" id="morning-none-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="none" ${defaultMorningTeaCoffeePref === 'none' ? 'checked' : ''}>-->
<!--                            <label for="morning-none-${memberIndex}">None</label>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div id="morning-sugar-question-${memberIndex}" class="form-field-group mt-2 ${['tea', 'coffee', 'both'].includes(defaultMorningTeaCoffeePref) ? '' : 'hidden'}">-->
<!--                    <label>Sugar Preference:</label>-->
<!--                    <div class="flex items-center space-x-4">-->
<!--                        <div class="radio-option">-->
<!--                            <input type="radio" id="morning-sugar-yes-${memberIndex}" name="morning-tea-coffee-sugar-${memberIndex}" value="sugar" ${defaultMorningTeaCoffeeSugar === 'sugar' ? 'checked' : ''}>-->
<!--                            <label for="morning-sugar-yes-${memberIndex}">With Sugar</label>-->
<!--                        </div>-->
<!--                        <div class="radio-option">-->
<!--                            <input type="radio" id="morning-sugar-no-${memberIndex}" name="morning-tea-coffee-sugar-${memberIndex}" value="no-sugar" ${defaultMorningTeaCoffeeSugar === 'no-sugar' ? 'checked' : ''}>-->
<!--                            <label for="morning-sugar-no-${memberIndex}">No Sugar</label>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        `;-->


<!--        if (attendingDatesYYYYMMDD.length === 0) {-->
<!--            formHtml += `<p class="text-yellow-200">No dates selected for this person. Please go back and select dates.</p>`;-->
<!--        } else {-->
<!--            attendingDatesYYYYMMDD.forEach(dateYYYYMMDD => {-->
<!--                const date = new Date(dateYYYYMMDD + 'T00:00:00'); // Ensure consistent date parsing-->
<!--                const displayDate = date.toLocaleDateString('en-IN', { weekday: 'short', month: 'short', day: 'numeric' });-->
<!--                const isDepartureDay = dateYYYYMMDD === derivedDepartureDateYYYYMMDD;-->

<!--                // Pre-fill existing preferences or set auto-tick defaults-->
<!--                const existingPrefs = member.mealPreferences[dateYYYYMMDD] || {};-->
<!--                const defaultBreakfast = autoTickMeals ? true : (existingPrefs.breakfast || false);-->
<!--                const defaultLunch = autoTickMeals ? true : (existingPrefs.lunch || false);-->
<!--                const defaultHighTea = autoTickMeals ? true : (existingPrefs.highTea || false);-->
<!--                const defaultDinner = autoTickMeals ? true : (existingPrefs.dinner || false);-->
<!--                const defaultTeaCoffeePreference = autoTickMeals ? 'coffee' : (existingPrefs.teaCoffeePreference || 'none'); // Default to coffee-->
<!--                const defaultTeaCoffeeSugar = autoTickMeals ? 'sugar' : (existingPrefs.teaCoffeeSugar || 'sugar'); // Default to sugar-->
<!--                const defaultPackedFood = autoTickMeals ? false : (existingPrefs.packedFood || false); // Don't auto-tick packed food-->

<!--                formHtml += `-->
<!--                    <div class="timetable-entry">-->
<!--                        <h3>${displayDate}</h3>-->
<!--                        <div class="form-field-group">-->
<!--                            <label>Meals:</label>-->
<!--                            <div class="flex flex-wrap gap-x-4 gap-y-2">-->
<!--                                ${dateYYYYMMDD !== '2025-07-08' ? `-->
<!--                                <div class="checkbox-option">-->
<!--                                    <input type="checkbox" id="breakfast-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-breakfast" value="yes" ${defaultBreakfast ? 'checked' : ''}>-->
<!--                                    <label for="breakfast-${memberIndex}-${dateYYYYMMDD}">Breakfast</label>-->
<!--                                </div>-->
<!--                                ` : ''}-->
<!--                                <div class="checkbox-option">-->
<!--                                    <input type="checkbox" id="lunch-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-lunch" value="yes" ${defaultLunch ? 'checked' : ''}>-->
<!--                                    <label for="lunch-${memberIndex}-${dateYYYYMMDD}">Lunch</label>-->
<!--                                </div>-->
<!--                                <div class="checkbox-option">-->
<!--                                    <input type="checkbox" id="high-tea-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-highTea" value="yes" ${defaultHighTea ? 'checked' : ''}>-->
<!--                                    <label for="high-tea-${memberIndex}-${dateYYYYMMDD}">High Tea</label>-->
<!--                                </div>-->
<!--                                <div class="checkbox-option">-->
<!--                                    <input type="checkbox" id="dinner-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-dinner" value="yes" ${defaultDinner ? 'checked' : ''}>-->
<!--                                    <label for="dinner-${memberIndex}-${dateYYYYMMDD}">Dinner</label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="form-field-group">-->
<!--                            <label>Tea/Coffee Preference (During meals):</label>-->
<!--                            <div class="flex items-center space-x-4">-->
<!--                                <div class="radio-option">-->
<!--                                    <input type="radio" id="tea-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="tea" ${defaultTeaCoffeePreference === 'tea' ? 'checked' : ''}>-->
<!--                                    <label for="tea-${memberIndex}-${dateYYYYMMDD}">Tea</label>-->
<!--                                </div>-->
<!--                                <div class="radio-option">-->
<!--                                    <input type="radio" id="coffee-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="coffee" ${defaultTeaCoffeePreference === 'coffee' ? 'checked' : ''}>-->
<!--                                    <label for="coffee-${memberIndex}-${dateYYYYMMDD}">Coffee</label>-->
<!--                                </div>-->
<!--                                <div class="radio-option">-->
<!--                                    <input type="radio" id="both-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="both" ${defaultTeaCoffeePreference === 'both' ? 'checked' : ''}>-->
<!--                                    <label for="both-${memberIndex}-${dateYYYYMMDD}">Both</label>-->
<!--                                </div>-->
<!--                                <div class="radio-option">-->
<!--                                    <input type="radio" id="none-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="none" ${defaultTeaCoffeePreference === 'none' ? 'checked' : ''}>-->
<!--                                    <label for="none-${memberIndex}-${dateYYYYMMDD}">None</label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div id="sugar-question-${memberIndex}-${dateYYYYMMDD}" class="form-field-group mt-2 ${['tea', 'coffee', 'both'].includes(defaultTeaCoffeePreference) ? '' : 'hidden'}">-->
<!--                            <label>Sugar Preference (During meals):</label>-->
<!--                            <div class="flex items-center space-x-4">-->
<!--                                <div class="radio-option">-->
<!--                                    <input type="radio" id="sugar-yes-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}" value="sugar" ${defaultTeaCoffeeSugar === 'sugar' ? 'checked' : ''}>-->
<!--                                    <label for="sugar-yes-${memberIndex}-${dateYYYYMMDD}">With Sugar</label>-->
<!--                                </div>-->
<!--                                <div class="radio-option">-->
<!--                                    <input type="radio" id="sugar-no-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}" value="no-sugar" ${defaultTeaCoffeeSugar === 'no-sugar' ? 'checked' : ''}>-->
<!--                                    <label for="sugar-no-${memberIndex}-${dateYYYYMMDD}">No Sugar</label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        ${isDepartureDay ? `-->
<!--                            <div class="form-field-group">-->
<!--                                <label>Need Packed Lunch/Dinner while leaving?</label>-->
<!--                                <div class="flex items-center space-x-4">-->
<!--                                    <div class="radio-option">-->
<!--                                        <input type="radio" id="packed-food-yes-${memberIndex}-${dateYYYYMMDD}" name="packed-food-${memberIndex}-${dateYYYYMMDD}" value="yes" ${defaultPackedFood ? 'checked' : ''}>-->
<!--                                        <label for="packed-food-yes-${memberIndex}-${dateYYYYMMDD}">Yes</label>-->
<!--                                    </div>-->
<!--                                    <div class="radio-option">-->
<!--                                        <input type="radio" id="packed-food-no-${memberIndex}-${dateYYYYMMDD}" name="packed-food-${memberIndex}-${dateYYYYMMDD}" value="no" ${!defaultPackedFood ? 'checked' : ''}>-->
<!--                                        <label for="packed-food-no-${memberIndex}-${dateYYYYMMDD}">No</label>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        ` : ''}-->
<!--                    </div>-->
<!--                `;-->
<!--            });-->
<!--        }-->

<!--        formHtml += `<button class="form-button mt-6" onclick="submitMealPreferences(this, ${memberIndex})">Submit Preferences for ${memberName}</button>`;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, formId);-->

<!--        // Add Copy From Previous Section-->
<!--        addCopyFromPreviousSection(formElement, memberIndex, formId);-->


<!--        // Add event listeners for morning tea/coffee sugar preference visibility-->
<!--        const morningTeaCoffeeRadios = formElement.querySelectorAll(`input[name="morning-tea-coffee-${memberIndex}"]`);-->
<!--        const morningSugarQuestionDiv = document.getElementById(`morning-sugar-question-${memberIndex}`);-->
<!--        if (morningTeaCoffeeRadios && morningSugarQuestionDiv) {-->
<!--            morningTeaCoffeeRadios.forEach(radio => {-->
<!--                radio.addEventListener('change', () => {-->
<!--                    if (['tea', 'coffee', 'both'].includes(radio.value)) {-->
<!--                        morningSugarQuestionDiv.classList.remove('hidden');-->
<!--                    } else {-->
<!--                        morningSugarQuestionDiv.classList.add('hidden');-->
<!--                        formElement.querySelectorAll(`input[name="morning-tea-coffee-sugar-${memberIndex}"]`).forEach(sugRadio => sugRadio.checked = false);-->
<!--                    }-->
<!--                });-->
<!--            });-->
<!--        }-->

<!--        // Add event listeners for tea/coffee sugar preference visibility (during meals)-->
<!--        attendingDatesYYYYMMDD.forEach(dateYYYYMMDD => {-->
<!--            const teaCoffeeRadios = formElement.querySelectorAll(`input[name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}"]`);-->
<!--            const sugarQuestionDiv = document.getElementById(`sugar-question-${memberIndex}-${dateYYYYMMDD}`);-->
<!--            if (teaCoffeeRadios && sugarQuestionDiv) {-->
<!--                teaCoffeeRadios.forEach(radio => {-->
<!--                    radio.addEventListener('change', () => {-->
<!--                        if (['tea', 'coffee', 'both'].includes(radio.value)) {-->
<!--                            sugarQuestionDiv.classList.remove('hidden');-->
<!--                        } else {-->
<!--                            sugarQuestionDiv.classList.add('hidden');-->
<!--                            // Optionally uncheck sugar preferences if "None" is selected-->
<!--                            formElement.querySelectorAll(`input[name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}"]`).forEach(sugRadio => sugRadio.checked = false);-->
<!--                        }-->
<!--                    });-->
<!--                });-->
<!--            }-->
<!--        });-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of meal preferences for a specific member.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     * @param {number} memberIndex - The index of the current member.-->
<!--     */-->
<!--    function submitMealPreferences(button, memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const formElement = button.closest('.user-input-form');-->
<!--        member.mealPreferences = {}; // Reset before collecting-->

<!--        // Capture Morning Tea/Coffee-->
<!--        const morningTeaCoffeePref = document.querySelector(`input[name="morning-tea-coffee-${memberIndex}"]:checked`)?.value || 'none';-->
<!--        let morningTeaCoffeeSug = 'sugar';-->
<!--        if(['tea', 'coffee', 'both'].includes(morningTeaCoffeePref)) {-->
<!--            morningTeaCoffeeSug = document.querySelector(`input[name="morning-tea-coffee-sugar-${memberIndex}"]:checked`)?.value || 'sugar';-->
<!--        }-->
<!--        member.morningTeaCoffee = { preference: morningTeaCoffeePref, sugar: morningTeaCoffeeSug };-->


<!--        member.attendingDates.forEach(dateYYYYMMDD => {-->
<!--            const derivedDepartureDateYYYYMMDD = member.attendingDates.length > 0 ? member.attendingDates[member.attendingDates.length - 1] : '';-->
<!--            const isDepartureDay = dateYYYYMMDD === derivedDepartureDateYYYYMMDD;-->

<!--            const teaCoffeePref = document.querySelector(`input[name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}"]:checked`)?.value || 'none';-->
<!--            let teaCoffeeSug = 'sugar'; // Default sugar-->
<!--            if(['tea', 'coffee', 'both'].includes(teaCoffeePref)) {-->
<!--                teaCoffeeSug = document.querySelector(`input[name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}"]:checked`)?.value || 'sugar';-->
<!--            }-->

<!--            member.mealPreferences[dateYYYYMMDD] = {-->
<!--                breakfast: (dateYYYYMMDD !== '2025-07-08' && document.getElementById(`breakfast-${memberIndex}-${dateYYYYMMDD}`)) ? document.getElementById(`breakfast-${memberIndex}-${dateYYYYMMDD}`).checked : false, // Exclude breakfast for July 8th-->
<!--                lunch: document.getElementById(`lunch-${memberIndex}-${dateYYYYMMDD}`)?.checked || false,-->
<!--                highTea: document.getElementById(`high-tea-${memberIndex}-${dateYYYYMMDD}`)?.checked || false,-->
<!--                dinner: document.getElementById(`dinner-${memberIndex}-${dateYYYYMMDD}`)?.checked || false,-->
<!--                teaCoffeePreference: teaCoffeePref,-->
<!--                teaCoffeeSugar: teaCoffeeSug,-->
<!--            };-->

<!--            // Only add packed food if it was an option for this day (i.e., it's the departure date for this member)-->
<!--            if (isDepartureDay && document.querySelector(`input[name="packed-food-yes-${memberIndex}-${dateYYYYMMDD}"]`)) {-->
<!--                 member.mealPreferences[dateYYYYMMDD].packedFood = document.querySelector(`input[name="packed-food-${memberIndex}-${dateYYYYMMDD}"]:checked`)?.value === 'yes' || false;-->
<!--            } else {-->
<!--                 member.mealPreferences[dateYYYYMMDD].packedFood = false; // Ensure it's false if not on departure day or option not present-->
<!--            }-->
<!--        });-->

<!--        disableFormElements(formElement);-->
<!--        button.textContent = 'Submitted!';-->
<!--        addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s meal preferences confirmed.</span>`);-->

<!--        setTimeout(() => displayLocalAssistanceForm(memberIndex), 1000);-->
<!--    }-->

<!--    /**-->
<!--     * Displays local travel assistance and recordings questions for a member.-->
<!--     * @param {number} memberIndex - The index of the member.-->
<!--     */-->
<!--    function displayLocalAssistanceForm(memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;-->

<!--        // Updated assistance options to show name and mobile number-->
<!--        let assistanceOptionsHtml = dummySamparkGroupContacts.map(contact =>-->
<!--            `<option value="${contact.name}" ${member.localAssistance === contact.name ? 'selected' : ''}>${contact.name} (${contact.mobile})</option>`-->
<!--        ).join('');-->

<!--        // Use textarea for recordings-->
<!--        const recordingsInputHtml = `-->
<!--            <div class="form-field-group">-->
<!--                <label for="recordings-text-${memberIndex}">Programs for which you need recordings (enter names, separated by commas if multiple):</label>-->
<!--                <textarea id="recordings-text-${memberIndex}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" rows="3" placeholder="e.g., Morning Lecture on Bhagavad-Gita, Evening Kirtan of Vraja-dhama">${member.recordingsNeeded || ''}</textarea>-->
<!--            </div>-->
<!--        `;-->

<!--        // New: Special requests Yes/No with conditional textarea-->
<!--        const specialRequestsToggleId = `special-requests-toggle-${memberIndex}`;-->
<!--        const specialRequestsTextareaId = `special-requests-text-${memberIndex}`;-->
<!--        const initialSpecialRequestsChecked = member.specialRequests && member.specialRequests.trim() !== '';-->

<!--        const specialRequestsHtml = `-->
<!--            <div class="form-field-group">-->
<!--                <label>Do you have any special requests?</label>-->
<!--                <div class="flex items-center space-x-4">-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="${specialRequestsToggleId}-yes" name="${specialRequestsToggleId}" value="yes" ${initialSpecialRequestsChecked ? 'checked' : ''}>-->
<!--                        <label for="${specialRequestsToggleId}-yes">Yes</label>-->
<!--                    </div>-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="${specialRequestsToggleId}-no" name="${specialRequestsToggleId}" value="no" ${!initialSpecialRequestsChecked ? 'checked' : ''}>-->
<!--                        <label for="${specialRequestsToggleId}-no">No</label>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div id="${specialRequestsTextareaId}-container" class="form-field-group ${initialSpecialRequestsChecked ? '' : 'hidden'}">-->
<!--                <label for="${specialRequestsTextareaId}">Please describe your special requests:</label>-->
<!--                <textarea id="${specialRequestsTextareaId}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" rows="3" placeholder="e.g., Needs hot water for medication, special meal requirement">${member.specialRequests || ''}</textarea>-->
<!--            </div>-->
<!--        `;-->

<!--        const formId = `local-assistance-form-${memberIndex}`;-->
<!--        const formHtml = `-->
<!--            <h2>Local Assistance & Recordings for ${memberName}</h2>-->
<!--            <div class="form-field-group">-->
<!--                <label>Do you need any local travel assistance?</label>-->
<!--                <div class="flex items-center space-x-4">-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="assistance-yes-${memberIndex}" name="local-assistance-choice-${memberIndex}" value="yes" ${member.localAssistance ? 'checked' : ''}>-->
<!--                        <label for="assistance-yes-${memberIndex}">Yes</label>-->
<!--                    </div>-->
<!--                    <div class="radio-option">-->
<!--                        <input type="radio" id="assistance-no-${memberIndex}" name="local-assistance-choice-${memberIndex}" value="no" ${!member.localAssistance ? 'checked' : ''}>-->
<!--                        <label for="assistance-no-${memberIndex}">No</label>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div id="assistance-dropdown-${memberIndex}" class="form-field-group ${member.localAssistance ? '' : 'hidden'}">-->
<!--                <label for="local-assistance-mode-${memberIndex}">Which person from Sampark Group can assist?</label>-->
<!--                <select id="local-assistance-mode-${memberIndex}" class="w-full p-3 rounded-xl bg-[var(&#45;&#45;form-field-bg)] border border-[var(&#45;&#45;glass-border)] text-[var(&#45;&#45;text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">-->
<!--                    <option value="">Select Person</option>-->
<!--                    ${assistanceOptionsHtml}-->
<!--                </select>-->
<!--                <div id="local-assistance-error-${memberIndex}" class="error-message"></div>-->
<!--            </div>-->

<!--            ${recordingsInputHtml} &lt;!&ndash; Textarea for recordings &ndash;&gt;-->
<!--            ${specialRequestsHtml} &lt;!&ndash; Special requests conditional &ndash;&gt;-->

<!--            <button class="form-button mt-4" onclick="submitLocalAssistance(this, ${memberIndex})">Continue</button>-->
<!--        `;-->
<!--        const formElement = addInteractionElement('user-input-form', formHtml, formId);-->

<!--        // Add Copy From Previous Section-->
<!--        addCopyFromPreviousSection(formElement, memberIndex, formId);-->


<!--        // Add event listeners for conditional display-->
<!--        const assistanceYesRadio = document.getElementById(`assistance-yes-${memberIndex}`);-->
<!--        const assistanceNoRadio = document.getElementById(`assistance-no-${memberIndex}`);-->
<!--        const assistanceDropdownDiv = document.getElementById(`assistance-dropdown-${memberIndex}`);-->

<!--        const toggleAssistanceDropdown = () => {-->
<!--            if (assistanceYesRadio.checked) {-->
<!--                assistanceDropdownDiv.classList.remove('hidden');-->
<!--            } else {-->
<!--                assistanceDropdownDiv.classList.add('hidden');-->
<!--                document.getElementById(`local-assistance-mode-${memberIndex}`).value = ''; // Clear selection-->
<!--            }-->
<!--        };-->
<!--        if (assistanceYesRadio && assistanceNoRadio && assistanceDropdownDiv) {-->
<!--            assistanceYesRadio.addEventListener('change', toggleAssistanceDropdown);-->
<!--            assistanceNoRadio.addEventListener('change', toggleAssistanceDropdown);-->
<!--            toggleAssistanceDropdown(); // Initial call-->
<!--        }-->

<!--        // Special requests toggle listener-->
<!--        const specialRequestsToggleYes = document.getElementById(`${specialRequestsToggleId}-yes`);-->
<!--        const specialRequestsToggleNo = document.getElementById(`${specialRequestsToggleId}-no`);-->
<!--        const specialRequestsTextareaContainer = document.getElementById(`${specialRequestsTextareaId}-container`);-->
<!--        if (specialRequestsToggleYes && specialRequestsToggleNo && specialRequestsTextareaContainer) {-->
<!--            const toggleSpecialRequestsTextarea = () => {-->
<!--                if (specialRequestsToggleYes.checked) {-->
<!--                    specialRequestsTextareaContainer.classList.remove('hidden');-->
<!--                } else {-->
<!--                    specialRequestsTextareaContainer.classList.add('hidden');-->
<!--                    document.getElementById(specialRequestsTextareaId).value = ''; // Clear textarea if No-->
<!--                }-->
<!--            };-->
<!--            specialRequestsToggleYes.addEventListener('change', toggleSpecialRequestsTextarea);-->
<!--            specialRequestsToggleNo.addEventListener('change', toggleSpecialRequestsTextarea);-->
<!--            toggleSpecialRequestsTextarea(); // Initial call-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Handles submission of local assistance and recordings details.-->
<!--     * @param {HTMLButtonElement} button - The button that triggered the submission.-->
<!--     * @param {number} memberIndex - The index of the current member.-->
<!--     */-->
<!--    function submitLocalAssistance(button, memberIndex) {-->
<!--        const member = registrationData.travelDetails.members[memberIndex];-->
<!--        const formElement = button.closest('.user-input-form');-->
<!--        let isValid = true;-->

<!--        // Local Assistance-->
<!--        const assistanceChoice = document.querySelector(`input[name="local-assistance-choice-${memberIndex}"]:checked`)?.value;-->
<!--        if (assistanceChoice === 'yes') {-->
<!--            const assistanceMode = document.getElementById(`local-assistance-mode-${memberIndex}`).value;-->
<!--            const assistanceError = document.getElementById(`local-assistance-error-${memberIndex}`);-->
<!--            if (assistanceMode === "") {-->
<!--                assistanceError.textContent = 'Please select a mode of assistance.';-->
<!--                isValid = false;-->
<!--            } else {-->
<!--                assistanceError.textContent = '';-->
<!--                member.localAssistance = assistanceMode;-->
<!--            }-->
<!--        } else {-->
<!--            member.localAssistance = '';-->
<!--        }-->

<!--        // Recordings Needed (now a string from textarea)-->
<!--        member.recordingsNeeded = document.getElementById(`recordings-text-${memberIndex}`).value.trim();-->

<!--        // Special Requests (conditional textarea)-->
<!--        const specialRequestsToggle = document.querySelector(`input[name="special-requests-toggle-${memberIndex}"]:checked`)?.value;-->
<!--        member.specialRequests = (specialRequestsToggle === 'yes') ? document.getElementById(`special-requests-text-${memberIndex}`).value.trim() : '';-->


<!--        if (isValid) {-->
<!--            disableFormElements(formElement);-->
<!--            button.textContent = 'Submitted!';-->
<!--            addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s assistance, recordings, and special requests preferences confirmed.</span>`);-->

<!--            // Move to the next member or to confirm booking-->
<!--            currentMemberIndex++;-->
<!--            if (currentMemberIndex < registrationData.travelDetails.members.length) {-->
<!--                setTimeout(() => {-->
<!--                    addInteractionElement(-->
<!--                        'bot-message',-->
<!--                        `<span>Now, let's get the remaining details for ${registrationData.travelDetails.members[currentMemberIndex].firstName} ${registrationData.travelDetails.members[currentMemberIndex].lastName}.</span>`,-->
<!--                        null-->
<!--                    );-->
<!--                    displayArrivalDepartureAndDatesForm(currentMemberIndex);-->
<!--                }, 1000);-->
<!--            } else {-->
<!--                // All members processed, confirm booking-->
<!--                setTimeout(() => displaySummaryAndConfirmForm(), 1000); // Changed to display summary-->
<!--            }-->
<!--        } else {-->
<!--            addInteractionElement('bot-message', `<span>Please correct the highlighted errors.</span>`);-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Generates a unique registration ID.-->
<!--     * @returns {string} The generated registration ID.-->
<!--     */-->
<!--    function generateUUID() {-->
<!--        if (typeof crypto !== 'undefined' && crypto.randomUUID) {-->
<!--            return `REG-2025-${crypto.randomUUID().slice(0, 8).toUpperCase()}`; // Shorter UUID for ID-->
<!--        } else {-->
<!--            // Fallback for environments without crypto.randomUUID (e.g., older browsers)-->
<!--            let dt = new Date().getTime();-->
<!--            const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {-->
<!--                const r = (dt + Math.random() * 16) % 16 | 0;-->
<!--                dt = Math.floor(dt / 16);-->
<!--                return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);-->
<!--            });-->
<!--            return `REG-2025-${uuid.slice(0, 8).toUpperCase()}`;-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Simulates saving/updating registration data to DynamoDB via a backend API.-->
<!--     * @param {Object} data - The registration data to save.-->
<!--     * @param {boolean} isUpdate - True if this is an update to an existing registration.-->
<!--     */-->
<!--    async function saveRegistrationToDynamoDB(data) {-->
<!--        const DYNAMODB_API_ENDPOINT = 'http://localhost:8000/register'; // Update if deployed-->

<!--        try {-->
<!--        const response = await fetch(DYNAMODB_API_ENDPOINT, {-->
<!--            method: 'POST',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json'-->
<!--            },-->
<!--            body: JSON.stringify(data)-->
<!--        });-->

<!--        if (response.ok) {-->
<!--            const result = await response.json();-->
<!--            console.log('✅ Registration uploaded successfully:', result);-->
<!--            displayMessage('Registration data uploaded successfully!', 'success');-->

<!--            // Optional: Show confirmation screen-->
<!--            showFullScreenSuccessAnimation(() => {-->
<!--                // Now directly show the ticket confirmation after green screen animation-->
<!--                displayTicketConfirmation();-->
<!--            });-->

<!--        } else {-->
<!--            const errorData = await response.json();-->
<!--            console.error('❌ Failed to upload registration:', response.status, errorData);-->
<!--            displayMessage(`Failed to upload registration: ${errorData.message || response.statusText}`, 'error');-->
<!--        }-->
<!--    } catch (error) {-->
<!--        console.error('❌ Error uploading registration to DynamoDB:', error);-->
<!--        displayMessage('An error occurred while uploading registration. Please try again.', 'error');-->
<!--    }-->
<!--}-->


<!--    /**-->
<!--     * Confirms the booking and displays the final ID.-->
<!--     * @param {HTMLButtonElement} [button] - The button that triggered the submission (optional).-->
<!--     */-->
<!--    async function confirmBooking(button = null) {-->
<!--        if (button) {-->
<!--            const formElement = button.closest('.user-input-form');-->
<!--            disableFormElements(formElement, true); // Permanently disable after booking-->
<!--            addInteractionElement('user-input-form', `<span>Confirmed! Proceeding to booking...</span>`);-->
<!--        }-->

<!--        console.log("Booking confirmed! Attempting to save data:", registrationData);-->

<!--        // Always generate new ID if it's a new registration-->
<!--        // `isEditingExisting` is always false on this page now.-->
<!--        registrationData.registrationId = generateUUID();-->

<!--        // Call the simulated DynamoDB save/update function-->
<!--        await saveRegistrationToDynamoDB(registrationData);-->
<!--    }-->

<!--    /**-->
<!--     * Displays a summary of all registration details before final confirmation.-->
<!--     */-->
<!--    function displaySummaryAndConfirmForm() {-->
<!--        let summaryHtml = `-->
<!--            <h2>Review Your Registration Details</h2>-->
<!--            <p>Please review all the details below before confirming your registration.</p>-->

<!--            <div class="summary-section">-->
<!--                <h3><i class="fas fa-id-badge mr-2"></i>Main Registrant Details</h3>-->
<!--                <p><strong>Name:</strong> <span>${registrationData.mainRegistrant.firstName} ${registrationData.mainRegistrant.lastName}</span></p>-->
<!--                <p><strong>Mobile:</strong> <span>${registrationData.mainRegistrant.mobile}</span></p>-->
<!--                <p><strong>Reference 1:</strong> <span>${registrationData.mainRegistrant.ref1 || 'N/A'}</span></p>-->
<!--                <p><strong>Reference 2:</strong> <span>${registrationData.mainRegistrant.ref2 || 'N/A'}</span></p>-->
<!--            </div>-->
<!--        `;-->

<!--        registrationData.travelDetails.members.forEach((member, index) => {-->
<!--            const mealsSummary = member.attendingDates.map(dateYYYYMMDD => {-->
<!--                const prefs = member.mealPreferences[dateYYYYMMDD];-->
<!--                const displayDate = new Date(dateYYYYMMDD + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });-->

<!--                const mealList = [];-->
<!--                // Only include breakfast if it's not July 8th and selected-->
<!--                if (dateYYYYMMDD !== '2025-07-08' && prefs && prefs.breakfast) mealList.push('Breakfast');-->
<!--                if (prefs && prefs.lunch) mealList.push('Lunch');-->
<!--                if (prefs && prefs.highTea) mealList.push('High Tea');-->
<!--                if (prefs && prefs.dinner) mealList.push('Dinner');-->

<!--                const mealsStr = mealList.length > 0 ? mealList.join(', ') : 'No Meals';-->

<!--                const teaCoffeeDisplay = (prefs && prefs.teaCoffeePreference === 'none') || !prefs ? 'None' : `${prefs.teaCoffeePreference.charAt(0).toUpperCase() + prefs.teaCoffeePreference.slice(1)} (Sugar: ${prefs.teaCoffeeSugar === 'sugar' ? 'Yes' : 'No'})`;-->

<!--                return `<li><strong>${displayDate}:</strong> ${mealsStr} (Beverage: ${teaCoffeeDisplay}) ${prefs && prefs.packedFood ? '(Packed Meal)' : ''}</li>`;-->
<!--            }).join('');-->

<!--            const morningTeaCoffeeDisplay = registrationData.travelDetails.members[index].morningTeaCoffee.preference === 'none' ? 'None' : `${registrationData.travelDetails.members[index].morningTeaCoffee.preference.charAt(0).toUpperCase() + registrationData.travelDetails.members[index].morningTeaCoffee.preference.slice(1)} (Sugar: ${registrationData.travelDetails.members[index].morningTeaCoffee.sugar === 'sugar' ? 'Yes' : 'No'})`;-->


<!--            summaryHtml += `-->
<!--                <div class="summary-attendee-card mt-4">-->
<!--                    <h4><i class="fas fa-user-circle mr-2"></i>${member.firstName} ${member.lastName} ${index === 0 ? '(Main Registrant)' : ''}</h4>-->
<!--                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 text-sm">-->
<!--                        <div><strong>Age/Gender:</strong> <span>${member.age} / ${member.gender}</span></div>-->
<!--                        <div><strong>Mobile:</strong> <span>${member.mobile}</span></div>-->
<!--                        <div><strong>Attending Dates:</strong> <span>${member.attendingDates.map(d => new Date(d + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })).join(', ')}</span></div>-->
<!--                        <div><strong>Travel:</strong> <span>${member.modeOfTransport} from ${member.cityOfOrigin}</span></div>-->
<!--                        <div><strong>Arrival:</strong> <span>${member.arrivalDate} ${member.arrivalTime}</span></div>-->
<!--                        <div><strong>Departure:</strong> <span>${member.departureDate} ${member.departureTime}</span></div>-->
<!--                        <div><strong>Accommodation:</strong> <span>${member.stayAtHall ? 'Hall' : 'Other'}${member.stayAtHall && member.cotRequired ? ' (Cot)' : ''}</span></div>-->
<!--                        <div><strong>Stairs Difficulty:</strong> <span>${member.difficultyClimbingStairs ? 'Yes' : 'No'}</span></div>-->
<!--                        <div><strong>Local Assistance:</strong> <span>${member.localAssistance || 'None'}</span></div>-->
<!--                        <div><strong>Recordings:</strong> <span>${member.recordingsNeeded || 'None'}</span></div>-->
<!--                    </div>-->
<!--                    <h5 class="font-semibold text-base mt-4 mb-2"><i class="fas fa-mug-hot mr-2"></i>Morning Tea/Coffee:</h5>-->
<!--                    <ul class="list-none text-sm ml-4">-->
<!--                        <li>${morningTeaCoffeeDisplay}</li>-->
<!--                    </ul>-->
<!--                    <h5 class="font-semibold text-base mt-4 mb-2"><i class="fas fa-utensils mr-2"></i>Meals Per Day:</h5>-->
<!--                    <ul class="list-none text-sm ml-4">-->
<!--                        ${mealsSummary}-->
<!--                    </ul>-->
<!--                    <p class="mt-4"><strong><i class="fas fa-exclamation-triangle mr-2"></i>Special Requests:</strong> <span>${member.specialRequests || 'None'}</span></p>-->
<!--                </div>-->
<!--            `;-->
<!--        });-->

<!--        summaryHtml += `-->
<!--            <button class="form-button mt-8 w-full" onclick="confirmBooking(this)">Confirm All Details & Book</button>-->
<!--        `;-->

<!--        addInteractionElement('user-input-form', summaryHtml, 'registration-summary-form');-->
<!--        addInteractionElement('bot-message', `<span>Please review your registration details carefully before confirming.</span>`, null);-->
<!--    }-->


<!--    /**-->
<!--     * Displays the "Concert Ticket" style confirmation for a new registration.-->
<!--     */-->
<!--    function displayTicketConfirmation() {-->
<!--        // Remove all interaction bubbles-->
<!--        document.querySelectorAll('.interaction-bubble').forEach(bubble => {-->
<!--            bubble.classList.remove('active');-->
<!--            setTimeout(() => bubble.remove(), 500);-->
<!--        });-->

<!--        // Hide default final greeting section-->
<!--        finalGreetingSection.classList.add('hidden');-->

<!--        let attendeesSummaryHtml = '';-->
<!--        const mealMap = {-->
<!--            breakfast: 'Breakfast',-->
<!--            lunch: 'Lunch',-->
<!--            highTea: 'High Tea',-->
<!--            dinner: 'Dinner'-->
<!--        };-->

<!--        registrationData.travelDetails.members.forEach((member, index) => {-->
<!--            const mealsSummary = member.attendingDates.map(dateYYYYMMDD => {-->
<!--                const prefs = member.mealPreferences[dateYYYYMMDD];-->
<!--                const displayDate = new Date(dateYYYYMMDD + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });-->

<!--                const mealList = [];-->
<!--                for (const mealKey in mealMap) {-->
<!--                    // Only include breakfast if it's not July 8th for the mealList-->
<!--                    if (mealKey === 'breakfast' && dateYYYYMMDD === '2025-07-08') {-->
<!--                        // Skip breakfast for July 8th-->
<!--                    } else if (prefs && prefs[mealKey]) {-->
<!--                        mealList.push(mealMap[mealKey]);-->
<!--                    }-->
<!--                }-->
<!--                const mealsStr = mealList.length > 0 ? mealList.join(', ') : 'None';-->

<!--                const teaCoffeeDisplay = (prefs && prefs.teaCoffeePreference === 'none') || !prefs ? 'None' : `${prefs.teaCoffeePreference.charAt(0).toUpperCase() + prefs.teaCoffeePreference.slice(1)} (Sugar: ${prefs.teaCoffeeSugar === 'sugar' ? 'Yes' : 'No'})`;-->

<!--                return `<li><strong>${displayDate}:</strong> ${mealsStr} (Beverage: ${teaCoffeeDisplay}) ${prefs && prefs.packedFood ? '(Packed Meal)' : ''}</li>`;-->
<!--            }).join('');-->

<!--            const morningTeaCoffeeDisplay = registrationData.travelDetails.members[index].morningTeaCoffee.preference === 'none' ? 'None' : `${registrationData.travelDetails.members[index].morningTeaCoffee.preference.charAt(0).toUpperCase() + registrationData.travelDetails.members[index].morningTeaCoffee.preference.slice(1)} (Sugar: ${registrationData.travelDetails.members[index].morningTeaCoffee.sugar === 'sugar' ? 'Yes' : 'No'})`;-->


<!--            attendeesSummaryHtml += `-->
<!--                <div class="attendee-entry mt-4 pt-4 border-t border-white/10">-->
<!--                    <p><strong><i class="fas fa-user mr-2"></i>Name:</strong> <span>${member.firstName} ${member.lastName}</span></p>-->
<!--                    <p><strong><i class="fas fa-venus-mars mr-2"></i>Gender/Age:</strong> <span>${member.gender} / ${member.age}</span></p>-->
<!--                    <p><strong><i class="fas fa-phone mr-2"></i>Contact:</strong> <span>${member.mobile}</span></p>-->
<!--                    <p><strong><i class="fas fa-calendar-check mr-2"></i>Attending:</strong> <span>${member.attendingDates.map(d => new Date(d + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })).join(', ')}</span></p>-->
<!--                    <p><strong><i class="fas fa-route mr-2"></i>Travel:</strong> <span>${member.modeOfTransport} from ${member.cityOfOrigin} (Arrive: ${member.arrivalTime}, Depart: ${member.departureTime})</span></p>-->
<!--                    <p><strong><i class="fas fa-bed mr-2"></i>Accommodation:</strong> <span>${member.stayAtHall ? 'Swapnapoorti Hall' : 'Other'}${member.stayAtHall && member.cotRequired ? ' (Cot Needed)' : ''}</span></p>-->
<!--                    <p><strong><i class="fas fa-stairs mr-2"></i>Stairs Difficulty:</strong> <span>${member.difficultyClimbingStairs ? 'Yes' : 'No'}</span></p>-->
<!--                    <p><strong><i class="fas fa-hands-helping mr-2"></i>Local Assistance:</strong> <span>${member.localAssistance || 'None'}</span></p>-->
<!--                    <p><strong><i class="fas fa-headphones-alt mr-2"></i>Recordings:</strong> <span>${member.recordingsNeeded || 'None'}</span></p>-->
<!--                    <h5 class="font-semibold text-base mt-2 mb-1"><i class="fas fa-mug-hot mr-2"></i>Morning Tea/Coffee:</h5>-->
<!--                    <ul class="list-none text-sm ml-4">-->
<!--                        <li>${morningTeaCoffeeDisplay}</li>-->
<!--                    </ul>-->
<!--                    <h5 class="font-semibold text-base mt-2 mb-1"><i class="fas fa-utensils mr-2"></i>Meals:</h5>-->
<!--                    <ul class="list-none text-sm ml-4">-->
<!--                        ${mealsSummary}-->
<!--                    </ul>-->
<!--                    <p class="mt-2"><strong><i class="fas fa-exclamation-triangle mr-2"></i>Special Requests:</strong> <span>${member.specialRequests || 'None'}</span></p>-->
<!--                </div>-->
<!--            `;-->
<!--        });-->

<!--        const ticketHtml = `-->
<!--            <p class="text-sm font-semibold text-yellow-300 text-center mb-4 leading-relaxed opacity-80">-->
<!--                July 8 - 11, 2025 | Swapnapoorti Hall, Pune-->
<!--            </p>-->
<!--            <div class="ticket-confirmation-card" id="ticket-confirmation-card">-->
<!--                <div class="ticket-header">-->
<!--                    <h2>Gurukul Utsav 2025</h2>-->
<!--                    <span class="registration-id">${registrationData.registrationId}</span>-->
<!--                </div>-->

<!--                <div class="ticket-details">-->
<!--                    <h4><i class="fas fa-info-circle mr-2"></i>Registration Summary</h4>-->
<!--                    <p><strong>Main Registrant:</strong> <span>${registrationData.mainRegistrant.firstName} ${registrationData.mainRegistrant.lastName}</span></p>-->
<!--                    <p><strong>Contact:</strong> <span>${registrationData.mainRegistrant.mobile}</span></p>-->
<!--                    <p><strong>References:</strong> <span>${registrationData.mainRegistrant.ref1 || 'N/A'}, ${registrationData.mainRegistrant.ref2 || 'N/A'}</span></p>-->

<!--                    <h4 class="mt-6"><i class="fas fa-users mr-2"></i>Attendees (${registrationData.travelDetails.members.length})</h4>-->
<!--                    ${attendeesSummaryHtml}-->
<!--                </div>-->

<!--                <div class="ticket-footer">-->
<!--                    <p>We are delighted to welcome you to Gurukul Utsav!</p>-->
<!--                    <button class="form-button" onclick="downloadRegistrationDetails()">-->
<!--                        <i class="fas fa-download pr-1"></i> Download Details-->
<!--                    </button>-->
<!--                    <button class="form-button" onclick="initFormFlow()">-->
<!--                        <i class="fas fa-plus-circle pr-1"></i> Start New Registration-->
<!--                    </button>-->
<!--                </div>-->
<!--            </div>-->
<!--        `;-->

<!--        interactionWindow.innerHTML = ticketHtml; // Replace content with the ticket-->
<!--        scrollToBottom(); // Ensure it's visible-->
<!--    }-->

<!--    /**-->
<!--     * Downloads the complete registration data as a PDF file.-->
<!--     */-->


<!--     async function downloadRegistrationDetails() {-->
<!--    const element = document.getElementById('ticket-confirmation-card');-->
<!--    if (!element) {-->
<!--        displayMessage('Error: Ticket element not found for PDF generation.', 'error');-->
<!--        return;-->
<!--    }-->

<!--    // Show loading overlay-->
<!--    pdfLoadingOverlay.classList.add('active');-->

<!--    // Clone the element-->
<!--    const clonedElement = element.cloneNode(true);-->

<!--    // Remove the download button-->
<!--    const downloadButtonInCloned = clonedElement.querySelector('.ticket-footer .form-button');-->
<!--    if (downloadButtonInCloned) {-->
<!--        downloadButtonInCloned.remove();-->
<!--    }-->

<!--    // Font setup-->
<!--    const handwrittenFont = `'Caveat', cursive`;-->

<!--    // Apply base styles-->
<!--    clonedElement.style.background = 'white';-->
<!--    clonedElement.style.color = '#000';-->
<!--    clonedElement.style.boxShadow = 'none';-->
<!--    clonedElement.style.border = '1px solid #ddd';-->
<!--    clonedElement.style.transform = 'none';-->
<!--    clonedElement.style.borderRadius = '0.5rem';-->
<!--    clonedElement.style.fontFamily = handwrittenFont;-->
<!--    clonedElement.style.fontWeight = 'bold';-->

<!--    // Header-->
<!--    const pdfHeaderH2 = clonedElement.querySelector('.ticket-header h2');-->
<!--    if (pdfHeaderH2) {-->
<!--        pdfHeaderH2.style.color = '#0056b3';-->
<!--        pdfHeaderH2.style.textShadow = 'none';-->
<!--        pdfHeaderH2.style.fontFamily = handwrittenFont;-->
<!--        pdfHeaderH2.style.fontWeight = 'bold';-->
<!--    }-->

<!--    // Registration ID-->
<!--    const pdfRegistrationId = clonedElement.querySelector('.registration-id');-->
<!--    if (pdfRegistrationId) {-->
<!--        pdfRegistrationId.style.background = 'none';-->
<!--        pdfRegistrationId.style.color = '#007bff';-->
<!--        pdfRegistrationId.style.border = '2px dashed #007bff';-->
<!--        pdfRegistrationId.style.boxShadow = 'none';-->
<!--        pdfRegistrationId.style.fontSize = '1.5rem';-->
<!--        pdfRegistrationId.style.fontFamily = handwrittenFont;-->
<!--        pdfRegistrationId.style.fontWeight = 'bold';-->
<!--    }-->

<!--    // All text elements-->
<!--    clonedElement.querySelectorAll('h1, h2, h3, h4, h5, p, span, strong, li').forEach(el => {-->
<!--        el.style.fontFamily = handwrittenFont;-->
<!--        el.style.color = '#000';-->
<!--        el.style.fontWeight = 'bold';-->
<!--    });-->

<!--    // Sub-headers and names-->
<!--    clonedElement.querySelectorAll('.ticket-details h4, .summary-attendee-card h4').forEach(h4 => {-->
<!--        h4.style.color = '#0056b3';-->
<!--    });-->

<!--    clonedElement.querySelectorAll('.summary-attendee-card h5').forEach(h5 => {-->
<!--        h5.style.color = '#000';-->
<!--    });-->

<!--    // Text content styling-->
<!--    clonedElement.querySelectorAll('.ticket-details p span, .ticket-details ul li span').forEach(span => {-->
<!--        span.style.color = '#000';-->
<!--    });-->

<!--    clonedElement.querySelectorAll('.ticket-details p strong, .ticket-details ul li strong, .attendee-entry p strong').forEach(strong => {-->
<!--        strong.style.color = '#000';-->
<!--    });-->

<!--    clonedElement.querySelectorAll('.attendee-entry p span').forEach(span => {-->
<!--        span.style.color = '#000';-->
<!--    });-->

<!--    // Footer text-->
<!--    const ticketFooterP = clonedElement.querySelector('.ticket-footer p');-->
<!--    if (ticketFooterP) {-->
<!--        ticketFooterP.style.color = '#333';-->
<!--    }-->

<!--    // Append to DOM-->
<!--    document.body.appendChild(clonedElement);-->

<!--    try {-->
<!--        await html2pdf().from(clonedElement).set({-->
<!--            margin: 10,-->
<!--            filename: `GurukulUtsav_Registration_${registrationData.registrationId}.pdf`,-->
<!--            html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },-->
<!--            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }-->
<!--        }).save();-->

<!--        displayMessage('Registration details downloaded as PDF!', 'success');-->
<!--    } catch (error) {-->
<!--        console.error('Error generating PDF:', error);-->
<!--        displayMessage('Failed to generate PDF. Please try again or use the text download option.', 'error');-->
<!--    } finally {-->
<!--        pdfLoadingOverlay.classList.remove('active');-->
<!--        if (clonedElement.parentNode) {-->
<!--            clonedElement.parentNode.removeChild(clonedElement);-->
<!--        }-->
<!--    }-->
<!--}-->


<!--  </script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gurukul Utsav New Registration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Ensure Tailwind is loaded before configuration
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: {
                            inter: ['Inter', 'sans-serif'],
                        },
                        colors: {
                            'dark-bg': '#03040A',
                            'text-color-primary': '#e5e7eb',
                            'text-color-secondary': '#9ca3af',
                            'glass-bg': 'rgba(15, 12, 29, 0.4)',
                            'glass-border': 'rgba(255, 255, 255, 0.1)',
                            'input-bar-bg': 'rgba(10, 8, 20, 0.7)',
                            'bot-message-bg': 'rgba(43, 46, 62, 0.7)', /* New: specifically for bot messages */
                            'user-input-bg': 'linear-gradient(135deg, #007BFF, #0056b3)', /* For user response section */
                            'form-button-bg': '#007BFF', /* Primary button color */
                            'form-button-hover': '#0056b3',
                            'error-red': '#ef4444', /* Tailwind red-500 */
                            'success-green': '#22c55e', /* Tailwind green-500 */
                            'scroll-thumb-bg': 'rgba(148, 163, 184, 0.3)',
                            'splash-bg': 'rgba(0, 0, 0, 0.6)',
                            'settings-highlight-bg': 'rgba(255, 255, 255, 0.05)',
                            'form-field-bg-dark': 'rgba(0, 0, 0, 0.3)', /* Dark mode input field background */
                            'calendar-day-bg': 'rgba(255, 255, 255, 0.1)',
                            'calendar-day-hover': 'rgba(255, 255, 255, 0.2)',
                            'calendar-day-selected': '#007BFF',
                            'time-picker-bg': 'rgba(255, 255, 255, 0.15)', /* Removed, but kept for reference */
                            'time-picker-selected-bg': 'rgba(255, 255, 255, 0.3)', /* Removed, but kept for reference */
                        }
                    },
                }
            };
        } else {
            console.error("Tailwind CSS not loaded. Cannot apply custom configuration.");
        }
    });
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- html2pdf.js for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    /* ------------------------------ */
    /* CSS Variables for Theming      */
    /* ------------------------------ */
    :root {
      --bg-color: #03040A;
      --text-color-primary: #e5e7eb;
      --text-color-secondary: #9ca3af;
      --glass-bg: rgba(15, 12, 29, 0.4);
      --glass-border: rgba(255, 255, 255, 0.1);
      --input-bar-bg: rgba(10, 8, 20, 0.7);
      --bot-message-bg: rgba(43, 46, 62, 0.7);
      --user-input-bg: linear-gradient(135deg, #007BFF, #0056b3);
      --form-button-bg: #007BFF;
      --form-button-hover: #0056b3;
      --scroll-thumb-bg: rgba(148, 163, 184, 0.3);
      --splash-bg: rgba(0, 0, 0, 0.6);
      --settings-highlight-bg: rgba(255, 255, 255, 0.05);
      --error-color: #ef4444;
      --success-color: #22c55e;
      --form-field-bg: rgba(0, 0, 0, 0.3); /* For inputs */
      --calendar-day-bg: rgba(255, 255, 255, 0.1);
      --calendar-day-hover: rgba(255, 255, 255, 0.2);
      --calendar-day-selected: #007BFF;

      /* Zoom variables */
      --global-font-size: 16px; /* Base font size for 'rem' calculation */
      --chat-max-width: 640px; /* Base max-width for chat container */
    }

    .light-theme {
      --bg-color: #F0F2F5;
      --text-color-primary: #1f2937;
      --text-color-secondary: #4b5563;
      --glass-bg: rgba(255, 255, 255, 0.5);
      --glass-border: rgba(0, 0, 0, 0.1);
      --input-bar-bg: rgba(229, 231, 235, 0.8);
      --bot-message-bg: rgba(229, 231, 235, 1);
      --user-input-bg: linear-gradient(135deg, #007BFF, #0069d9);
      --form-button-bg: #007BFF;
      --form-button-hover: #0069d9;
      --scroll-thumb-bg: rgba(107, 114, 128, 0.4);
      --splash-bg: rgba(255, 255, 255, 0.5);
      --settings-highlight-bg: rgba(0, 0, 0, 0.05);
      --error-color: #dc2626;
      --success-color: #16a34a;
      --form-field-bg: rgba(255, 255, 255, 0.7); /* For inputs */
      --calendar-day-bg: rgba(0, 0, 0, 0.05);
      --calendar-day-hover: rgba(0, 0, 0, 0.1);
      --calendar-day-selected: #007BFF;
    }

    /* ------------------------------ */
    /* Base Styling                   */
    /* ------------------------------ */
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color-primary);
      /* Removed overflow: hidden from body to allow full page scrolling if needed */
      transition: background-color 0.5s ease, color 0.5s ease;
      font-size: var(--global-font-size); /* Apply global font size */
    }

    /* ------------------------------ */
    /* Dynamic Evolving Waves         */
    /* ------------------------------ */
    #dynamic-background {
      position: fixed; inset: 0; z-index: 0; overflow: hidden;
      background-color: var(--bg-color);
      transition: background-color 0.5s ease;
    }
    #dynamic-background .wave {
      position: absolute; border-radius: 50%; filter: blur(120px); opacity: 0.5;
    }

    @keyframes wave-move-1 { 0% { transform: translate(0, 0) rotate(0deg) scale(1.2); } 50% { transform: translate(150px, 100px) rotate(180deg) scale(1.4); } 100% { transform: translate(0, 0) rotate(360deg) scale(1.2); } }
    @keyframes wave-move-2 { 0% { transform: translate(0, 0) rotate(0deg) scale(1); } 50% { transform: translate(-200px, -150px) rotate(180deg) scale(1.2); } 100% { transform: translate(0, 0) rotate(360deg) scale(1); } }
    @keyframes wave-move-3 { 0% { transform: translate(0, 0) rotate(0deg) scale(1.1); } 50% { transform: translate(100px, -150px) rotate(-180deg) scale(1.3); } 100% { transform: translate(0, 0) rotate(-360deg) scale(1.1); } }
    @keyframes change-color-1 { 0%, 100% { background-color: #1a0033; } 33% { background-color: #001f2e; } 66% { background-color: #0d1127; } }
    @keyframes change-color-2 { 0%, 100% { background-color: #001f2e; } 33% { background-color: #0d1127; } 66% { background-color: #2a004d; } }
    @keyframes change-color-3 { 0%, 100% { background-color: #0d1127; } 33% { background-color: #1a0033; } 66% { background-color: #00334d; } }

    .wave-1 { width: 800px; height: 800px; top: -25%; left: -15%; animation: wave-move-1 30s cubic-bezier(0.36, 0.45, 0.63, 0.53) infinite, change-color-1 20s ease-in-out infinite; }
    .wave-2 { width: 900px; height: 900px; bottom: -30%; right: -20%; animation: wave-move-2 25s cubic-bezier(0.36, 0.45, 0.63, 0.53) -10s infinite, change-color-2 20s ease-in-out -5s infinite; }
    .wave-3 { width: 700px; height: 700px; bottom: 5%; left: -10%; animation: wave-move-3 20s cubic-bezier(0.36, 0.45, 0.63, 0.53) -5s infinite, change-color-3 20s ease-in-out -15s infinite; }

    .light-theme #dynamic-background { opacity: 0; }

    /* ------------------------------ */
    /* Splash Screen & Animations     */
    /* ------------------------------ */
    #splash { background-color: var(--splash-bg); transition: background-color 0.5s ease; }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; visibility: hidden; } }
    .animate-fade-out { animation: fadeOut 1.5s ease-in-out forwards; }

    /* Modified splash-image keyframes for glow and appearance */
    @keyframes splash-image-appear {
        0% {
            opacity: 0;
            transform: scale(0.5);
            box-shadow: 0 0 5px 2px rgba(255, 193, 7, 0.2), 0 0 10px 4px rgba(255, 193, 7, 0.1); /* Initial subtle yellow glow */
        }
        50% {
            opacity: 0.7;
            transform: scale(0.85);
            box-shadow: 0 0 30px 10px rgba(255, 193, 7, 0.6), 0 0 60px 20px rgba(255, 193, 7, 0.3); /* Growing yellow aura */
        }
        100% {
            opacity: 1;
            transform: scale(1);
            box-shadow: 0 0 60px 25px rgba(255, 193, 7, 0.9), 0 0 120px 50px rgba(255, 193, 7, 0.5); /* Full, bright yellow aura */
        }
    }
    .splash-image-style {
        border-radius: 50%; /* Make it circular */
        object-fit: cover; /* Ensure image covers the circle */
        border: 8px solid #FFC107; /* Yellow border for the guru image */
        animation: splash-image-appear 1.5s forwards ease-out; /* Apply glow and appearance animation */
        animation-delay: 0.2s; /* Delay for a smoother start */
        /* Increased size for the guru image */
        width: 250px; /* Adjust as needed */
        height: 250px; /* Keep height equal to width for perfect circle */
        max-width: 80vw; /* Ensure responsiveness */
        max-height: 80vw; /* Ensure responsiveness */
    }

    @keyframes splash-text { 0% { opacity: 0; transform: translateY(20px); } 30%, 70% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-10px); } }
    .animate-splash-text { animation: splash-text 1.5s ease-in-out forwards; /* Reduced animation time */ }

    /* ------------------------------ */
    /* Polished Glass Container       */
    /* ------------------------------ */
    .glass-container {
      background: var(--glass-bg);
      backdrop-filter: blur(50px) saturate(180%);
      border: 1px solid var(--glass-border);
      box-shadow: 0 15px 35px rgba(0,0,0,0.3), inset 0 0 0 1.5px rgba(255, 255, 255, 0.05);
      transition: background-color 0.5s ease, border 0.5s ease, max-width 0.3s ease; /* Add max-width transition */
      max-width: var(--chat-max-width); /* Controlled by JS zoom */
      max-height: 95vh; /* Limit height of the entire chat window */
      overflow-y: auto; /* Make the entire glass container scrollable */
    }

    /* Scrollbar styles for the main chat window */
    .glass-container::-webkit-scrollbar { width: 6px; }
    .glass-container::-webkit-scrollbar-track { background: transparent; }
    .glass-container::-webkit-scrollbar-thumb { background-color: var(--scroll-thumb-bg); border-radius: 3px; }
    .glass-container::-webkit-scrollbar-thumb:hover { background-color: rgba(148, 163, 184, 0.5); }


    /* ------------------------------ */
    /* Chat/Form Interaction Styles   */
    /* ------------------------------ */
    /* Base for all message/form bubbles */
    .interaction-bubble {
        border-radius: 1.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem; /* Space between bubbles */
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(255, 255, 255, 0.05);
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease-in-out;
        max-width: 100%; /* Ensure it fits in container */
    }

    /* Animation for bubbles appearing */
    .interaction-bubble.active {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto; /* Enable interaction for active forms */
    }

    /* Bot message specific styling */
    .bot-message {
        background: var(--bot-message-bg);
        color: var(--text-color-primary);
        align-self: flex-start; /* Align to the left */
        border-bottom-left-radius: 0.5rem; /* Smoother corner on one side */
        display: flex; /* Make it a flex container */
        align-items: flex-start; /* Align icon and text at the top */
        padding: 1rem 1.5rem; /* Adjust padding for icon */
    }
    .bot-message .bot-avatar {
        width: 7.5rem; /* w-10 */
        height: 7.5rem; /* h-10 */
        border-radius: 50%; /* rounded-full */
        object-fit: cover;
        margin-right: 0.75rem; /* mr-3 */
        flex-shrink: 0; /* Prevent avatar from shrinking */
        border: 2px solid var(--form-button-bg); /* Small border for bot avatar */
    }
    .bot-message .bot-text-content {
        flex-grow: 1; /* Allow text content to take remaining space */
    }

    /* User input form specific styling */
    .user-input-form {
        background: var(--user-input-bg);
        color: white; /* User input forms have white text */
        align-self: flex-end; /* Align to the right */
        border-bottom-right-radius: 0.5rem; /* Smoother corner on one side */
        pointer-events: none; /* Disabled until active */
    }

    .user-input-form h2 {
        font-size: 1.5em; /* text-2xl relative to parent font-size */
        font-weight: 600; /* font-semibold */
        margin-bottom: 1rem;
        color: white; /* Always white for user input forms */
    }
    .user-input-form p {
        font-size: 1em; /* text-base relative */
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 1.5rem;
    }
    .user-input-form label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: white; /* Always white for labels in user forms */
    }
    .user-input-form input[type="text"],
    .user-input-form input[type="tel"],
    .user-input-form input[type="number"], /* Added for age */
    .user-input-form select,
    .user-input-form textarea { /* Added textarea */
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem; /* rounded-xl */
        background-color: rgba(255, 255, 255, 0.2); /* Semi-transparent white background for input fields */
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: white;
        font-size: 1em; /* Relative to parent */
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .user-input-form input:focus,
    .user-input-form select:focus,
    .user-input-form textarea:focus { /* Added textarea */
        outline: none;
        border-color: white;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }
    .user-input-form input::placeholder,
    .user-input-form textarea::placeholder { /* Added textarea */
        color: rgba(255, 255, 255, 0.7);
    }
    .user-input-form select option {
        background-color: var(--form-button-bg); /* Match user form background for dropdown options */
        color: white;
    }

    .form-field-group {
        margin-bottom: 1.5rem;
    }
    .form-field-group .error-message {
        color: var(--error-color);
        font-size: 0.875em; /* text-sm relative */
        margin-top: 0.5rem;
        height: 1.25rem; /* Reserve space to prevent layout shift */
    }

    .form-button {
        background-color: white; /* White button on user forms */
        color: var(--form-button-bg); /* Text color is primary blue */
        padding: 0.75rem 2rem;
        border-radius: 9999px; /* rounded-full */
        font-weight: 600; /* font-semibold */
        transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Darker shadow for white button */
    }
    .form-button:hover {
        background-color: rgba(255, 255, 255, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    .form-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Theme and Zoom buttons */
    .theme-button {
      background-color: var(--settings-highlight-bg);
      border: 1px solid var(--glass-border);
      color: var(--text-color-primary);
      padding: 0.5rem 0.75rem;
      border-radius: 9999px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }
    .theme-button:hover {
        background-color: var(--glass-border);
    }


    /* Radio button styling for user forms */
    .user-input-form .radio-option {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem; /* Slightly less margin for radio options */
        cursor: pointer;
    }
    .user-input-form .radio-option input[type="radio"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 1.25em; /* Smaller radio button relative to font size */
        height: 1.25em;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.7);
        background-color: transparent;
        margin-right: 0.75rem;
        position: relative;
        cursor: pointer;
        transition: border-color 0.2s ease, background-color 0.2s ease;
    }
    .user-input-form .radio-option input[type="radio"]:checked {
        border-color: white;
        background-color: white;
    }
    .user-input-form .radio-option input[type="radio"]:checked::before {
        content: '';
        display: block;
        width: 0.6em; /* Smaller dot relative to font size */
        height: 0.6em;
        background-color: var(--form-button-bg); /* Blue dot inside white radio */
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    .user-input-form .radio-option label {
        color: white;
        font-size: 1em; /* Smaller label text relative */
        cursor: pointer;
    }

    /* Custom Checkbox styling (Tick Box) - IMPROVED */
    .user-input-form .checkbox-option input[type="checkbox"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 1.5em; /* Slightly larger relative */
        height: 1.5em; /* Slightly larger relative */
        border-radius: 0.375em; /* rounded-md relative */
        border: 3px solid rgba(255, 255, 255, 0.8); /* Bolder border */
        background-color: transparent;
        margin-right: 0.75rem;
        position: relative;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease; /* Smooth transition for all properties */
    }
    .user-input-form .checkbox-option input[type="checkbox"]:hover {
        border-color: white; /* Highlight border on hover */
        box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2); /* Soft glow on hover */
    }
    .user-input-form .checkbox-option input[type="checkbox"]:checked {
        border-color: var(--form-button-bg); /* Blue border when checked */
        background-color: var(--form-button-bg); /* Blue background when checked */
        box-shadow: 0 0 0 2px var(--form-button-bg), 0 0 0 5px rgba(0, 123, 255, 0.4); /* Stronger blue outer glow */
    }
    .user-input-form .checkbox-option input[type="checkbox"]::after {
        /* Using SVG for reliable checkmark icon */
        content: ''; /* Must be present for ::after to render */
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M9.707 16.707a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L9 14.586l6.293-6.293a1 1 0 0 1 1.414 1.414l-7 7a1 1 0 0 1-.001.001z'/%3E%3C/svg%3E");
        background-size: 80%; /* Adjust size of the SVG tick */
        background-position: center;
        background-repeat: no-repeat;
        position: absolute;
        width: 100%; /* Take full space of the checkbox */
        height: 100%; /* Take full space of the checkbox */
        top: 0; left: 0; /* Position correctly */
        transform: scale(0); /* Initially hidden */
        opacity: 0;
        transition: transform 0.2s ease-out, opacity 0.2s ease-out;
    }
    .user-input-form .checkbox-option input[type="checkbox"]:checked::after {
        transform: scale(1); /* Pop in effect */
        opacity: 1;
    }
    .user-input-form .checkbox-option label {
        color: white;
        font-size: 1em;
        cursor: pointer;
    }


    /* Timetable styles */
    .timetable-entry {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        padding: 1rem;
        margin-top: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    .timetable-entry h3 {
        font-size: 1.25em; /* Relative */
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: white;
    }

    /* Final greeting section */
    .final-greeting {
        padding: 3rem 2rem;
        background: linear-gradient(135deg, var(--form-button-bg), var(--form-button-hover));
        color: white;
        text-align: center;
        border-radius: 1.5rem;
        box-shadow: 0 10px 25px rgba(0, 123, 255, 0.5);
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.8s ease-out;
        margin-top: 1.5rem; /* Space from last message/form */
        align-self: center; /* Center the final greeting */
    }
    .final-greeting.active {
        opacity: 1;
        transform: translateY(0);
    }
    .final-greeting h2 {
        font-size: 2.5em; /* Relative */
        font-weight: 800; /* font-extrabold */
        margin-bottom: 1rem;
    }
    .final-greeting p {
        font-size: 1.25em; /* Relative */
        line-height: 1.6;
    }

    /* Dynamic member list styling */
    .member-entry-dynamic {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    .member-entry-dynamic .delete-member-button {
        background-color: var(--error-color);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875em; /* Relative */
        align-self: flex-end;
        transition: background-color 0.2s ease;
    }
    .member-entry-dynamic .delete-member-button:hover {
        background-color: #dc2626;
    }


    /* Scrolling container for messages/forms */
    /* This section is removed from interaction-window as glass-container now handles scroll */
    #interaction-window {
        flex-grow: 1; /* Allow it to grow and take available space */
        padding: 1rem; /* Padding for the scrollable area */
        display: flex;
        flex-direction: column; /* Stack elements vertically */
        align-items: flex-start; /* Default alignment for messages/forms */
        /* scroll-behavior: smooth; -> Removed, handled by parent glass-container */
        /* overflow-y: auto; -> Removed, handled by parent glass-container */
    }


    /* Custom Time Input Styling */
    .custom-time-input-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        width: 100%;
    }
    .custom-time-input-group input[type="number"] {
        flex: 1; /* Allows hour/minute inputs to grow */
        max-width: 80px; /* Constrain width */
        text-align: center;
        -moz-appearance: textfield; /* Hide arrows for Firefox */
    }
    .custom-time-input-group input[type="number"]::-webkit-outer-spin-button,
    .custom-time-input-group input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    .custom-time-input-group select {
        width: auto; /* Allow AM/PM dropdown to size content */
        min-width: 60px;
    }

    /* All Good/Success Message Bubble */
    @keyframes sparkle-text-pop {
        0% { transform: scale(0.8); opacity: 0; }
        50% { transform: scale(1.1); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
    }

    /* Full-screen Success Animation */
    #full-screen-success {
        background: linear-gradient(45deg, var(--success-color), #34d399); /* Green gradient */
        z-index: 9999; /* Ensure it's on top */
    }

    #full-screen-success i {
        animation: tick-pop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        transform: scale(0);
    }

    #full-screen-success p {
        animation: text-fade-in 0.8s ease-out forwards;
        animation-delay: 0.3s; /* Delay text appearance slightly */
        opacity: 0;
        transform: translateY(20px);
    }

    @keyframes tick-pop {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
    }

    @keyframes text-fade-in {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* Summary Specific Styling */
    .summary-section {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .summary-section h3 {
        font-size: 1.25em; /* relative to parent font-size */
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-color-primary);
    }

    .summary-section p, .summary-section ul li {
        font-size: 0.95em; /* slightly smaller relative to parent */
        line-height: 1.5;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .summary-section p strong, .summary-section ul li strong {
        color: var(--text-color-secondary);
        min-width: 100px; /* Align labels */
    }
    .summary-section p span, .summary-section ul li span {
        color: var(--text-color-primary);
    }

    .summary-attendee-card {
        background-color: rgba(255, 255, 255, 0.07);
        border-radius: 1rem;
        padding: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .summary-attendee-card h4 {
        font-size: 1.15em; /* relative */
        font-weight: 700;
        margin-bottom: 1.25rem;
        color: black; /* Highlight attendee name */
        display: flex;
        align-items: center;
    }
    .summary-attendee-card h5 {
        font-size: 1em; /* relative */
        font-weight: 600;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        color: var(--text-color-primary);
        display: flex;
        align-items: center;
    }
    .summary-attendee-card .grid div {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .summary-attendee-card .grid div strong {
        min-width: 80px; /* Align labels within grid */
        color: var(--text-color-secondary);
    }

    .summary-attendee-card ul.list-none {
        padding-left: 0;
    }
    .summary-attendee-card ul.list-none li {
        margin-left: 0;
        padding-left: 1rem;
        border-left: 2px solid rgba(255,255,255,0.1); /* Subtle separator */
    }

    /* Ticket Confirmation Styles */
    .ticket-confirmation-card {
        position: relative;
        background: linear-gradient(135deg, #1A202C, #2D3748); /* Dark gradient background */
        color: white;
        border-radius: 1.5rem;
        padding: 2.5rem; /* Increased padding */
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6); /* More prominent shadow */
        overflow: hidden; /* Crucial for pseudo-element clipping */
        margin-top: 2rem;
        text-align: center;
        opacity: 0;
        transform: translateY(50px) scale(0.9);
        animation: ticket-appear 0.8s ease-out forwards;
        border: 2px solid rgba(255, 255, 255, 0.2); /* Slight border */
        width: 100%; /* Ensure it takes full width of parent */
        max-width: 500px; /* Max width for a ticket-like appearance */
        align-self: center; /* Center horizontally in flex column */
        font-size: 0.9em; /* slightly smaller base font for density */
    }

    @keyframes ticket-appear {
        0% { opacity: 0; transform: translateY(50px) scale(0.9); }
        80% { opacity: 1; transform: translateY(-5px) scale(1.02); }
        100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* Torn edge effect */
    .ticket-confirmation-card::before,
    .ticket-confirmation-card::after {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        height: 20px; /* Height of the perforation area */
        background-size: 20px 20px; /* Size of each perforation circle */
        background-repeat: repeat-x;
        z-index: 1;
    }

    .ticket-confirmation-card::before {
        top: 6rem; /* Position the top tear line */
        background-image: radial-gradient(circle at 10px 10px, transparent 9px, white 10px);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.1), 0 2px 5px rgba(0,0,0,0.4);
    }

    .ticket-confirmation-card::after {
        bottom: 6rem; /* Position the bottom tear line */
        background-image: radial-gradient(circle at 10px 0, transparent 9px, white 10px);
        box-shadow: inset 0 -1px 0 rgba(255, 255, 255, 0.1), inset 0 1px 0 rgba(0, 0, 0, 0.1), 0 -2px 5px rgba(0,0,0,0.4);
    }

    .ticket-header, .ticket-footer {
        text-align: center;
        position: relative; /* To be above perforations */
        z-index: 2;
    }

    .ticket-header {
        margin-bottom: 2rem;
    }

    .ticket-header h2 {
        font-size: 2em; /* Larger title */
        font-weight: 800;
        text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        color: #FFD700; /* Gold-like color */
        margin-bottom: 0.5rem;
    }

    .ticket-header p {
        font-size: 1.1em;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 1rem;
    }

    .registration-id {
        font-family: 'monospace', sans-serif; /* Monospace for ID */
        font-size: 2.2em; /* Very large for ID */
        font-weight: 700;
        letter-spacing: 2px;
        background: linear-gradient(45deg, #00C6FF, #0072FF); /* Blue gradient for ID */
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-top: 1.5rem;
        padding: 0.5rem 1rem;
        border: 1px dashed rgba(255, 255, 255, 0.3);
        border-radius: 0.5rem;
        display: inline-block;
        box-shadow: 0 0 15px rgba(0, 114, 255, 0.6);
        transition: all 0.3s ease-in-out;
    }
    .registration-id:hover {
        transform: scale(1.05);
        box-shadow: 0 0 25px rgba(0, 114, 255, 0.8);
    }

    /* Removed QR code styles */

    .ticket-details {
        text-align: left;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        z-index: 2;
    }

    .ticket-details h4 {
        font-size: 1.2em;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #FFD700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .ticket-details p, .ticket-details li {
        font-size: 0.9em;
        margin-bottom: 0.75rem;
        line-height: 1.4;
        display: flex;
        align-items: flex-start; /* Align text start with icon */
        gap: 0.5rem;
    }
    .ticket-details p strong, .ticket-details li strong {
        color: rgba(255, 255, 255, 0.7);
        /* Removed min-width to allow better responsiveness on small screens */
        flex-shrink: 0;
    }
    .ticket-details ul {
        list-style: none;
        padding-left: 0;
        margin-top: 0.5rem;
        margin-bottom: 1rem;
    }
    .ticket-details ul li {
        margin-bottom: 0.5rem;
        padding-left: 1rem;
        position: relative;
    }
    .ticket-details ul li::before {
        content: '\2022'; /* Bullet point */
        color: #FFD700;
        position: absolute;
        left: 0;
        top: 0;
    }

    .ticket-footer {
        margin-top: 2rem;
        font-size: 0.85em;
        color: rgba(255, 255, 255, 0.7);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 1rem;
        display: flex; /* Use flex for buttons */
        justify-content: center; /* Center buttons */
        gap: 1rem;
        flex-wrap: wrap; /* Allow wrapping on small screens */
    }
    .ticket-footer .form-button {
        background-color: #4CAF50; /* Green button for positive action */
        color: white;
        box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);
        margin-top: 1.5rem;
    }
    .ticket-footer .form-button:hover {
        background-color: #45a049;
    }

    /* Modal for delete confirmation */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .modal-overlay.active {
        opacity: 1;
    }
    .modal-content {
        background: linear-gradient(135deg, #1A202C, #2D3748);
        border-radius: 1rem;
        padding: 2rem;
        color: white;
        text-align: center;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        transform: scale(0.9);
        transition: transform 0.3s ease;
    }
    .modal-overlay.active .modal-content {
        transform: scale(1);
    }
    .modal-content h3 {
        font-size: 1.5em;
        font-weight: 600;
        margin-bottom: 1rem;
    }
    .modal-content p {
        margin-bottom: 1.5rem;
        color: rgba(255, 255, 255, 0.8);
    }
    .modal-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
    }
    .modal-actions .form-button {
        margin-top: 0; /* Override default button margin */
        padding: 0.6rem 1.5rem;
    }

    /* Styles for fixed bottom buttons */
    #global-actions {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 1rem;
        z-index: 20; /* Ensure it's above other content but below modals */
        display: flex;
        justify-content: center;
        gap: 1rem;
        background: rgba(0,0,0,0.7); /* Slightly translucent background */
        backdrop-filter: blur(5px);
        border-top: 1px solid rgba(255,255,255,0.1);
    }
    #global-actions .action-button {
        background-color: var(--form-button-bg);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 9999px; /* pill shape */
        font-weight: 600;
        transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        display: flex; /* For icon and text alignment */
        align-items: center;
        gap: 0.5rem;
    }
    #global-actions .action-button:hover {
        background-color: var(--form-button-hover);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    #global-actions .action-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Loading Overlay for PDF */
    #pdf-loading-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: none; /* Hidden by default */
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        color: white;
        font-size: 1.5em;
        gap: 1rem;
    }
    #pdf-loading-overlay.active {
        display: flex;
    }
    .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #fff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body class="text-slate-200">

  <div id="dynamic-background">
    <div class="wave wave-1"></div>
    <div class="wave wave-2"></div>
    <div class="wave wave-3"></div>
  </div>

  <!-- Splash Screen -->
  <div id="splash" class="fixed inset-0 z-50 flex flex-col items-center justify-center backdrop-blur-sm">
    <img id="splash-image" src="https://placehold.co/250x250/FFC107/000000?text=Guru+Logo" alt="Gurukul Utsav Logo" class="hidden w-40 h-40 md:w-56 md:h-56 object-contain mb-8 shadow-2xl splash-image-style">
    <h1 id="splash-text" class="hidden text-white text-3xl sm:text-4xl md:text-5xl font-bold tracking-wide text-center px-4">
      Gurukul Utsav Registration
    </h1>
  </div>

  <!-- Full-screen Success Animation Overlay -->
  <div id="full-screen-success" class="fixed inset-0 flex flex-col items-center justify-center hidden opacity-0 transition-opacity duration-500">
      <i class="fas fa-check-circle text-white text-9xl"></i>
      <p class="text-white text-3xl font-bold mt-8">Registration Successful</p>
  </div>


  <!-- Custom Confirmation Modal (Shared styling) -->
  <div id="confirmation-modal" class="modal-overlay hidden">
      <div class="modal-content">
          <h3 id="modal-title"></h3>
          <p id="modal-message"></p>
          <div class="modal-actions">
              <button id="modal-confirm-btn" class="form-button"></button>
              <button id="modal-cancel-btn" class="form-button bg-gray-500 hover:bg-gray-600">Cancel</button>
          </div>
      </div>
  </div>

  <!-- PDF Loading Overlay -->
  <div id="pdf-loading-overlay">
      <div class="spinner"></div>
      <p>Generating PDF...</p>
  </div>


  <!-- main-content now has min-h-screen and will allow glass-container to scroll -->
  <div id="main-content" class="hidden relative z-10 flex items-center justify-center min-h-screen p-2 md:p-4 overflow-hidden">
    <!-- glass-container now has max-h-[95vh] and overflow-y-auto -->
    <div class="glass-container flex flex-col w-full rounded-3xl p-6 sm:p-8 pb-20"> <!-- Added pb-20 to make space for fixed footer -->

      <div class="flex items-center justify-between p-4 border-b border-white/10 flex-wrap gap-2 mb-4">
        <h1 class="text-xl md:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300 tracking-wide">
          Gurukul Utsav Registration
        </h1>
        <div class="flex gap-2">
            <button id="zoom-out-btn" class="theme-button" aria-label="Zoom Out">
                <i class="fas fa-minus"></i>
            </button>
            <button id="zoom-in-btn" class="theme-button" aria-label="Zoom In">
                <i class="fas fa-plus"></i>
            </button>
            <button id="theme-toggle" class="theme-button" aria-label="Toggle theme">
                <i class="fas fa-sun text-yellow-300" id="sun-icon"></i>
                <i class="fas fa-moon text-blue-300 hidden" id="moon-icon"></i>
                <span id="theme-text" class="hidden sm:inline">Dark Mode</span>
            </button>
            <a href="/" aria-label="Return to Home Page">
                <button class="theme-button">
                  Return to Home Page
                </button>
            </a>
        </div>
      </div>

      <!-- Interaction Window: Content will be dynamically added here. It no longer handles its own overflow. -->
      <div id="interaction-window" class="flex-grow">
        <!-- Content will be dynamically added here -->
      </div>

      <!-- Final Greeting section (initially hidden, dynamically shown) -->
      <div id="final-greeting-section" class="final-greeting hidden">
        <h2 id="final-greeting-title"></h2>
        <p id="final-greeting-message"></p>
        <p class="mt-4 text-sm opacity-80" id="final-greeting-subtext">Thank you for registering.</p>
      </div>

    </div>
  </div>

  <!-- Global Action Buttons (Fixed Footer) -->
  <div id="global-actions">
      <button class="action-button" onclick="initFormFlow()">
          <i class="fas fa-home"></i> Start New Registration
      </button>
      <button class="action-button" onclick="window.location.href='/get-registrations'">
        <i class="fas fa-eye"></i> View/Edit Existing
      </button>
  </div>


  <script>
    // --- DOM Elements ---
    const splashScreen = document.getElementById('splash');
    const splashImage = document.getElementById('splash-image');
    const splashText = document.getElementById('splash-text');
    const mainContent = document.getElementById('main-content');
    const interactionWindow = document.getElementById('interaction-window');
    const finalGreetingSection = document.getElementById('final-greeting-section');
    const finalGreetingTitle = document.getElementById('final-greeting-title');
    const finalGreetingMessage = document.getElementById('final-greeting-message');
    const finalGreetingSubtext = document.getElementById('final-greeting-subtext');
    const fullScreenSuccess = document.getElementById('full-screen-success');
    const themeToggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');
    const themeText = document.getElementById('theme-text');
    const zoomInBtn = document.getElementById('zoom-in-btn');
    const zoomOutBtn = document.getElementById('zoom-out-btn');
    const pdfLoadingOverlay = document.getElementById('pdf-loading-overlay');


    // Modal elements
    const confirmationModal = document.getElementById('confirmation-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const modalConfirmBtn = document.getElementById('modal-confirm-btn');
    const modalCancelBtn = document.getElementById('modal-cancel-btn');


    // Bot Avatar Image (Placeholder - User will replace this)
    const botAvatarSrc = "static/self-me.png"; // AD for Aditya Paranjape

    // --- Dummy Databases / Data Simulation ---
    // In a real application, this would be on your server.
    // This array mimics your DynamoDB 'users' table where registrationId is the PK.
    let simulatedDynamoDB = {
        'REG-2025-44895150': {
            registrationId: 'REG-2025-44895150',
            mainRegistrant: { mobile: '+919876543210', firstName: 'Krishna', lastName: 'Das', ref1: '+917000000001', ref2: '+917000000002' },
            travelDetails: {
                members: [
                    {
                        firstName: 'Krishna', lastName: 'Das', mobile: '+919876543210', age: 40, gender: 'M',
                        modeOfTransport: 'Train', cityOfOrigin: 'Mumbai',
                        arrivalDate: '08|07|2025', arrivalTime: '08:00',
                        departureDate: '10|07|2025', departureTime: '18:00',
                        attendingDates: ['2025-07-08', '2025-07-09', '2025-07-10'], //YYYY-MM-DD format
                        morningTeaCoffee: { preference: 'tea', sugar: 'sugar' }, // New field
                        mealPreferences: {
                            '2025-07-08': { breakfast: false, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'tea', teaCoffeeSugar: 'sugar', packedFood: false },
                            '2025-07-09': { breakfast: true, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'coffee', teaCoffeeSugar: 'no-sugar', packedFood: false },
                            '2025-07-10': { breakfast: true, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'none', teaCoffeeSugar: 'sugar', packedFood: true }
                        },
                        stayAtHall: true, cotRequired: true, difficultyClimbingStairs: false,
                        localAssistance: 'Sankirtan Prabhu',
                        recordingsNeeded: 'Morning Lecture',
                        specialRequests: 'Needs hot milk for evening prasadam.'
                    },
                    {
                        firstName: 'Radha', lastName: 'Devi', mobile: '+919876543211', age: 38, gender: 'F',
                        modeOfTransport: 'Train', cityOfOrigin: 'Mumbai',
                        arrivalDate: '08|07|2025', arrivalTime: '08:00',
                        departureDate: '10|07|2025', departureTime: '18:00',
                        attendingDates: ['2025-07-08', '2025-07-09', '2025-07-10'], //YYYY-MM-DD format
                        morningTeaCoffee: { preference: 'both', sugar: 'sugar' },
                        mealPreferences: {
                            '2025-07-08': { breakfast: false, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'both', teaCoffeeSugar: 'sugar', packedFood: false },
                            '2025-07-09': { breakfast: true, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'tea', teaCoffeeSugar: 'no-sugar', packedFood: false },
                            '2025-07-10': { breakfast: true, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'none', teaCoffeeSugar: 'sugar', packedFood: true }
                        },
                        stayAtHall: true, cotRequired: false, difficultyClimbingStairs: true,
                        localAssistance: '',
                        recordingsNeeded: '',
                        specialRequests: ''
                    }
                ]
            }
        },
        'REG-2025-ABCD1234': {
            registrationId: 'REG-2025-ABCD1234',
            mainRegistrant: { mobile: '+919988776655', firstName: 'Radha', lastName: 'Priya', ref1: '+917000000003', ref2: '+917000000001' },
            travelDetails: {
                members: [
                    {
                        firstName: 'Radha', lastName: 'Priya', mobile: '+919988776655', age: 30, gender: 'F',
                        modeOfTransport: 'Flight', cityOfOrigin: 'Delhi',
                        arrivalDate: '09|07|2025', arrivalTime: '10:00',
                        departureDate: '11|07|2025', departureTime: '14:00',
                        attendingDates: ['2025-07-09', '2025-07-10', '2025-07-11'], //YYYY-MM-DD format
                        morningTeaCoffee: { preference: 'coffee', sugar: 'no-sugar' },
                        mealPreferences: {
                            '2025-07-09': { breakfast: false, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'coffee', teaCoffeeSugar: 'no-sugar', packedFood: false },
                            '2025-07-10': { breakfast: true, lunch: true, highTea: true, dinner: true, teaCoffeePreference: 'both', teaCoffeeSugar: 'no-sugar', packedFood: false },
                            '2025-07-11': { breakfast: true, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'tea', teaCoffeeSugar: 'sugar', packedFood: true }
                        },
                        stayAtHall: false, cotRequired: false, difficultyClimbingStairs: false,
                        localAssistance: 'Bhakti Devi Dasi',
                        recordingsNeeded: 'Evening Kirtan, Youth Session',
                        specialRequests: 'No spicy food for this attendee.'
                    }
                ]
            }
        }
    };

    // This array acts as a dummy for Sampark Group contacts, used for dropdowns
    const dummySamparkGroupContacts = [
        { name: 'Suhas Joglekar', mobile: '+917000000001' },
        { name: 'Sranjay Karande', mobile: '+917000000002' },
        { name: 'Madhavacharya Das', mobile: '+917000000003' }
    ];

    const dummySamparkGroupContactsForHashMap = [
        { name: 'Suhas Joglekar', mobile: '+917000000001' },
        { name: 'Sranjay Karande', mobile: '+917000000002' },
        { name: 'Madhavacharya Das', mobile: '+917000000003' }
    ];

    // Create a hashmap for quick lookup of Sampark Group contacts by mobile number
    // This is the only new global variable added.
    const dummySamparkGroupContactsMap = dummySamparkGroupContactsForHashMap.reduce((map, contact) => {
        map[contact.mobile] = contact;
        return map;
    }, {});


    // --- State Variables ---
    let registrationData = {
        mainRegistrant: {
            mobile: '',
            firstName: '',
            lastName: '',
            ref1: '',
            ref2: ''
        },
        travelDetails: {
            members: [] // Array to hold details for each person, including main registrant
        },
        registrationId: ''
    };
    let currentMemberIndex = 0; // To track which member's details we are collecting in the "Do Register" flow
    let isEditingExisting = false; // This flag will always be false in index.html

    // --- Theme Logic ---
    let isLightMode = false; // Default to dark mode

    function toggleTheme() {
        isLightMode = !isLightMode;
        if (isLightMode) {
            document.body.classList.add('light-theme');
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
            themeText.textContent = 'Light Mode';
        } else {
            document.body.classList.remove('light-theme');
            sunIcon.classList.remove('hidden');
            moonIcon.classList.add('hidden');
            themeText.textContent = 'Dark Mode';
        }
        localStorage.setItem('theme', isLightMode ? 'light' : 'dark'); // Save preference
    }

    // Apply saved theme on load
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
        isLightMode = false; // Will be true after toggleTheme()
        toggleTheme();
    } else {
        isLightMode = true; // Will be false after toggleTheme()
        toggleTheme(); // Set to dark mode initially if no preference or 'dark'
    }

    themeToggle.addEventListener('click', toggleTheme);

    // --- Zoom Logic ---
    let currentZoomLevel = 1.0; // Initial zoom level
    const zoomFactor = 1.25; // 25% increase/decrease
    const baseFontSize = 16; // px, corresponds to 1rem
    const baseChatMaxWidth = 640; // px, corresponds to Tailwind's max-w-xl
    const minZoom = 0.64; // Approx 16px * 0.64 = 10.24px. (1/1.25^2)
    const maxZoom = 1.95; // Approx 16px * 1.95 = 31.2px. (1.25^2)

    function updateZoom() {
        // Set global font size for root rem calculation
        document.documentElement.style.setProperty('--global-font-size', `${baseFontSize * currentZoomLevel}px`);
        // Adjust the max-width of the glass container for chat size
        document.documentElement.style.setProperty('--chat-max-width', `${baseChatMaxWidth * currentZoomLevel}px`);
    }

    zoomInBtn.addEventListener('click', () => {
        currentZoomLevel = Math.min(maxZoom, currentZoomLevel * zoomFactor);
        updateZoom();
    });

    zoomOutBtn.addEventListener('click', () => {
        currentZoomLevel = Math.max(minZoom, currentZoomLevel / zoomFactor);
        updateZoom();
    });

    // Initialize zoom level on load
    updateZoom();

    // --- Splash Screen & Initial Load Logic ---
    window.onload = () => {
      splashImage.classList.add('splash-image-style');
      splashImage.classList.remove('hidden');

      setTimeout(() => {
        splashImage.style.display = 'none';
        splashText.classList.remove('hidden');
        splashText.classList.add('animate-splash-text');

        setTimeout(() => {
          splashScreen.classList.add('animate-fade-out');
          splashScreen.addEventListener('animationend', () => {
            splashScreen.remove();
            mainContent.classList.remove('hidden');
            initFormFlow(); // Start the form flow after splash
          }, { once: true });
        }, 1500);
    }, 2000);
    };

    /**
     * Adds a message or form element to the interaction window.
     * @param {string} type - 'bot-message' or 'user-input-form'.
     * @param {string} contentHtml - HTML string for the content.
     * @param {string} [id] - Optional ID for the element.
     * @returns {HTMLElement} The created element.
     */
    function addInteractionElement(type, contentHtml, id = '') {
        const element = document.createElement('div');
        element.className = `interaction-bubble ${type}`;
        if (id) element.id = id;

        if (type === 'bot-message') {
            element.innerHTML = `
                <img src="${botAvatarSrc}" alt="Bot Avatar" class="bot-avatar">
                <div class="bot-text-content">
                    ${contentHtml}
                </div>
            `;
        } else {
            element.innerHTML = contentHtml;
        }

        interactionWindow.appendChild(element);

        // Use a timeout to trigger CSS transition for smooth appearance
        setTimeout(() => {
            element.classList.add('active'); // Always make new elements active
            scrollToBottom();
        }, 50); // Small delay to allow element to be added to DOM before transition
        return element;
    }

    /**
     * Shows a full-screen success animation and then hides it.
     * @param {function} callback - Function to call after the animation completes.
     */
    function showFullScreenSuccessAnimation(callback) {
        // Hide main content
        mainContent.classList.add('opacity-0');
        setTimeout(() => {
            mainContent.classList.add('hidden');
            // Show full screen success
            fullScreenSuccess.classList.remove('hidden');
            setTimeout(() => {
                fullScreenSuccess.classList.add('opacity-100');
            }, 50); // Small delay to ensure display is set before opacity transition

            // Hide full screen success after 2 seconds
            setTimeout(() => {
                fullScreenSuccess.classList.remove('opacity-100');
                fullScreenSuccess.classList.add('opacity-0');
                fullScreenSuccess.addEventListener('transitionend', () => {
                    fullScreenSuccess.classList.add('hidden');
                    // Show main content again
                    mainContent.classList.remove('hidden');
                    setTimeout(() => {
                        mainContent.classList.remove('opacity-0');
                        if (callback) callback();
                    }, 50); // Small delay for main content to become visible
                }, { once: true }); // Ensure event listener is removed after first use
            }, 2000); // Animation duration
        }, 500); // Fade out main content duration
    }

    /**
     * Displays a temporary message in the interaction window.
     * @param {string} message - The message to display.
     * @param {string} type - 'success' or 'error'.
     */
    function displayMessage(message, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `p-3 rounded-lg mt-4 text-center text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
        messageDiv.textContent = message;
        interactionWindow.appendChild(messageDiv);
        scrollToBottom();
        setTimeout(() => {
            messageDiv.remove();
        }, 3000); // Remove message after 3 seconds
    }

    /**
     * Shows a custom confirmation modal.
     * @param {string} title - The title for the modal.
     * @param {string} message - The message for the modal.
     * @param {string} confirmText - Text for the confirm button.
     * @returns {Promise<boolean>} Resolves to true if confirmed, false if cancelled.
     */
    function showConfirmationModal(title, message, confirmText) {
        return new Promise((resolve) => {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalConfirmBtn.textContent = confirmText;

            confirmationModal.classList.remove('hidden');
            setTimeout(() => confirmationModal.classList.add('active'), 50); // Fade in

            const handleConfirm = () => {
                confirmationModal.classList.remove('active');
                confirmationModal.addEventListener('transitionend', () => {
                    confirmationModal.classList.add('hidden');
                    resolve(true);
                }, { once: true });
            };

            const handleCancel = () => {
                confirmationModal.classList.remove('active');
                confirmationModal.addEventListener('transitionend', () => {
                    confirmationModal.classList.add('hidden');
                    resolve(false);
                }, { once: true });
            };

            modalConfirmBtn.onclick = handleConfirm;
            modalCancelBtn.onclick = handleCancel;
        });
    }


    /**
     * Disables all interactive elements within a given form element.
     * @param {HTMLElement} formElement - The form element to disable.
     * @param {boolean} [permanently=false] - If true, elements are disabled without retaining their value.
     */
    function disableFormElements(formElement, permanently = false) {
        formElement.querySelectorAll('input, button, select, textarea').forEach(el => {
            el.disabled = true;
            if (permanently) {
                el.style.pointerEvents = 'none'; // Make them truly unclickable
                el.style.opacity = '0.7'; // Visually indicate disabled
            }
        });
        // For radio button groups, ensure only the checked one is visually highlighted
        formElement.querySelectorAll('.radio-option input[type="radio"]:not(:checked)').forEach(radio => {
            radio.parentElement.style.opacity = '0.5';
        });
        formElement.querySelectorAll('.checkbox-option input[type="checkbox"]:not(:checked)').forEach(checkbox => {
            checkbox.parentElement.style.opacity = '0.5';
        });
    }

    /**
     * Enables all interactive elements within a given form element.
     * @param {HTMLElement} formElement - The form element to enable.
     */
    function enableFormElements(formElement) {
        formElement.querySelectorAll('input, button, select, textarea').forEach(el => {
            el.disabled = false;
            el.style.pointerEvents = '';
            el.style.opacity = '';
        });
        formElement.querySelectorAll('.radio-option, .checkbox-option').forEach(option => {
            option.style.opacity = '';
        });
    }


    /**
     * Scrolls the interaction window (now the glass container) to the bottom.
     */
    function scrollToBottom() {
        const glassContainer = document.querySelector('.glass-container');
        if (glassContainer) {
            glassContainer.scrollTop = glassContainer.scrollHeight;
        }
    }

    /**
     * Converts a DD|MM|YYYY date string to a JavaScript Date object.
     * @param {string} ddMmYyyy - Date string in DD|MM|YYYY format.
     * @returns {Date | null} A Date object or null if invalid format.
     */
    function convertDDMMYYYYtoJSDate(ddMmYyyy) {
        const parts = ddMmYyyy.split('|');
        if (parts.length === 3) {
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; // Month is 0-indexed
            const year = parseInt(parts[2], 10);
            const date = new Date(year, month, day);
            // Check if the date components actually match, in case of invalid dates (e.g., Feb 30)
            if (date.getFullYear() === year && date.getMonth() === month && date.getDate() === day) {
                return date;
            }
        }
        return null;
    }

    /**
     * Converts a Date object to YYYY-MM-DD string format (for internal use).
     * @param {Date} date - The Date object.
     * @returns {string} Date string in YYYY-MM-DD format.
     */
    function convertDateToYYYYMMDD(date) {
        return date.toISOString().split('T')[0];
    }

    /**
     * Converts a Date object to DD|MM|YYYY string format (for user display/input).
     * @param {Date} date - The Date object.
     * @returns {string} Date string in DD|MM|YYYY format.
     */
    function convertDateToDDMMYYYY(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}|${month}|${year}`;
    }

    // --- Country Codes for Phone Input ---
    const countryCodes = [
        { name: 'United States', code: '+1', placeholder: '123-456-7890' },
        { name: 'India', code: '+91', placeholder: '9876543210' },
        { name: 'United Kingdom', code: '+44', placeholder: '7911 123456' },
        { name: 'Canada', code: '+1', placeholder: '123-456-7890' },
        { name: 'Australia', code: '+61', placeholder: '412 345 678' },
        { name: 'Germany', code: '+49', placeholder: '170 1234567' },
        { name: 'France', code: '+33', placeholder: '6 12 34 56 78' },
        { name: 'Brazil', code: '+55', placeholder: '11 91234-5678' },
        { name: 'Mexico', code: '+52', placeholder: '55 1234 5678' },
        { name: 'China', code: '+86', placeholder: '138 0013 8000' },
        { name: 'Japan', code: '+81', placeholder: '90-1234-5678' },
        { name: 'South Africa', code: '+27', placeholder: '82 123 4567' },
        { name: 'New Zealand', code: '+64', placeholder: '21 123 4567' },
        // Add more countries as needed
    ];

    /**
     * Generates the HTML for a country code select dropdown.
     * @param {string} selectId - The ID for the select element.
     * @param {string} initialSelectedCode - The initially selected country code (e.g., '+91').
     * @returns {string} HTML string for the select dropdown.
     */
    function generateCountryCodeSelectHtml(selectId, initialSelectedCode = '+91') {
        const options = countryCodes.map(c =>
            `<option value="${c.code}" ${c.code === initialSelectedCode ? 'selected' : ''}>${c.name} (${c.code})</option>`
        ).join('');
        return `
            <select id="${selectId}" class="w-full p-2 rounded-lg bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">
                ${options}
            </select>
        `;
    }

    /**
     * Helper to attach event listener to a country code select to update a mobile input's placeholder.
     * @param {string} selectId - ID of the country code select.
     * @param {string} mobileInputId - ID of the mobile number input.
     */
    function setupCountryCodePlaceholderListener(selectId, mobileInputId) {
        const countryCodeSelect = document.getElementById(selectId);
        const mobileInput = document.getElementById(mobileInputId);
        if (countryCodeSelect && mobileInput) {
            const updatePlaceholder = () => {
                const selectedCode = countryCodeSelect.value;
                const selectedCountry = countryCodes.find(c => c.code === selectedCode);
                if (selectedCountry) {
                    mobileInput.placeholder = selectedCountry.placeholder;
                }
            };
            countryCodeSelect.addEventListener('change', updatePlaceholder);
            updatePlaceholder(); // Set initial placeholder
        }
    }

    /**
     * Adds the "Copy From Previous Member" section to a form.
     * @param {HTMLElement} formElement - The form element to add the section to.
     * @param {number} currentMemberIndex - The index of the member currently being edited.
     * @param {string} formId - The ID of the form, used by the copy function to find elements.
     */
    function addCopyFromPreviousSection(formElement, currentMemberIndex, formId) {
        if (currentMemberIndex === 0 || registrationData.travelDetails.members.length === 0) {
            return; // Only show if there are previous members
        }

        let optionsHtml = '<option value="">Select a member to copy from</option>';
        for (let i = 0; i < currentMemberIndex; i++) {
            const member = registrationData.travelDetails.members[i];
            optionsHtml += `<option value="${i}">${member.firstName} ${member.lastName || ''} (Person ${i + 1})</option>`;
        }

        const copySectionHtml = `
            <div class="bg-gray-700 bg-opacity-50 p-4 rounded-xl mb-6 border border-gray-600">
                <h3 class="text-lg font-semibold mb-3 text-white">Copy Details From Previous Member:</h3>
                <div class="flex flex-col sm:flex-row gap-3 items-center">
                    <select id="copy-from-member-select-${currentMemberIndex}-${formId}" class="flex-grow w-full sm:w-auto p-2 rounded-lg bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">
                        ${optionsHtml}
                    </select>
                    <button type="button" class="form-button flex-shrink-0" onclick="window.copyAndApplyMemberDetails(parseInt(document.getElementById('copy-from-member-select-${currentMemberIndex}-${formId}').value), ${currentMemberIndex}, '${formId}')">
                        <i class="fas fa-copy mr-2"></i> Copy
                    </button>
                </div>
            </div>
        `;
        // Insert at the beginning of the form content
        formElement.insertAdjacentHTML('afterbegin', copySectionHtml);
    }

    /**
     * Copies relevant data from a source member to a target member and updates the form UI.
     * Excludes copying `firstName` and `lastName`.
     * @param {number} sourceIndex - The index of the member to copy data FROM.
     * @param {number} targetIndex - The index of the member to copy data TO.
     * @param {string} formId - The ID of the current form being displayed.
     */
    window.copyAndApplyMemberDetails = function(sourceIndex, targetIndex, formId) {
        if (sourceIndex === "" || isNaN(sourceIndex) || sourceIndex === null) {
            displayMessage('Please select a member to copy from.', 'error');
            return;
        }

        const sourceMember = registrationData.travelDetails.members[sourceIndex];
        const targetMember = registrationData.travelDetails.members[targetIndex];
        const formElement = document.getElementById(formId);

        if (!sourceMember || !targetMember || !formElement) {
            console.error('Error: Source member, target member, or form element not found during copy operation.');
            displayMessage('An internal error occurred during copy. Please try again.', 'error');
            return;
        }

        console.log(`Copying from member ${sourceIndex} to member ${targetIndex} for form ${formId}`);
        console.log("Source data:", sourceMember);

        // Temporarily disable inputs to prevent user interaction during copy, then re-enable
        disableFormElements(formElement);

        // Use a short delay to ensure DOM is fully ready for updates after (re)rendering and disabling
        setTimeout(() => {
            try {
                // **DO NOT copy firstName and lastName directly to targetMember**
                // Create a shallow copy of sourceMember and then delete the properties you don't want to copy.
                // This ensures other nested objects like mealPreferences are deep copied.
                let tempSourceCopy = JSON.parse(JSON.stringify(sourceMember));
                delete tempSourceCopy.firstName;
                delete tempSourceCopy.lastName;

                // Merge the properties of tempSourceCopy into targetMember
                Object.assign(targetMember, tempSourceCopy);


                // Update inputs on the "Add People Form" if it's currently displayed
                // ONLY copy non-name fields
                // The name fields should remain untouched by this copy operation
                const memberAgeInput = document.getElementById(`member-age-${targetIndex}`);
                const memberGenderSelect = document.getElementById(`member-gender-${targetIndex}`);
                const memberMobileCountryCodeSelect = document.getElementById(`member-country-code-${targetIndex}`);
                const memberMobileInput = document.getElementById(`member-mobile-${targetIndex}`);

                if (memberAgeInput) {
                    memberAgeInput.value = targetMember.age;
                }
                if (memberGenderSelect) {
                    memberGenderSelect.value = targetMember.gender;
                    memberGenderSelect.dispatchEvent(new Event('change'));
                }
                if (memberMobileCountryCodeSelect) {
                    const initialCountryCode = targetMember.mobile ? targetMember.mobile.substring(0, targetMember.mobile.length - (targetMember.mobile.match(/\d/) ? targetMember.mobile.substring(targetMember.mobile.indexOf(targetMember.mobile.match(/\d/))).length : 0)) : '+91';
                    memberMobileCountryCodeSelect.value = initialCountryCode;
                    memberMobileCountryCodeSelect.dispatchEvent(new Event('change'));
                }
                if (memberMobileInput) {
                    memberMobileInput.value = targetMember.mobile ? targetMember.mobile.substring(targetMember.mobile.indexOf(targetMember.mobile.match(/\d/))) : '';
                }


                // Handle form-specific copying and UI updates for other forms
                switch (formId) {
                    case `arrival-departure-dates-form-${targetIndex}`:
                        formElement.querySelectorAll(`input[type="checkbox"][id^="attend-"]`).forEach(cb => {
                            cb.checked = targetMember.attendingDates.includes(cb.value);
                            cb.dispatchEvent(new Event('change')); // Ensure change is dispatched
                        });

                        const arrival12hr = convert24hrTo12hr(targetMember.arrivalTime);
                        const arrivalHourInput = document.getElementById(`arrival-hour-${targetIndex}`);
                        const arrivalMinuteInput = document.getElementById(`arrival-minute-${targetIndex}`);
                        const arrivalAmPmSelect = document.getElementById(`arrival-ampm-${targetIndex}`);
                        if(arrivalHourInput) arrivalHourInput.value = arrival12hr.hour;
                        if(arrivalMinuteInput) arrivalMinuteInput.value = arrival12hr.minute;
                        if(arrivalAmPmSelect) {
                            arrivalAmPmSelect.value = arrival12hr.ampm;
                            arrivalAmPmSelect.dispatchEvent(new Event('change'));
                        }

                        const departure12hr = convert24hrTo12hr(targetMember.departureTime);
                        const departureHourInput = document.getElementById(`departure-hour-${targetIndex}`);
                        const departureMinuteInput = document.getElementById(`departure-minute-${targetIndex}`);
                        const departureAmPmSelect = document.getElementById(`departure-ampm-${targetIndex}`);
                        if(departureHourInput) departureHourInput.value = departure12hr.hour;
                        if(departureMinuteInput) departureMinuteInput.value = departure12hr.minute;
                        if(departureAmPmSelect) {
                            departureAmPmSelect.value = departure12hr.ampm;
                            departureAmPmSelect.dispatchEvent(new Event('change'));
                        }

                        const travelModeSelect = document.getElementById(`travel-mode-${targetIndex}`);
                        if(travelModeSelect) {
                            travelModeSelect.value = targetMember.modeOfTransport;
                            travelModeSelect.dispatchEvent(new Event('change'));
                        }
                        const cityOfOriginInput = document.getElementById(`city-of-origin-${targetIndex}`);
                        if(cityOfOriginInput) cityOfOriginInput.value = targetMember.cityOfOrigin;
                        break;

                    case `accommodation-form-${targetIndex}`:
                        const stayYesRadio = document.getElementById(`stay-yes-${targetIndex}`);
                        const stayNoRadio = document.getElementById(`stay-no-${targetIndex}`);
                        if (stayYesRadio && stayNoRadio) {
                            if (targetMember.stayAtHall) {
                                stayYesRadio.checked = true;
                                stayYesRadio.dispatchEvent(new Event('change'));
                            } else {
                                stayNoRadio.checked = true;
                                stayNoRadio.dispatchEvent(new Event('change'));
                            }
                        }

                        const cotYesRadio = document.getElementById(`cot-yes-${targetIndex}`);
                        const cotNoRadio = document.getElementById(`cot-no-${targetIndex}`);
                        if (cotYesRadio && cotNoRadio) {
                            if (targetMember.cotRequired) {
                                cotYesRadio.checked = true;
                                cotYesRadio.dispatchEvent(new Event('change'));
                            } else {
                                cotNoRadio.checked = true;
                                cotNoRadio.dispatchEvent(new Event('change'));
                            }
                        }

                        const stairsYesRadio = document.getElementById(`stairs-yes-${targetIndex}`);
                        const stairsNoRadio = document.getElementById(`stairs-no-${targetIndex}`);
                        if (stairsYesRadio && stairsNoRadio) {
                            if (targetMember.difficultyClimbingStairs) {
                                stairsYesRadio.checked = true;
                                stairsYesRadio.dispatchEvent(new Event('change'));
                            } else {
                                stairsNoRadio.checked = true;
                                stairsNoRadio.dispatchEvent(new Event('change'));
                            }
                        }
                        // Re-trigger the toggleCotQuestion if applicable to update hidden/shown state
                        if (formId.includes('accommodation-form')) {
                            const cotQuestionDiv = document.getElementById(`cot-question-${targetIndex}`);
                            if (cotQuestionDiv) {
                                if (targetMember.stayAtHall) {
                                    cotQuestionDiv.classList.remove('hidden');
                                } else {
                                    cotQuestionDiv.classList.add('hidden');
                                }
                            }
                        }
                        break;

                    case `meal-preferences-form-${targetIndex}`:
                        const morningPrefRadio = document.getElementById(`morning-${targetMember.morningTeaCoffee.preference}-${targetIndex}`);
                        if (morningPrefRadio) {
                            morningPrefRadio.checked = true;
                            morningPrefRadio.dispatchEvent(new Event('change'));
                            if (['tea', 'coffee', 'both'].includes(targetMember.morningTeaCoffee.preference)) {
                                const morningSugarRadio = document.getElementById(`morning-sugar-${targetMember.morningTeaCoffee.sugar === 'sugar' ? 'yes' : 'no'}-${targetIndex}`);
                                if (morningSugarRadio) morningSugarRadio.checked = true;
                            }
                        }

                        targetMember.attendingDates.forEach(dateYYYYMMDD => {
                            const prefs = targetMember.mealPreferences[dateYYYYMMDD];
                            if (prefs) {
                                const breakfastCheckbox = document.getElementById(`breakfast-${targetIndex}-${dateYYYYMMDD}`);
                                if (breakfastCheckbox) {
                                     breakfastCheckbox.checked = prefs.breakfast;
                                     breakfastCheckbox.dispatchEvent(new Event('change'));
                                }
                                const lunchCheckbox = document.getElementById(`lunch-${targetIndex}-${dateYYYYMMDD}`);
                                if (lunchCheckbox) {
                                    lunchCheckbox.checked = prefs.lunch;
                                    lunchCheckbox.dispatchEvent(new Event('change'));
                                }
                                const highTeaCheckbox = document.getElementById(`high-tea-${targetIndex}-${dateYYYYMMDD}`);
                                if (highTeaCheckbox) {
                                    highTeaCheckbox.checked = prefs.highTea;
                                    highTeaCheckbox.dispatchEvent(new Event('change'));
                                }
                                const dinnerCheckbox = document.getElementById(`dinner-${targetIndex}-${dateYYYYMMDD}`);
                                if (dinnerCheckbox) {
                                    dinnerCheckbox.checked = prefs.dinner;
                                    dinnerCheckbox.dispatchEvent(new Event('change'));
                                }

                                const teaCoffeePrefRadio = document.getElementById(`${prefs.teaCoffeePreference}-${targetIndex}-${dateYYYYMMDD}`);
                                if (teaCoffeePrefRadio) {
                                    teaCoffeePrefRadio.checked = true;
                                    teaCoffeePrefRadio.dispatchEvent(new Event('change'));
                                    if (['tea', 'coffee', 'both'].includes(prefs.teaCoffeePreference)) {
                                        const sugarRadio = document.getElementById(`sugar-${prefs.teaCoffeeSugar === 'sugar' ? 'yes' : 'no'}-${targetIndex}-${dateYYYYMMDD}`);
                                        if (sugarRadio) sugarRadio.checked = true;
                                    }
                                }

                                const packedFoodYesRadio = document.getElementById(`packed-food-yes-${targetIndex}-${dateYYYYMMDD}`);
                                const packedFoodNoRadio = document.getElementById(`packed-food-no-${targetIndex}-${dateYYYYMMDD}`);
                                if (packedFoodYesRadio && packedFoodNoRadio) {
                                    if (prefs.packedFood) {
                                        packedFoodYesRadio.checked = true;
                                        packedFoodYesRadio.dispatchEvent(new Event('change'));
                                    } else {
                                        packedFoodNoRadio.checked = true;
                                        packedFoodNoRadio.dispatchEvent(new Event('change'));
                                    }
                                }
                            }
                        });
                        // Re-trigger sugar visibility logic for morning tea/coffee and daily meals
                        formElement.querySelectorAll(`input[name="morning-tea-coffee-${targetIndex}"]`).forEach(radio => {
                            if (radio.checked) radio.dispatchEvent(new Event('change'));
                        });
                        targetMember.attendingDates.forEach(dateYYYYMMDD => {
                            formElement.querySelectorAll(`input[name="tea-coffee-preference-${targetIndex}-${dateYYYYMMDD}"]`).forEach(radio => {
                                if (radio.checked) radio.dispatchEvent(new Event('change'));
                            });
                        });
                        break;

                    case `local-assistance-form-${targetIndex}`:
                        const assistanceYesRadio = document.getElementById(`assistance-yes-${targetIndex}`);
                        const assistanceNoRadio = document.getElementById(`assistance-no-${targetIndex}`);
                        const localAssistanceModeSelect = document.getElementById(`local-assistance-mode-${targetIndex}`);

                        if (assistanceYesRadio && assistanceNoRadio) {
                            if (targetMember.localAssistance) {
                                assistanceYesRadio.checked = true;
                                assistanceYesRadio.dispatchEvent(new Event('change'));
                                if (localAssistanceModeSelect) {
                                    localAssistanceModeSelect.value = targetMember.localAssistance;
                                    localAssistanceModeSelect.dispatchEvent(new Event('change'));
                                }
                            } else {
                                assistanceNoRadio.checked = true;
                                assistanceNoRadio.dispatchEvent(new Event('change'));
                            }
                        }

                        const recordingsTextarea = document.getElementById(`recordings-text-${targetIndex}`);
                        if (recordingsTextarea) recordingsTextarea.value = targetMember.recordingsNeeded;

                        const specialRequestsToggleYes = document.getElementById(`special-requests-toggle-${targetIndex}-yes`);
                        const specialRequestsToggleNo = document.getElementById(`special-requests-toggle-${targetIndex}-no`);
                        const specialRequestsTextarea = document.getElementById(`special-requests-text-${targetIndex}`);

                        if (specialRequestsToggleYes && specialRequestsToggleNo) {
                            if (targetMember.specialRequests) {
                                specialRequestsToggleYes.checked = true;
                                specialRequestsToggleYes.dispatchEvent(new Event('change'));
                                if (specialRequestsTextarea) specialRequestsTextarea.value = targetMember.specialRequests;
                            } else {
                                specialRequestsToggleNo.checked = true;
                                specialRequestsToggleNo.dispatchEvent(new Event('change'));
                            }
                        }
                        // Re-trigger assistance dropdown and special requests textarea visibility logic
                        if (formId.includes('local-assistance-form')) {
                            const assistanceChoiceRadios = formElement.querySelectorAll(`input[name="local-assistance-choice-${targetIndex}"]`);
                            assistanceChoiceRadios.forEach(radio => {
                                if (radio.checked) radio.dispatchEvent(new Event('change'));
                            });
                            const specialRequestsToggleRadios = formElement.querySelectorAll(`input[name="special-requests-toggle-${targetIndex}"]`);
                            specialRequestsToggleRadios.forEach(radio => {
                                if (radio.checked) radio.dispatchEvent(new Event('change'));
                            });
                        }
                        break;
                }

                displayMessage(`Details (excluding name) copied from ${sourceMember.firstName} ${sourceMember.lastName || ''}!`, 'success');
            } catch (e) {
                console.error('Error applying copied details to form UI:', e);
                displayMessage('An error occurred while copying details. Please check manually.', 'error');
            } finally {
                enableFormElements(formElement); // Always re-enable inputs
                scrollToBottom();
            }
        }, 50); // Small delay to allow DOM to settle after initial disable
    };


    // --- Core Form Flow Steps ---

    /**
     * Initializes the form flow. This now always starts a new registration.
     */
    function initFormFlow() {
        interactionWindow.innerHTML = ''; // Clear previous content
        finalGreetingSection.classList.remove('active');
        finalGreetingSection.classList.add('hidden');
        registrationData = { // Reset registrationData for new session
            mainRegistrant: { mobile: '', firstName: '', lastName: '', ref1: '', ref2: '' },
            travelDetails: { members: [] },
            registrationId: ''
        };
        currentMemberIndex = 0;
        isEditingExisting = false; // Always false for new registration flow

        // Initial bot greeting message
        addInteractionElement(
            'bot-message',
            `<span>Hello, I am Aditya Paranjape and I am here to help you with the July 2025 Pune Utsav Registration. The Utsav is held at the Swapnapoorti Hall, Pune. <a href="https://maps.app.goo.gl/YourGoogleMapsLink" target="_blank" class="text-blue-300 hover:underline">Click here</a> to see the Karyalaya venue. We are eagerly expecting you here!</span>`,
            'bot-initial-greeting'
        );
        // Directly proceed to asking for mobile number
        setTimeout(() => {
            addInteractionElement(
                'bot-message',
                `<span>Great! Let's get you registered. Please provide your contact number.</span>`,
                null
            );
            displayMobileInputForm(); // Directly proceed to mobile input
        }, 1500);
    }

    /**
     * Displays the mobile number input form with country code selector.
     */
    function displayMobileInputForm() {
        const formHtml = `
            <h2>Enter Contact Number</h2>
            <div class="form-field-group">
                <label for="country-code">Country Code:</label>
                ${generateCountryCodeSelectHtml('country-code')}
            </div>
            <div class="form-field-group">
                <label for="mobile-number">Mobile Number:</label>
                <input type="tel" id="mobile-number" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--form-button-bg)]" placeholder="9876543210">
                <div id="mobile-error" class="error-message"></div>
            </div>
            <button class="form-button" onclick="submitMobileNumber(this)">Continue</button>
        `;
        const formElement = addInteractionElement('user-input-form', formHtml, 'mobile-input-form');

        setupCountryCodePlaceholderListener('country-code', 'mobile-number');

        setTimeout(() => {
            const mobileInput = formElement.querySelector('#mobile-number');
            if (mobileInput) mobileInput.focus();
        }, 550);
    }

    /**
     * Handles submission of the mobile number.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     */
    function submitMobileNumber(button) {
        const countryCodeSelect = document.getElementById('country-code');
        const mobileInput = document.getElementById('mobile-number');
        const errorDiv = document.getElementById('mobile-error');
        const formElement = button.closest('.user-input-form');

        const countryCode = countryCodeSelect.value;
        const mobile = mobileInput.value.trim();
        const fullMobileNumber = countryCode + mobile;

        // Basic mobile number validation (digits only after country code)
        const mobileRegex = /^\+?\d{1,4}\d{7,15}$/; // Allows 7 to 15 digits after country code

        if (mobileRegex.test(fullMobileNumber)) {
            registrationData.mainRegistrant.mobile = fullMobileNumber;

            disableFormElements(formElement);
            button.textContent = 'Submitted!';
            addInteractionElement('user-input-form', `<span>My contact number is: ${fullMobileNumber}</span>`);

            // Always proceed to asking for name
            setTimeout(() => {
                addInteractionElement(
                    'bot-message',
                    `<span>Thank you. Now, please provide your first and last name. These are mandatory fields.</span>`,
                    null
                );
                displayManualMainRegistrantNameInput(); // Go straight to entering name
            }, 1000);
        } else {
            errorDiv.textContent = 'Please enter a valid mobile number (e.g., 9876543210 for +91)';
        }
    }


    /**
     * Displays form for user to manually input main registrant's first and last name.
     */
    function displayManualMainRegistrantNameInput() {
        const formHtml = `
            <h2>Enter Your Full Name</h2>
            <div class="form-field-group">
                <label for="manual-first-name">First Name:</label>
                <input type="text" id="manual-first-name" value="${registrationData.mainRegistrant.firstName}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="Your First Name">
                <div id="manual-first-name-error" class="error-message"></div>
            </div>
            <div class="form-field-group">
                <label for="manual-last-name">Last Name:</label>
                <input type="text" id="manual-last-name" value="${registrationData.mainRegistrant.lastName}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="Your Last Name">
                <div id="manual-last-name-error" class="error-message"></div>
            </div>
            <button class="form-button" onclick="submitManualNameInput(this)">Continue</button>
        `;
        const formElement = addInteractionElement('user-input-form', formHtml, 'manual-name-input-form');
        setTimeout(() => {
            const input = formElement.querySelector('#manual-first-name');
            if (input) input.focus();
        }, 550);
    }

    /**
     * Handles submission of manually entered main registrant name.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     */
    function submitManualNameInput(button) {
        const firstNameInput = document.getElementById('manual-first-name');
        const lastNameInput = document.getElementById('manual-last-name');
        const firstNameError = document.getElementById('manual-first-name-error');
        const lastNameError = document.getElementById('manual-last-name-error');
        const formElement = button.closest('.user-input-form');

        const firstName = firstNameInput.value.trim();
        const lastName = lastNameInput.value.trim();

        let isValid = true;
        if (firstName.length < 2) {
            firstNameError.textContent = 'First Name is required (min 2 chars).';
            isValid = false;
        } else {
            firstNameError.textContent = '';
        }

        if (lastName.length < 2) { // Last name is now mandatory
            lastNameError.textContent = 'Last Name is required (min 2 chars).';
            isValid = false;
        } else {
            lastNameError.textContent = '';
        }

        if (isValid) {
            registrationData.mainRegistrant.firstName = firstName;
            registrationData.mainRegistrant.lastName = lastName;

            disableFormElements(formElement);
            button.textContent = 'Submitted!';
            addInteractionElement('user-input-form', `<span>My name is: ${firstName} ${lastName}</span>`);

            // Proceed to Sampark Group details
            setTimeout(() => {
                addInteractionElement(
                    'bot-message',
                    `<span>Thank you, ${firstName}! Please provide two reference numbers from a Sampark Group for validation.</span>`,
                    null
                );
                displaySamparkGroupDetailsForm();
            }, 1000);
        }
    }

    /**
     * Displays form for Sampark Group reference numbers.
     */
    function displaySamparkGroupDetailsForm() {
        // Correctly handle mobile number for display by removing country code part
        const getMobileNumberOnly = (fullMobile) => {
            const match = fullMobile.match(/\d/);
            return match ? fullMobile.substring(fullMobile.indexOf(match[0])) : '';
        };

        const formHtml = `
            <h2>Sampark Group Details</h2>
            <p>Please enter two contact numbers from a Sampark Group for validation. <span class="text-sm text-yellow-200">(Note: This validation is currently simulated and will be integrated with a database later.)</span></p>
            <div class="form-field-group">
                <label for="sampark-ref1-country-code">Sampark Group Contact 1 (Country Code):</label>
                ${generateCountryCodeSelectHtml('sampark-ref1-country-code', registrationData.mainRegistrant.ref1 ? registrationData.mainRegistrant.ref1.substring(0, registrationData.mainRegistrant.ref1.length - getMobileNumberOnly(registrationData.mainRegistrant.ref1).length) : '+91')}
                <label for="sampark-ref1">Mobile Number:</label>
                <input type="tel" id="sampark-ref1" value="${getMobileNumberOnly(registrationData.mainRegistrant.ref1)}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="1234567890">
                <div id="sampark-ref1-error" class="error-message"></div>
            </div>
            <div class="form-field-group">
                <label for="sampark-ref2-country-code">Sampark Group Contact 2 (Country Code):</label>
                ${generateCountryCodeSelectHtml('sampark-ref2-country-code', registrationData.mainRegistrant.ref2 ? registrationData.mainRegistrant.ref2.substring(0, registrationData.mainRegistrant.ref2.length - getMobileNumberOnly(registrationData.mainRegistrant.ref2).length) : '+91')}
                <label for="sampark-ref2">Mobile Number:</label>
                <input type="tel" id="sampark-ref2" value="${getMobileNumberOnly(registrationData.mainRegistrant.ref2)}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="0987654321">
                <div id="sampark-ref2-error" class="error-message"></div>
            </div>
            <button class="form-button" onclick="submitSamparkGroupDetails(this)">Submit</button>
        `;
        const formElement = addInteractionElement('user-input-form', formHtml, 'sampark-group-form');

        setupCountryCodePlaceholderListener('sampark-ref1-country-code', 'sampark-ref1');
        setupCountryCodePlaceholderListener('sampark-ref2-country-code', 'sampark-ref2');

        setTimeout(() => {
            const input = formElement.querySelector('#sampark-ref1');
            if (input) input.focus();
        }, 550);
    }

    /**
     * Handles submission of Sampark Group reference numbers.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     */
    function submitSamparkGroupDetails(button) {
        const ref1Input = document.getElementById('sampark-ref1');
        const ref1CountryCode = document.getElementById('sampark-ref1-country-code');
        const ref2Input = document.getElementById('sampark-ref2');
        const ref2CountryCode = document.getElementById('sampark-ref2-country-code');

        const ref1Error = document.getElementById('sampark-ref1-error');
        const ref2Error = document.getElementById('sampark-ref2-error');
        const formElement = button.closest('.user-input-form');

        const fullRef1 = ref1CountryCode.value + ref1Input.value.trim();
        const fullRef2 = ref2CountryCode.value + ref2Input.value.trim();
        const mobileRegex = /^\+?\d{1,4}\d{7,15}$/;

        let isValid = true;
        if (!mobileRegex.test(fullRef1)) {
            ref1Error.textContent = 'Please enter a valid mobile number.';
            isValid = false;
        } else {
            ref1Error.textContent = '';
        }

        if (!mobileRegex.test(fullRef2)) {
            ref2Error.textContent = 'Please enter a valid mobile number.';
            isValid = false;
        } else {
            ref2Error.textContent = '';
        }

        // Check if both reference numbers exist in the hashmap
        const ref1Exists = !!dummySamparkGroupContactsMap[fullRef1];
        const ref2Exists = !!dummySamparkGroupContactsMap[fullRef2];

        if (isValid && ref1Exists && ref2Exists) {
            // *** DATABASE INTEGRATION POINT ***
            // In a real application, you would send ref1 and ref2 to a backend
            // for validation against a Sampark Group database.
            // For now, we simulate success if they are valid mobile numbers.
            console.log("Simulating Sampark Group validation...");
            registrationData.mainRegistrant.ref1 = fullRef1;
            registrationData.mainRegistrant.ref2 = fullRef2;

            disableFormElements(formElement);
            button.textContent = 'Submitted!';
            addInteractionElement('user-input-form', `<span>Sampark Group details submitted.</span>`);

            // Clear current chat messages for the full screen animation
            interactionWindow.innerHTML = '';

            showFullScreenSuccessAnimation(() => {
                // This callback runs AFTER the animation completes and main-content is back
                addInteractionElement(
                    'bot-message',
                    `<span>Welcome to Gurukul Utsav! Please select the number of people attending, including yourself, and provide their details.</span>`,
                    null
                );
                // Initialize main registrant as first member
                registrationData.travelDetails.members = [{
                    firstName: registrationData.mainRegistrant.firstName,
                    lastName: registrationData.mainRegistrant.lastName,
                    mobile: registrationData.mainRegistrant.mobile,
                    age: '', gender: '',
                    arrivalDate: '', arrivalTime: '', departureDate: '', departureTime: '',
                    attendingDates: [],
                    morningTeaCoffee: { preference: 'none', sugar: 'sugar' }, // Initialize new field
                    mealPreferences: {},
                    stayAtHall: false, cotRequired: false, difficultyClimbingStairs: false, // Initialize new field
                    modeOfTransport: '', cityOfOrigin: '',
                    localAssistance: '', recordingsNeeded: '',
                    specialRequests: '' // New field
                }];
                displayAddPeopleForm();
            });
        } else {
            // If validation fails (either regex or hashmap lookup)
            if (!ref1Exists || !ref2Exists) {
                ref1Error.textContent = 'One or both reference numbers are not recognized.';
                ref2Error.textContent = 'This activity seems suspicious. Please check the provided reference numbers.';
            }
            // Display bot message indicating the suspicious activity
            addInteractionElement('bot-message', `<span>This activity seems suspicious. Please check the provided reference numbers.</span>`);
        }
    }

    /**
     * Displays form to add multiple people to the registration.
     */
    function displayAddPeopleForm() {
        let membersHtml = '';
        registrationData.travelDetails.members.forEach((member, index) => {
            membersHtml += generateMemberInputsHtml(member, index);
        });

        const formHtml = `
            <h2>Attendees for Utsav</h2>
            <p>Please enter details for each person attending, including yourself. You can add or remove members.</p>
            <div id="dynamic-members-container">
                ${membersHtml}
            </div>
            <button class="form-button flex items-center justify-center gap-2 mt-4 mb-4" onclick="addDynamicMember()">
                <i class="fas fa-plus-circle"></i> Add Another Person
            </button>
            <button class="form-button" onclick="submitAddPeopleForm(this)">Continue to Details</button>
        `;
        const formElement = addInteractionElement('user-input-form', formHtml, 'add-people-form');

        // Initial focus on first member's first name
        setTimeout(() => {
            const firstMemberFirstNameInput = formElement.querySelector('#member-first-name-0');
            if (firstMemberFirstNameInput) firstMemberFirstNameInput.focus();
        }, 550);

        // Setup country code listeners for dynamically added members
        registrationData.travelDetails.members.forEach((member, index) => {
            setupCountryCodePlaceholderListener(`member-country-code-${index}`, `member-mobile-${index}`);
        });
    }

    /**
     * Generates HTML for a single member's input fields.
     * @param {Object} memberData - The member object from registrationData.travelDetails.members.
     * @param {number} index - The index of the member.
     * @returns {string} HTML string.
     */
    function generateMemberInputsHtml(memberData, index) {
        const firstName = memberData.firstName || '';
        const lastName = memberData.lastName || '';
        const age = memberData.age || '';
        // Extract country code from existing mobile number if available, otherwise default to +91
        const initialCountryCode = memberData.mobile ? memberData.mobile.substring(0, memberData.mobile.indexOf(memberData.mobile.match(/\d/))) : '+91';
        const mobileNumberOnly = memberData.mobile ? memberData.mobile.substring(memberData.mobile.indexOf(memberData.mobile.match(/\d/))) : '';
        const gender = memberData.gender || '';

        return `
            <div class="member-entry-dynamic" id="member-entry-${index}">
                <h4 class="text-lg font-medium mb-2">Person ${index + 1} ${index === 0 ? '(Main Registrant)' : ''}</h4>
                <div class="form-field-group flex flex-col sm:flex-row gap-4">
                    <div class="w-full sm:w-1/2">
                        <label for="member-first-name-${index}">First Name:</label>
                        <input type="text" id="member-first-name-${index}" value="${firstName}" class="w-full p-2 rounded-lg bg-[var(--form-field-bg)]" placeholder="First Name">
                        <div id="member-first-name-${index}-error" class="error-message"></div>
                    </div>
                    <div class="w-full sm:w-1/2">
                        <label for="member-last-name-${index}">Last Name:</label>
                        <input type="text" id="member-last-name-${index}" value="${lastName}" class="w-full p-2 rounded-lg bg-[var(--form-field-bg)]" placeholder="Last Name">
                        <div id="member-last-name-${index}-error" class="error-message"></div>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-4">
                    <div class="w-full sm:w-1/2 form-field-group">
                        <label for="member-age-${index}">Age:</label>
                        <input type="number" id="member-age-${index}" value="${age}" class="w-full p-2 rounded-lg bg-[var(--form-field-bg)]" placeholder="Age">
                        <div id="member-age-${index}-error" class="error-message"></div>
                    </div>
                    <div class="w-full sm:w-1/2 form-field-group">
                        <label for="member-gender-${index}">Gender:</label>
                        <select id="member-gender-${index}" class="w-full p-2 rounded-lg bg-[var(--form-field-bg)]">
                            <option value="">Select</option>
                            <option value="M" ${gender === 'M' ? 'selected' : ''}>Male</option>
                            <option value="F" ${gender === 'F' ? 'selected' : ''}>Female</option>
                        </select>
                        <div id="member-gender-${index}-error" class="error-message"></div>
                    </div>
                </div>
                <div class="form-field-group">
                    <label for="member-country-code-${index}">Contact Details (Country Code):</label>
                    ${generateCountryCodeSelectHtml(`member-country-code-${index}`, initialCountryCode)}
                    <label for="member-mobile-${index}">Phone Number:</label>
                    <input type="tel" id="member-mobile-${index}" value="${mobileNumberOnly}" class="w-full p-2 rounded-lg bg-[var(--form-field-bg)]" placeholder="e.g., 9876543210">
                    <div id="member-mobile-${index}-error" class="error-message"></div>
                </div>
                ${index > 0 ? `<button type="button" class="delete-member-button" onclick="removeDynamicMember(${index})"><i class="fas fa-trash-alt pr-1"></i>Remove</button>` : ''}
            </div>
        `;
    }

    /**
     * Adds a new set of member input fields dynamically.
     */
    function addDynamicMember() {
        const newIndex = registrationData.travelDetails.members.length;
        registrationData.travelDetails.members.push({
            firstName: '', lastName: '', age: '', gender: '', mobile: registrationData.mainRegistrant.mobile, // Default to main registrant's mobile
            arrivalDate: '', arrivalTime: '', departureDate: '', departureTime: '',
            attendingDates: [],
            morningTeaCoffee: { preference: 'none', sugar: 'sugar' }, // Initialize new field
            mealPreferences: {},
            stayAtHall: false, cotRequired: false, difficultyClimbingStairs: false, // Initialize new field
            modeOfTransport: '', cityOfOrigin: '',
            localAssistance: '', recordingsNeeded: '',
            specialRequests: '' // New field
        });
        const container = document.getElementById('dynamic-members-container');
        container.insertAdjacentHTML('beforeend', generateMemberInputsHtml(registrationData.travelDetails.members[newIndex], newIndex));
        scrollToBottom();
        // Setup country code listener for the newly added member
        setupCountryCodePlaceholderListener(`member-country-code-${newIndex}`, `member-mobile-${newIndex}`);
        document.getElementById(`member-first-name-${newIndex}`).focus();
    }

    /**
     * Removes a dynamically added member.
     * @param {number} indexToRemove - The index of the member to remove.
     */
    function removeDynamicMember(indexToRemove) {
        if (indexToRemove === 0) { // Prevent removing the main registrant
            // Using a custom modal for alert, as requested in previous instructions
            showConfirmationModal('Cannot Remove', 'The main registrant cannot be removed.', 'OK');
            return;
        }
        registrationData.travelDetails.members.splice(indexToRemove, 1);
        document.getElementById(`member-entry-${indexToRemove}`).remove();
        // Re-render the remaining members to update their indices and IDs
        const container = document.getElementById('dynamic-members-container');
        container.innerHTML = ''; // Clear existing
        registrationData.travelDetails.members.forEach((member, index) => {
            container.insertAdjacentHTML('beforeend', generateMemberInputsHtml(member, index));
        });
        scrollToBottom();
        // Re-setup country code listeners after re-rendering
        registrationData.travelDetails.members.forEach((member, index) => {
            setupCountryCodePlaceholderListener(`member-country-code-${index}`, `member-mobile-${index}`);
        });
    }

    /**
     * Submits the dynamic people form, validates, and proceeds.
     * @param {HTMLButtonElement} button - The button element.
     */
    function submitAddPeopleForm(button) {
        const formElement = button.closest('.user-input-form');
        let isValid = true;
        const mobileRegex = /^\+?\d{1,4}\d{7,15}$/;

        registrationData.travelDetails.members.forEach((member, index) => {
            const firstNameInput = document.getElementById(`member-first-name-${index}`);
            const lastNameInput = document.getElementById(`member-last-name-${index}`);
            const ageInput = document.getElementById(`member-age-${index}`);
            const genderSelect = document.getElementById(`member-gender-${index}`);
            const mobileCountryCodeSelect = document.getElementById(`member-country-code-${index}`);
            const mobileInput = document.getElementById(`member-mobile-${index}`);

            const firstNameError = document.getElementById(`member-first-name-${index}-error`);
            const lastNameError = document.getElementById(`member-last-name-${index}-error`);
            const ageError = document.getElementById(`member-age-${index}-error`);
            const genderError = document.getElementById(`member-gender-${index}-error`);
            const mobileError = document.getElementById(`member-mobile-${index}-error`);

            // First Name Validation - MANDATORY
            if (firstNameInput.value.trim().length < 2) {
                firstNameError.textContent = 'First Name is required (min 2 chars).';
                isValid = false;
            } else {
                firstNameError.textContent = '';
                member.firstName = firstNameInput.value.trim();
            }

            // Last Name Validation - MANDATORY
            if (lastNameInput.value.trim().length < 2) {
                lastNameError.textContent = 'Last Name is required (min 2 chars).';
                isValid = false;
            } else {
                lastNameError.textContent = '';
                member.lastName = lastNameInput.value.trim();
            }

            const age = parseInt(ageInput.value, 10);
            if (isNaN(age) || age < 1 || age > 120) {
                ageError.textContent = 'Valid age (1-120) is required.';
                isValid = false;
            } else {
                ageError.textContent = '';
                member.age = age;
            }

            if (!genderSelect.value) {
                genderError.textContent = 'Gender is required.';
                isValid = false;
            } else {
                genderError.textContent = '';
                member.gender = genderSelect.value;
            }

            const fullMemberMobileNumber = mobileCountryCodeSelect.value + mobileInput.value.trim();
            if (!mobileRegex.test(fullMemberMobileNumber)) {
                mobileError.textContent = 'Valid contact number required (e.g., +919876543210).';
                isValid = false;
            } else {
                mobileError.textContent = '';
                member.mobile = fullMemberMobileNumber;
            }
        });

        if (isValid) {
            disableFormElements(formElement);
            button.textContent = 'Submitted!';
            addInteractionElement('user-input-form', `<span>Details for ${registrationData.travelDetails.members.length} person(s) collected.</span>`);
            currentMemberIndex = 0; // Reset for per-person detail collection
            setTimeout(() => displayArrivalDepartureAndDatesForm(currentMemberIndex), 1000);
        } else {
            addInteractionElement('bot-message', `<span>Please correct the highlighted errors in the attendee details.</span>`);
        }
    }


    /**
     * Displays the arrival/departure dates (checkboxes) and time input for a specific member.
     * @param {number} memberIndex - The index of the member in registrationData.travelDetails.members.
     */
    function displayArrivalDepartureAndDatesForm(memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;

        // Convert 24-hour time to 12-hour for initial display
        const arrival12hr = convert24hrTo12hr(member.arrivalTime);
        const departure12hr = convert24hrTo12hr(member.departureTime);

        const formId = `arrival-departure-dates-form-${memberIndex}`;
        const formHtml = `
            <h2>Dates & Travel for ${memberName}</h2>
            <p>Please select the specific dates ${memberName} will be attending (July 2025) and provide arrival/departure times, and travel details.</p>

            <div class="form-field-group">
                <label>Which dates will ${memberName} be attending?</label>
                <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Ensure wrapping -->
                    <div class="checkbox-option">
                        <input type="checkbox" id="attend-08-jul-${memberIndex}" value="2025-07-08" ${member.attendingDates.includes('2025-07-08') ? 'checked' : ''}>
                        <label for="attend-08-jul-${memberIndex}">8 July</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="attend-09-jul-${memberIndex}" value="2025-07-09" ${member.attendingDates.includes('2025-07-09') ? 'checked' : ''}>
                        <label for="attend-09-jul-${memberIndex}">9 July</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="attend-10-jul-${memberIndex}" value="2025-07-10" ${member.attendingDates.includes('2025-07-10') ? 'checked' : ''}>
                        <label for="attend-10-jul-${memberIndex}">10 July</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="attend-11-jul-${memberIndex}" value="2025-07-11" ${member.attendingDates.includes('2025-07-11') ? 'checked' : ''}>
                        <label for="attend-11-jul-${memberIndex}">11 July</label>
                    </div>
                </div>
                <div id="attending-dates-error-${memberIndex}" class="error-message"></div>
            </div>

            <div class="form-field-group">
                <label>Expected Arrival Time:</label>
                <div class="custom-time-input-group flex-wrap"> <!-- Added flex-wrap -->
                    <input type="number" id="arrival-hour-${memberIndex}" min="1" max="12" value="${arrival12hr.hour}" class="p-3 rounded-xl bg-[var(--form-field-bg)] text-white w-20 flex-grow" placeholder="HH"> <!-- Adjusted width/flex-grow -->
                    <span class="text-white text-lg font-semibold">:</span>
                    <input type="number" id="arrival-minute-${memberIndex}" min="0" max="59" value="${arrival12hr.minute}" class="p-3 rounded-xl bg-[var(--form-field-bg)] text-white w-20 flex-grow" placeholder="MM"> <!-- Adjusted width/flex-grow -->
                    <select id="arrival-ampm-${memberIndex}" class="p-3 rounded-xl bg-[var(--form-field-bg)] text-white flex-grow min-w-[70px]"> <!-- Adjusted min-width -->
                        <option value="AM" ${arrival12hr.ampm === 'AM' ? 'selected' : ''}>AM</option>
                        <option value="PM" ${arrival12hr.ampm === 'PM' ? 'selected' : ''}>PM</option>
                    </select>
                </div>
                <div id="arrival-time-error-${memberIndex}" class="error-message"></div>
            </div>

            <div class="form-field-group">
                <label>Expected Departure Time:</label>
                <div class="custom-time-input-group flex-wrap"> <!-- Added flex-wrap -->
                    <input type="number" id="departure-hour-${memberIndex}" min="1" max="12" value="${departure12hr.hour}" class="p-3 rounded-xl bg-[var(--form-field-bg)] text-white w-20 flex-grow" placeholder="HH"> <!-- Adjusted width/flex-grow -->
                    <span class="text-white text-lg font-semibold">:</span>
                    <input type="number" id="departure-minute-${memberIndex}" min="0" max="59" value="${departure12hr.minute}" class="p-3 rounded-xl bg-[var(--form-field-bg)] text-white w-20 flex-grow" placeholder="MM"> <!-- Adjusted width/flex-grow -->
                    <select id="departure-ampm-${memberIndex}" class="p-3 rounded-xl bg-[var(--form-field-bg)] text-white flex-grow min-w-[70px]"> <!-- Adjusted min-width -->
                        <option value="AM" ${departure12hr.ampm === 'AM' ? 'selected' : ''}>AM</option>
                        <option value="PM" ${departure12hr.ampm === 'PM' ? 'selected' : ''}>PM</option>
                    </select>
                </div>
                <div id="departure-time-error-${memberIndex}" class="error-message"></div>
            </div>

            <div class="form-field-group">
                <label for="travel-mode-${memberIndex}">How are you coming? (Mode of Transport)</label>
                <select id="travel-mode-${memberIndex}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">
                    <option value="">Select Mode</option>
                    <option value="Car" ${member.modeOfTransport === 'Car' ? 'selected' : ''}>Car</option>
                    <option value="Train" ${member.modeOfTransport === 'Train' ? 'selected' : ''}>Train</option>
                    <option value="Flight" ${member.modeOfTransport === 'Flight' ? 'selected' : ''}>Flight</option>
                    <option value="Bus" ${member.modeOfTransport === 'Bus' ? 'selected' : ''}>Bus</option>
                    <option value="Other" ${member.modeOfTransport === 'Other' ? 'selected' : ''}>Other</option>
                </select>
                <div id="travel-mode-${memberIndex}-error" class="error-message"></div>
            </div>
            <div class="form-field-group">
                <label for="city-of-origin-${memberIndex}">From Where? (City of Origin)</label>
                <input type="text" id="city-of-origin-${memberIndex}" value="${member.cityOfOrigin}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" placeholder="e.g., Pune, Mumbai">
                <div id="city-of-origin-${memberIndex}-error" class="error-message"></div>
            </div>

            <button class="form-button mt-4" onclick="submitArrivalDepartureAndDates(this, ${memberIndex})">Continue</button>
        `;
        const formElement = addInteractionElement('user-input-form', formHtml, formId);

        // Add Copy From Previous Section
        addCopyFromPreviousSection(formElement, memberIndex, formId);


        setTimeout(() => {
            const firstCheckbox = formElement.querySelector(`input[type="checkbox"][id^="attend-"]`);
            if (firstCheckbox) firstCheckbox.focus();
        }, 550);
    }

    /**
     * Converts 24-hour time string (HH:MM) to 12-hour object {hour, minute, ampm}.
     * @param {string} time24 - Time in 24-hour format (e.g., "14:30").
     * @returns {Object} - Object with hour (1-12), minute, and ampm (AM/PM).
     */
    function convert24hrTo12hr(time24) {
        if (!time24) return { hour: '', minute: '', ampm: 'AM' };
        const [hour24, minute] = time24.split(':').map(Number);
        let hour = hour24 % 12;
        hour = hour === 0 ? 12 : hour; // Convert 0 to 12 AM, 12 to 12 PM
        const ampm = hour24 < 12 ? 'AM' : 'PM';
        return { hour: String(hour).padStart(2, '0'), minute: String(minute).padStart(2, '0'), ampm };
    }

    /**
     * Converts 12-hour components to 24-hour time string (HH:MM).
     * @param {string} hour12 - Hour in 12-hour format (1-12).
     * @param {string} minute - Minute (00-59).
     * @param {string} ampm - "AM" or "PM".
     * @returns {string} - Time in 24-hour format (e.g., "14:30").
     */
    function convert12hrTo24hr(hour12, minute, ampm) {
        let hour = parseInt(hour12, 10);
        if (ampm === 'PM' && hour !== 12) {
            hour += 12;
        } else if (ampm === 'AM' && hour === 12) {
            hour = 0; // 12 AM (midnight) is 00 in 24-hour
        }
        return `${String(hour).padStart(2, '0')}:${String(parseInt(minute, 10)).padStart(2, '0')}`;
    }

    /**
     * Handles submission of arrival/departure dates and times, plus travel details.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     * @param {number} memberIndex - The index of the current member.
     */
    function submitArrivalDepartureAndDates(button, memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const formElement = button.closest('.user-input-form');
        let isValid = true;

        const attendingDatesCheckboxes = Array.from(formElement.querySelectorAll(`input[type="checkbox"][id^="attend-"]:checked`)).map(cb => cb.value);
        const attendingDatesError = document.getElementById(`attending-dates-error-${memberIndex}`);

        if (attendingDatesCheckboxes.length === 0) {
            attendingDatesError.textContent = 'Please select at least one attending date.';
            isValid = false;
        } else {
            attendingDatesError.textContent = '';
            // Sort the dates to correctly determine arrival and departure
            attendingDatesCheckboxes.sort(); // Sorts YYYY-MM-DD strings lexicographically
            member.attendingDates = attendingDatesCheckboxes;
            member.arrivalDate = convertDateToDDMMYYYY(new Date(attendingDatesCheckboxes[0] + 'T00:00:00')); // Use 'T00:00:00' to avoid timezone issues
            member.departureDate = convertDateToDDMMYYYY(new Date(attendingDatesCheckboxes[attendingDatesCheckboxes.length - 1] + 'T00:00:00'));
        }

        const arrivalTimeError = document.getElementById(`arrival-time-error-${memberIndex}`);
        const departureTimeError = document.getElementById(`departure-time-error-${memberIndex}`);
        const travelModeError = document.getElementById(`travel-mode-${memberIndex}-error`);
        const cityOfOriginError = document.getElementById(`city-of-origin-${memberIndex}-error`);

        // If initial date validation passed, proceed with other validations
        if (isValid) {
            const arrivalHourInput = document.getElementById(`arrival-hour-${memberIndex}`);
            const arrivalMinuteInput = document.getElementById(`arrival-minute-${memberIndex}`);
            const arrivalAmPmSelect = document.getElementById(`arrival-ampm-${memberIndex}`);

            const departureHourInput = document.getElementById(`departure-hour-${memberIndex}`);
            const departureMinuteInput = document.getElementById(`departure-minute-${memberIndex}`);
            const departureAmPmSelect = document.getElementById(`departure-ampm-${memberIndex}`);

            const travelModeSelect = document.getElementById(`travel-mode-${memberIndex}`);
            const cityOfOriginInput = document.getElementById(`city-of-origin-${memberIndex}`);

            // Arrival Time Validation
            const arrivalHour = arrivalHourInput.value.trim();
            const arrivalMinute = arrivalMinuteInput.value.trim();
            const arrivalAmPm = arrivalAmPmSelect.value;
            if (!arrivalHour || !arrivalMinute || !arrivalAmPm || isNaN(parseInt(arrivalHour)) || parseInt(arrivalHour) < 1 || parseInt(arrivalHour) > 12 || isNaN(parseInt(arrivalMinute)) || parseInt(arrivalMinute) < 0 || parseInt(arrivalMinute) > 59) {
                arrivalTimeError.textContent = 'Please enter a valid arrival time (HH:MM AM/PM).';
                isValid = false;
            } else {
                arrivalTimeError.textContent = '';
                member.arrivalTime = convert12hrTo24hr(arrivalHour, arrivalMinute, arrivalAmPm);
            }

            // Departure Time Validation
            const departureHour = departureHourInput.value.trim();
            const departureMinute = departureMinuteInput.value.trim();
            const departureAmPm = departureAmPmSelect.value;
            if (!departureHour || !departureMinute || !departureAmPm || isNaN(parseInt(departureHour)) || parseInt(departureHour) < 1 || parseInt(departureHour) > 12 || isNaN(parseInt(departureMinute)) || parseInt(departureMinute) < 0 || parseInt(departureMinute) > 59) {
                departureTimeError.textContent = 'Please enter a valid departure time (HH:MM AM/PM).';
                isValid = false;
            } else {
                departureTimeError.textContent = '';
                member.departureTime = convert12hrTo24hr(departureHour, departureMinute, departureAmPm);
            }

            if (travelModeSelect.value === "") {
                travelModeError.textContent = 'Please select a mode of transport.';
                isValid = false;
            } else {
                travelModeError.textContent = '';
                member.modeOfTransport = travelModeSelect.value;
            }

            if (cityOfOriginInput.value.trim().length < 2) {
                cityOfOriginError.textContent = 'Please enter your city of origin.';
                isValid = false;
            } else {
                cityOfOriginError.textContent = '';
                member.cityOfOrigin = cityOfOriginInput.value.trim();
            }
        }

        if (isValid) {
            disableFormElements(formElement);
            button.textContent = 'Submitted!';
            addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s travel details confirmed.</span>`);

            setTimeout(() => displayAccommodationForm(memberIndex), 1000);
        } else {
            addInteractionElement('bot-message', `<span>Please correct the highlighted errors.</span>`);
        }
    }

    /**
     * Displays accommodation questions for a specific member.
     * @param {number} memberIndex - The index of the member.
     */
    function displayAccommodationForm(memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;

        const formId = `accommodation-form-${memberIndex}`;
        const formHtml = `
            <h2>Accommodation for ${memberName}</h2>
            <div class="form-field-group">
                <label>Will ${memberName} be staying at Swapnapoorti Hall overnight?</label>
                <div class="flex flex-wrap items-center gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                    <div class="radio-option">
                        <input type="radio" id="stay-yes-${memberIndex}" name="stay-at-hall-${memberIndex}" value="yes" ${member.stayAtHall ? 'checked' : ''}>
                        <label for="stay-yes-${memberIndex}">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="stay-no-${memberIndex}" name="stay-at-hall-${memberIndex}" value="no" ${!member.stayAtHall ? 'checked' : ''}>
                        <label for="stay-no-${memberIndex}">No</label>
                    </div>
                </div>
            </div>
            <div id="cot-question-${memberIndex}" class="form-field-group ${member.stayAtHall ? '' : 'hidden'}">
                <label>Do you require a cot?</label>
                <div class="flex flex-wrap items-center gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                    <div class="radio-option">
                        <input type="radio" id="cot-yes-${memberIndex}" name="cot-required-${memberIndex}" value="yes" ${member.cotRequired ? 'checked' : ''}>
                        <label for="cot-yes-${memberIndex}">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="cot-no-${memberIndex}" name="cot-required-${memberIndex}" value="no" ${!member.cotRequired ? 'checked' : ''}>
                        <label for="cot-no-${memberIndex}">No</label>
                    </div>
                </div>
            </div>

            <!-- New: Difficulty Climbing Stairs -->
            <div class="form-field-group">
                <label>Do you have difficulty climbing stairs?</label>
                <div class="flex flex-wrap items-center gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                    <div class="radio-option">
                        <input type="radio" id="stairs-yes-${memberIndex}" name="difficulty-climbing-stairs-${memberIndex}" value="yes" ${member.difficultyClimbingStairs ? 'checked' : ''}>
                        <label for="stairs-yes-${memberIndex}">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="stairs-no-${memberIndex}" name="difficulty-climbing-stairs-${memberIndex}" value="no" ${!member.difficultyClimbingStairs ? 'checked' : ''}>
                        <label for="stairs-no-${memberIndex}">No</label>
                    </div>
                </div>
            </div>

            <button class="form-button mt-4" onclick="submitAccommodation(this, ${memberIndex})">Continue</button>
        `;
        const formElement = addInteractionElement('user-input-form', formHtml, formId);

        // Add Copy From Previous Section
        addCopyFromPreviousSection(formElement, memberIndex, formId);

        // Add event listener to show/hide cot question
        const stayYesRadio = document.getElementById(`stay-yes-${memberIndex}`);
        const stayNoRadio = document.getElementById(`stay-no-${memberIndex}`);
        const cotQuestionDiv = document.getElementById(`cot-question-${memberIndex}`);

        const toggleCotQuestion = () => {
            if (stayYesRadio.checked) {
                cotQuestionDiv.classList.remove('hidden');
            } else {
                cotQuestionDiv.classList.add('hidden');
            }
        };

        if (stayYesRadio && stayNoRadio && cotQuestionDiv) {
            stayYesRadio.addEventListener('change', toggleCotQuestion);
            stayNoRadio.addEventListener('change', toggleCotQuestion);
            toggleCotQuestion(); // Call initially to set correct state
        }
    }

    /**
     * Handles submission of accommodation details.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     * @param {number} memberIndex - The index of the current member.
     */
    function submitAccommodation(button, memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const formElement = button.closest('.user-input-form');

        member.stayAtHall = document.querySelector(`input[name="stay-at-hall-${memberIndex}"]:checked`)?.value === 'yes' || false;
        if (member.stayAtHall) {
            member.cotRequired = document.querySelector(`input[name="cot-required-${memberIndex}"]:checked`)?.value === 'yes' || false;
        } else {
            member.cotRequired = false; // Reset if not staying at hall
        }

        // New: Difficulty Climbing Stairs
        member.difficultyClimbingStairs = document.querySelector(`input[name="difficulty-climbing-stairs-${memberIndex}"]:checked`)?.value === 'yes' || false;

        disableFormElements(formElement);
        button.textContent = 'Submitted!';
        addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s accommodation details confirmed.</span>`);

        // Now, proceed to meal preferences based on stayAtHall
        if (member.stayAtHall) {
            setTimeout(() => {
                addInteractionElement(
                    'bot-message',
                    `<span>As ${member.firstName} ${member.lastName} will be staying at Swapnapoorti Hall, it is assumed that they will have all morning tea, breakfast, lunch, high tea, and dinner at the Karyalaya itself. You can still customize these preferences below if needed.</span>`,
                    null
                );
                displayMealPreferencesForm(memberIndex, true); // Pass true for auto-tick
            }, 1000);
        } else {
            // Conditional question: "Do you need lunch on 8th?" if attending on 8th AND NOT staying at hall
            if (member.attendingDates.includes('2025-07-08')) {
                setTimeout(() => {
                    addInteractionElement(
                        'bot-message',
                        `<span>As ${member.firstName} ${member.lastName} will be attending on 8th July, do they need afternoon lunch on that day?</span>`,
                        null
                    );
                    displayLunchOn8thForm(memberIndex);
                }, 1000);
            } else {
                // If not attending on 8th, proceed directly to general meal preferences
                setTimeout(() => displayMealPreferencesForm(memberIndex, false), 1000);
            }
        }
    }


    /**
     * Displays a form asking if lunch is needed on July 8th (if attending on that day).
     * This is only for non-hall stayers.
     * @param {number} memberIndex - The index of the member.
     */
    function displayLunchOn8thForm(memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const formId = `lunch-8th-form-${memberIndex}`;
        const formHtml = `
            <h2>Lunch on 8th July for ${member.firstName} ${member.lastName}?</h2>
            <p>Since ${member.firstName} ${member.lastName} will be attending on July 8th, would they like lunch on that day?</p>
            <div class="flex flex-wrap items-center gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                <div class="radio-option">
                    <input type="radio" id="lunch-8th-yes-${memberIndex}" name="lunch-8th-${memberIndex}" value="yes" ${member.mealPreferences['2025-07-08']?.lunch ? 'checked' : ''}>
                    <label for="lunch-8th-yes-${memberIndex}">Yes, I need lunch.</label>
                </div>
                <div class="radio-option">
                    <input type="radio" id="lunch-8th-no-${memberIndex}" name="lunch-8th-${memberIndex}" value="no" ${!member.mealPreferences['2025-07-08']?.lunch ? 'checked' : ''}>
                    <label for="lunch-8th-no-${memberIndex}">No, thank you.</label>
                </div>
            </div>
            <button class="form-button mt-4" onclick="submitLunchOn8th(this, ${memberIndex})">Submit</button>
        `;
        addInteractionElement('user-input-form', formHtml, formId);
    }

    /**
     * Handles submission of lunch preference for July 8th.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     * @param {number} memberIndex - The index of the member.
     */
    function submitLunchOn8th(button, memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const lunchOn8th = document.querySelector(`input[name="lunch-8th-${memberIndex}"]:checked`)?.value === 'yes' || false;
        const formElement = button.closest('.user-input-form');

        disableFormElements(formElement);
        button.textContent = 'Submitted!';
        addInteractionElement('user-input-form', `<span>Lunch on 8th July for ${member.firstName} ${member.lastName}: ${lunchOn8th ? 'Yes' : 'No'}</span>`);

        const july8thYYYYMMDD = '2025-07-08';
        // Initialize meal preferences for 8th July if it's not already there
        if (!member.mealPreferences[july8thYYYYMMDD]) {
            member.mealPreferences[july8thYYYYMMDD] = { breakfast: false, lunch: false, highTea: false, dinner: false, teaCoffeePreference: 'none', teaCoffeeSugar: 'sugar', packedFood: false };
        }
        member.mealPreferences[july8thYYYYMMDD].lunch = lunchOn8th;

        setTimeout(() => displayMealPreferencesForm(memberIndex, false), 1000); // Now proceed to full meal prefs, explicitly NOT auto-ticking
    }


    /**
     * Displays meal preferences form for a specific member based on their attending dates.
     * @param {number} memberIndex - The index of the member.
     * @param {boolean} [autoTickMeals=false] - If true, pre-selects all meals and coffee/sugar.
     */
    function displayMealPreferencesForm(memberIndex, autoTickMeals = false) {
        const member = registrationData.travelDetails.members[memberIndex];
        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;
        const attendingDatesYYYYMMDD = member.attendingDates; // Array of YYYY-MM-DD strings
        const derivedDepartureDateYYYYMMDD = attendingDatesYYYYMMDD.length > 0 ? attendingDatesYYYYMMDD[attendingDatesYYYYMMDD.length - 1] : '';

        const formId = `meal-preferences-form-${memberIndex}`;
        let formHtml = `
            <h2>Meal Preferences for ${memberName}</h2>
            <p>Please select meal and drink preferences for each day ${memberName} will be attending.</p>
        `;

        // Pre-fill existing morning tea/coffee preferences or set auto-tick defaults
        const defaultMorningTeaCoffeePref = autoTickMeals ? 'coffee' : (member.morningTeaCoffee.preference || 'none');
        const defaultMorningTeaCoffeeSugar = autoTickMeals ? 'sugar' : (member.morningTeaCoffee.sugar || 'sugar');

        formHtml += `
            <div class="timetable-entry">
                <h3>Morning Tea/Coffee</h3>
                <div class="form-field-group">
                    <label>Preference:</label>
                    <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                        <div class="radio-option">
                            <input type="radio" id="morning-tea-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="tea" ${defaultMorningTeaCoffeePref === 'tea' ? 'checked' : ''}>
                            <label for="morning-tea-${memberIndex}">Tea</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="morning-coffee-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="coffee" ${defaultMorningTeaCoffeePref === 'coffee' ? 'checked' : ''}>
                            <label for="morning-coffee-${memberIndex}">Coffee</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="morning-both-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="both" ${defaultMorningTeaCoffeePref === 'both' ? 'checked' : ''}>
                            <label for="morning-both-${memberIndex}">Both</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="morning-none-${memberIndex}" name="morning-tea-coffee-${memberIndex}" value="none" ${defaultMorningTeaCoffeePref === 'none' ? 'checked' : ''}>
                            <label for="morning-none-${memberIndex}">None</label>
                        </div>
                    </div>
                </div>
                <div id="morning-sugar-question-${memberIndex}" class="form-field-group mt-2 ${['tea', 'coffee', 'both'].includes(defaultMorningTeaCoffeePref) ? '' : 'hidden'}">
                    <label>Sugar Preference:</label>
                    <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                        <div class="radio-option">
                            <input type="radio" id="morning-sugar-yes-${memberIndex}" name="morning-tea-coffee-sugar-${memberIndex}" value="sugar" ${defaultMorningTeaCoffeeSugar === 'sugar' ? 'checked' : ''}>
                            <label for="morning-sugar-yes-${memberIndex}">With Sugar</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="morning-sugar-no-${memberIndex}" name="morning-tea-coffee-sugar-${memberIndex}" value="no-sugar" ${defaultMorningTeaCoffeeSugar === 'no-sugar' ? 'checked' : ''}>
                            <label for="morning-sugar-no-${memberIndex}">No Sugar</label>
                        </div>
                    </div>
                </div>
            </div>
        `;


        if (attendingDatesYYYYMMDD.length === 0) {
            formHtml += `<p class="text-yellow-200">No dates selected for this person. Please go back and select dates.</p>`;
        } else {
            attendingDatesYYYYMMDD.forEach(dateYYYYMMDD => {
                const date = new Date(dateYYYYMMDD + 'T00:00:00'); // Ensure consistent date parsing
                const displayDate = date.toLocaleDateString('en-IN', { weekday: 'short', month: 'short', day: 'numeric' });
                const isDepartureDay = dateYYYYMMDD === derivedDepartureDateYYYYMMDD;

                // Pre-fill existing preferences or set auto-tick defaults
                const existingPrefs = member.mealPreferences[dateYYYYMMDD] || {};
                const defaultBreakfast = autoTickMeals ? true : (existingPrefs.breakfast || false);
                const defaultLunch = autoTickMeals ? true : (existingPrefs.lunch || false);
                const defaultHighTea = autoTickMeals ? true : (existingPrefs.highTea || false);
                const defaultDinner = autoTickMeals ? true : (existingPrefs.dinner || false);
                const defaultTeaCoffeePreference = autoTickMeals ? 'coffee' : (existingPrefs.teaCoffeePreference || 'none'); // Default to coffee
                const defaultTeaCoffeeSugar = autoTickMeals ? 'sugar' : (existingPrefs.teaCoffeeSugar || 'sugar'); // Default to sugar
                const defaultPackedFood = autoTickMeals ? false : (existingPrefs.packedFood || false); // Don't auto-tick packed food

                formHtml += `
                    <div class="timetable-entry">
                        <h3>${displayDate}</h3>
                        <div class="form-field-group">
                            <label>Meals:</label>
                            <div class="flex flex-wrap gap-x-4 gap-y-2">
                                ${dateYYYYMMDD !== '2025-07-08' ? `
                                <div class="checkbox-option">
                                    <input type="checkbox" id="breakfast-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-breakfast" value="yes" ${defaultBreakfast ? 'checked' : ''}>
                                    <label for="breakfast-${memberIndex}-${dateYYYYMMDD}">Breakfast</label>
                                </div>
                                ` : ''}
                                <div class="checkbox-option">
                                    <input type="checkbox" id="lunch-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-lunch" value="yes" ${defaultLunch ? 'checked' : ''}>
                                    <label for="lunch-${memberIndex}-${dateYYYYMMDD}">Lunch</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="high-tea-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-highTea" value="yes" ${defaultHighTea ? 'checked' : ''}>
                                    <label for="high-tea-${memberIndex}-${dateYYYYMMDD}">High Tea</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="dinner-${memberIndex}-${dateYYYYMMDD}" name="meal-${memberIndex}-${dateYYYYMMDD}-dinner" value="yes" ${defaultDinner ? 'checked' : ''}>
                                    <label for="dinner-${memberIndex}-${dateYYYYMMDD}">Dinner</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-field-group">
                            <label>Tea/Coffee Preference (During meals):</label>
                            <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                                <div class="radio-option">
                                    <input type="radio" id="tea-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="tea" ${defaultTeaCoffeePreference === 'tea' ? 'checked' : ''}>
                                    <label for="tea-${memberIndex}-${dateYYYYMMDD}">Tea</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="coffee-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="coffee" ${defaultTeaCoffeePreference === 'coffee' ? 'checked' : ''}>
                                    <label for="coffee-${memberIndex}-${dateYYYYMMDD}">Coffee</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="both-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="both" ${defaultTeaCoffeePreference === 'both' ? 'checked' : ''}>
                                    <label for="both-${memberIndex}-${dateYYYYMMDD}">Both</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="none-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}" value="none" ${defaultTeaCoffeePreference === 'none' ? 'checked' : ''}>
                                    <label for="none-${memberIndex}-${dateYYYYMMDD}">None</label>
                                </div>
                            </div>
                        </div>
                        <div id="sugar-question-${memberIndex}-${dateYYYYMMDD}" class="form-field-group mt-2 ${['tea', 'coffee', 'both'].includes(defaultTeaCoffeePreference) ? '' : 'hidden'}">
                            <label>Sugar Preference (During meals):</label>
                            <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                                <div class="radio-option">
                                    <input type="radio" id="sugar-yes-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}" value="sugar" ${defaultTeaCoffeeSugar === 'sugar' ? 'checked' : ''}>
                                    <label for="sugar-yes-${memberIndex}-${dateYYYYMMDD}">With Sugar</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="sugar-no-${memberIndex}-${dateYYYYMMDD}" name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}" value="no-sugar" ${defaultTeaCoffeeSugar === 'no-sugar' ? 'checked' : ''}>
                                    <label for="sugar-no-${memberIndex}-${dateYYYYMMDD}">No Sugar</label>
                                </div>
                            </div>
                        </div>
                        ${isDepartureDay ? `
                            <div class="form-field-group">
                                <label>Need Packed Lunch/Dinner while leaving?</label>
                                <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                                    <div class="radio-option">
                                        <input type="radio" id="packed-food-yes-${memberIndex}-${dateYYYYMMDD}" name="packed-food-${memberIndex}-${dateYYYYMMDD}" value="yes" ${defaultPackedFood ? 'checked' : ''}>
                                        <label for="packed-food-yes-${memberIndex}-${dateYYYYMMDD}">Yes</label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="packed-food-no-${memberIndex}-${dateYYYYMMDD}" name="packed-food-${memberIndex}-${dateYYYYMMDD}" value="no" ${!defaultPackedFood ? 'checked' : ''}>
                                        <label for="packed-food-no-${memberIndex}-${dateYYYYMMDD}">No</label>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
        }

        formHtml += `<button class="form-button mt-6" onclick="submitMealPreferences(this, ${memberIndex})">Submit Preferences for ${memberName}</button>`;
        const formElement = addInteractionElement('user-input-form', formHtml, formId);

        // Add Copy From Previous Section
        addCopyFromPreviousSection(formElement, memberIndex, formId);


        // Add event listeners for morning tea/coffee sugar preference visibility
        const morningTeaCoffeeRadios = formElement.querySelectorAll(`input[name="morning-tea-coffee-${memberIndex}"]`);
        const morningSugarQuestionDiv = document.getElementById(`morning-sugar-question-${memberIndex}`);
        if (morningTeaCoffeeRadios && morningSugarQuestionDiv) {
            morningTeaCoffeeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (['tea', 'coffee', 'both'].includes(radio.value)) {
                        morningSugarQuestionDiv.classList.remove('hidden');
                    } else {
                        morningSugarQuestionDiv.classList.add('hidden');
                        formElement.querySelectorAll(`input[name="morning-tea-coffee-sugar-${memberIndex}"]`).forEach(sugRadio => sugRadio.checked = false);
                    }
                });
            });
        }

        // Add event listeners for tea/coffee sugar preference visibility (during meals)
        attendingDatesYYYYMMDD.forEach(dateYYYYMMDD => {
            const teaCoffeeRadios = formElement.querySelectorAll(`input[name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}"]`);
            const sugarQuestionDiv = document.getElementById(`sugar-question-${memberIndex}-${dateYYYYMMDD}`);
            if (teaCoffeeRadios && sugarQuestionDiv) {
                teaCoffeeRadios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        if (['tea', 'coffee', 'both'].includes(radio.value)) {
                            sugarQuestionDiv.classList.remove('hidden');
                        } else {
                            sugarQuestionDiv.classList.add('hidden');
                            // Optionally uncheck sugar preferences if "None" is selected
                            formElement.querySelectorAll(`input[name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}"]`).forEach(sugRadio => sugRadio.checked = false);
                        }
                    });
                });
            }
        });
    }

    /**
     * Handles submission of meal preferences for a specific member.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     * @param {number} memberIndex - The index of the current member.
     */
    function submitMealPreferences(button, memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const formElement = button.closest('.user-input-form');
        member.mealPreferences = {}; // Reset before collecting

        // Capture Morning Tea/Coffee
        const morningTeaCoffeePref = document.querySelector(`input[name="morning-tea-coffee-${memberIndex}"]:checked`)?.value || 'none';
        let morningTeaCoffeeSug = 'sugar';
        if(['tea', 'coffee', 'both'].includes(morningTeaCoffeePref)) {
            morningTeaCoffeeSug = document.querySelector(`input[name="morning-tea-coffee-sugar-${memberIndex}"]:checked`)?.value || 'sugar';
        }
        member.morningTeaCoffee = { preference: morningTeaCoffeePref, sugar: morningTeaCoffeeSug };


        member.attendingDates.forEach(dateYYYYMMDD => {
            const derivedDepartureDateYYYYMMDD = member.attendingDates.length > 0 ? member.attendingDates[member.attendingDates.length - 1] : '';
            const isDepartureDay = dateYYYYMMDD === derivedDepartureDateYYYYMMDD;

            const teaCoffeePref = document.querySelector(`input[name="tea-coffee-preference-${memberIndex}-${dateYYYYMMDD}"]:checked`)?.value || 'none';
            let teaCoffeeSug = 'sugar'; // Default sugar
            if(['tea', 'coffee', 'both'].includes(teaCoffeePref)) {
                teaCoffeeSug = document.querySelector(`input[name="tea-coffee-sugar-${memberIndex}-${dateYYYYMMDD}"]:checked`)?.value || 'sugar';
            }

            member.mealPreferences[dateYYYYMMDD] = {
                breakfast: (dateYYYYMMDD !== '2025-07-08' && document.getElementById(`breakfast-${memberIndex}-${dateYYYYMMDD}`)) ? document.getElementById(`breakfast-${memberIndex}-${dateYYYYMMDD}`).checked : false, // Exclude breakfast for July 8th
                lunch: document.getElementById(`lunch-${memberIndex}-${dateYYYYMMDD}`)?.checked || false,
                highTea: document.getElementById(`high-tea-${memberIndex}-${dateYYYYMMDD}`)?.checked || false,
                dinner: document.getElementById(`dinner-${memberIndex}-${dateYYYYMMDD}`)?.checked || false,
                teaCoffeePreference: teaCoffeePref,
                teaCoffeeSugar: teaCoffeeSug,
            };

            // Only add packed food if it was an option for this day (i.e., it's the departure date for this member)
            if (isDepartureDay && document.querySelector(`input[name="packed-food-yes-${memberIndex}-${dateYYYYMMDD}"]`)) {
                 member.mealPreferences[dateYYYYMMDD].packedFood = document.querySelector(`input[name="packed-food-${memberIndex}-${dateYYYYMMDD}"]:checked`)?.value === 'yes' || false;
            } else {
                 member.mealPreferences[dateYYYYMMDD].packedFood = false; // Ensure it's false if not on departure day or option not present
            }
        });

        disableFormElements(formElement);
        button.textContent = 'Submitted!';
        addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s meal preferences confirmed.</span>`);

        setTimeout(() => displayLocalAssistanceForm(memberIndex), 1000);
    }

    /**
     * Displays local travel assistance and recordings questions for a member.
     * @param {number} memberIndex - The index of the member.
     */
    function displayLocalAssistanceForm(memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const memberName = `${member.firstName} ${member.lastName}`.trim() || `Person ${memberIndex + 1}`;

        // Updated assistance options to show name and mobile number
        let assistanceOptionsHtml = dummySamparkGroupContacts.map(contact =>
            `<option value="${contact.name}" ${member.localAssistance === contact.name ? 'selected' : ''}>${contact.name} (${contact.mobile})</option>`
        ).join('');

        // Use textarea for recordings
        const recordingsInputHtml = `
            <div class="form-field-group">
                <label for="recordings-text-${memberIndex}">Programs for which you need recordings (enter names, separated by commas if multiple):</label>
                <textarea id="recordings-text-${memberIndex}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" rows="3" placeholder="e.g., Morning Lecture on Bhagavad-Gita, Evening Kirtan of Vraja-dhama">${member.recordingsNeeded || ''}</textarea>
            </div>
        `;

        // New: Special requests Yes/No with conditional textarea
        const specialRequestsToggleId = `special-requests-toggle-${memberIndex}`;
        const specialRequestsTextareaId = `special-requests-text-${memberIndex}`;
        const initialSpecialRequestsChecked = member.specialRequests && member.specialRequests.trim() !== '';

        const specialRequestsHtml = `
            <div class="form-field-group">
                <label>Do you have any special requests?</label>
                <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                    <div class="radio-option">
                        <input type="radio" id="${specialRequestsToggleId}-yes" name="${specialRequestsToggleId}" value="yes" ${initialSpecialRequestsChecked ? 'checked' : ''}>
                        <label for="${specialRequestsToggleId}-yes">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="${specialRequestsToggleId}-no" name="${specialRequestsToggleId}" value="no" ${!initialSpecialRequestsChecked ? 'checked' : ''}>
                        <label for="${specialRequestsToggleId}-no">No</label>
                    </div>
                </div>
            </div>
            <div id="${specialRequestsTextareaId}-container" class="form-field-group ${initialSpecialRequestsChecked ? '' : 'hidden'}">
                <label for="${specialRequestsTextareaId}">Please describe your special requests:</label>
                <textarea id="${specialRequestsTextareaId}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white" rows="3" placeholder="e.g., Needs hot water for medication, special meal requirement">${member.specialRequests || ''}</textarea>
            </div>
        `;

        const formId = `local-assistance-form-${memberIndex}`;
        const formHtml = `
            <h2>Local Assistance & Recordings for ${memberName}</h2>
            <div class="form-field-group">
                <label>Do you need any local travel assistance?</label>
                <div class="flex flex-wrap gap-x-4 gap-y-2"> <!-- Added flex-wrap for responsiveness -->
                    <div class="radio-option">
                        <input type="radio" id="assistance-yes-${memberIndex}" name="local-assistance-choice-${memberIndex}" value="yes" ${member.localAssistance ? 'checked' : ''}>
                        <label for="assistance-yes-${memberIndex}">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="assistance-no-${memberIndex}" name="local-assistance-choice-${memberIndex}" value="no" ${!member.localAssistance ? 'checked' : ''}>
                        <label for="assistance-no-${memberIndex}">No</label>
                    </div>
                </div>
            </div>
            <div id="assistance-dropdown-${memberIndex}" class="form-field-group ${member.localAssistance ? '' : 'hidden'}">
                <label for="local-assistance-mode-${memberIndex}">Which person from Sampark Group can assist?</label>
                <select id="local-assistance-mode-${memberIndex}" class="w-full p-3 rounded-xl bg-[var(--form-field-bg)] border border-[var(--glass-border)] text-[var(--text-color-primary)] focus:outline-none focus:ring-2 focus:ring-white">
                    <option value="">Select Person</option>
                    ${assistanceOptionsHtml}
                </select>
                <div id="local-assistance-error-${memberIndex}" class="error-message"></div>
            </div>

            ${recordingsInputHtml} <!-- Textarea for recordings -->
            ${specialRequestsHtml} <!-- Special requests conditional -->

            <button class="form-button mt-4" onclick="submitLocalAssistance(this, ${memberIndex})">Continue</button>
        `;
        const formElement = addInteractionElement('user-input-form', formHtml, formId);

        // Add Copy From Previous Section
        addCopyFromPreviousSection(formElement, memberIndex, formId);


        // Add event listeners for conditional display
        const assistanceYesRadio = document.getElementById(`assistance-yes-${memberIndex}`);
        const assistanceNoRadio = document.getElementById(`assistance-no-${memberIndex}`);
        const assistanceDropdownDiv = document.getElementById(`assistance-dropdown-${memberIndex}`);

        const toggleAssistanceDropdown = () => {
            if (assistanceYesRadio.checked) {
                assistanceDropdownDiv.classList.remove('hidden');
            } else {
                assistanceDropdownDiv.classList.add('hidden');
                document.getElementById(`local-assistance-mode-${memberIndex}`).value = ''; // Clear selection
            }
        };
        if (assistanceYesRadio && assistanceNoRadio && assistanceDropdownDiv) {
            assistanceYesRadio.addEventListener('change', toggleAssistanceDropdown);
            assistanceNoRadio.addEventListener('change', toggleAssistanceDropdown);
            toggleAssistanceDropdown(); // Initial call
        }

        // Special requests toggle listener
        const specialRequestsToggleYes = document.getElementById(`${specialRequestsToggleId}-yes`);
        const specialRequestsToggleNo = document.getElementById(`${specialRequestsToggleId}-no`);
        const specialRequestsTextareaContainer = document.getElementById(`${specialRequestsTextareaId}-container`);
        if (specialRequestsToggleYes && specialRequestsToggleNo && specialRequestsTextareaContainer) {
            const toggleSpecialRequestsTextarea = () => {
                if (specialRequestsToggleYes.checked) {
                    specialRequestsTextareaContainer.classList.remove('hidden');
                } else {
                    specialRequestsTextareaContainer.classList.add('hidden');
                    document.getElementById(specialRequestsTextareaId).value = ''; // Clear textarea if No
                }
            };
            specialRequestsToggleYes.addEventListener('change', toggleSpecialRequestsTextarea);
            specialRequestsToggleNo.addEventListener('change', toggleSpecialRequestsTextarea);
            toggleSpecialRequestsTextarea(); // Initial call
        }
    }

    /**
     * Handles submission of local assistance and recordings details.
     * @param {HTMLButtonElement} button - The button that triggered the submission.
     * @param {number} memberIndex - The index of the current member.
     */
    function submitLocalAssistance(button, memberIndex) {
        const member = registrationData.travelDetails.members[memberIndex];
        const formElement = button.closest('.user-input-form');
        let isValid = true;

        // Local Assistance
        const assistanceChoice = document.querySelector(`input[name="local-assistance-choice-${memberIndex}"]:checked`)?.value;
        if (assistanceChoice === 'yes') {
            const assistanceMode = document.getElementById(`local-assistance-mode-${memberIndex}`).value;
            const assistanceError = document.getElementById(`local-assistance-error-${memberIndex}`);
            if (assistanceMode === "") {
                assistanceError.textContent = 'Please select a mode of assistance.';
                isValid = false;
            } else {
                assistanceError.textContent = '';
                member.localAssistance = assistanceMode;
            }
        } else {
            member.localAssistance = '';
        }

        // Recordings Needed (now a string from textarea)
        member.recordingsNeeded = document.getElementById(`recordings-text-${memberIndex}`).value.trim();

        // Special Requests (conditional textarea)
        const specialRequestsToggle = document.querySelector(`input[name="special-requests-toggle-${memberIndex}"]:checked`)?.value;
        member.specialRequests = (specialRequestsToggle === 'yes') ? document.getElementById(`special-requests-text-${memberIndex}`).value.trim() : '';


        if (isValid) {
            disableFormElements(formElement);
            button.textContent = 'Submitted!';
            addInteractionElement('user-input-form', `<span>${member.firstName} ${member.lastName}'s assistance, recordings, and special requests preferences confirmed.</span>`);

            // Move to the next member or to confirm booking
            currentMemberIndex++;
            if (currentMemberIndex < registrationData.travelDetails.members.length) {
                setTimeout(() => {
                    addInteractionElement(
                        'bot-message',
                        `<span>Now, let's get the remaining details for ${registrationData.travelDetails.members[currentMemberIndex].firstName} ${registrationData.travelDetails.members[currentMemberIndex].lastName}.</span>`,
                        null
                    );
                    displayArrivalDepartureAndDatesForm(currentMemberIndex);
                }, 1000);
            } else {
                // All members processed, confirm booking
                setTimeout(() => displaySummaryAndConfirmForm(), 1000); // Changed to display summary
            }
        } else {
            addInteractionElement('bot-message', `<span>Please correct the highlighted errors.</span>`);
        }
    }

    /**
     * Generates a unique registration ID.
     * @returns {string} The generated registration ID.
     */
    function generateUUID() {
        if (typeof crypto !== 'undefined' && crypto.randomUUID) {
            return `REG-2025-${crypto.randomUUID().slice(0, 8).toUpperCase()}`; // Shorter UUID for ID
        } else {
            // Fallback for environments without crypto.randomUUID (e.g., older browsers)
            let dt = new Date().getTime();
            const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = (dt + Math.random() * 16) % 16 | 0;
                dt = Math.floor(dt / 16);
                return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
            return `REG-2025-${uuid.slice(0, 8).toUpperCase()}`;
        }
    }

    /**
     * Simulates saving/updating registration data to DynamoDB via a backend API.
     * @param {Object} data - The registration data to save.
     * @param {boolean} isUpdate - True if this is an update to an existing registration.
     */
    async function saveRegistrationToDynamoDB(data) {
        const DYNAMODB_API_ENDPOINT = 'http://localhost:8000/register'; // Update if deployed

        try {
        const response = await fetch(DYNAMODB_API_ENDPOINT, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            const result = await response.json();
            console.log('✅ Registration uploaded successfully:', result);
            displayMessage('Registration data uploaded successfully!', 'success');

            // Optional: Show confirmation screen
            showFullScreenSuccessAnimation(() => {
                // Now directly show the ticket confirmation after green screen animation
                displayTicketConfirmation();
            });

        } else {
            const errorData = await response.json();
            console.error('❌ Failed to upload registration:', response.status, errorData);
            displayMessage(`Failed to upload registration: ${errorData.message || response.statusText}`, 'error');
        }
    } catch (error) {
        console.error('❌ Error uploading registration to DynamoDB:', error);
        displayMessage('An error occurred while uploading registration. Please try again.', 'error');
    }
}


    /**
     * Confirms the booking and displays the final ID.
     * @param {HTMLButtonElement} [button] - The button that triggered the submission (optional).
     */
    async function confirmBooking(button = null) {
        if (button) {
            const formElement = button.closest('.user-input-form');
            disableFormElements(formElement, true); // Permanently disable after booking
            addInteractionElement('user-input-form', `<span>Confirmed! Proceeding to booking...</span>`);
        }

        console.log("Booking confirmed! Attempting to save data:", registrationData);

        // Always generate new ID if it's a new registration
        // `isEditingExisting` is always false on this page now.
        registrationData.registrationId = generateUUID();

        // Call the simulated DynamoDB save/update function
        await saveRegistrationToDynamoDB(registrationData);
    }

    /**
     * Displays a summary of all registration details before final confirmation.
     */
    function displaySummaryAndConfirmForm() {
        let summaryHtml = `
            <h2>Review Your Registration Details</h2>
            <p>Please review all the details below before confirming your registration.</p>

            <div class="summary-section">
                <h3><i class="fas fa-id-badge mr-2"></i>Main Registrant Details</h3>
                <p><strong>Name:</strong> <span>${registrationData.mainRegistrant.firstName} ${registrationData.mainRegistrant.lastName}</span></p>
                <p><strong>Mobile:</strong> <span>${registrationData.mainRegistrant.mobile}</span></p>
                <p><strong>Reference 1:</strong> <span>${registrationData.mainRegistrant.ref1 || 'N/A'}</span></p>
                <p><strong>Reference 2:</strong> <span>${registrationData.mainRegistrant.ref2 || 'N/A'}</span></p>
            </div>
        `;

        registrationData.travelDetails.members.forEach((member, index) => {
            const mealsSummary = member.attendingDates.map(dateYYYYMMDD => {
                const prefs = member.mealPreferences[dateYYYYMMDD];
                const displayDate = new Date(dateYYYYMMDD + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });

                const mealList = [];
                // Only include breakfast if it's not July 8th and selected
                if (dateYYYYMMDD !== '2025-07-08' && prefs && prefs.breakfast) mealList.push('Breakfast');
                if (prefs && prefs.lunch) mealList.push('Lunch');
                if (prefs && prefs.highTea) mealList.push('High Tea');
                if (prefs && prefs.dinner) mealList.push('Dinner');

                const mealsStr = mealList.length > 0 ? mealList.join(', ') : 'No Meals';

                const teaCoffeeDisplay = (prefs && prefs.teaCoffeePreference === 'none') || !prefs ? 'None' : `${prefs.teaCoffeePreference.charAt(0).toUpperCase() + prefs.teaCoffeePreference.slice(1)} (Sugar: ${prefs.teaCoffeeSugar === 'sugar' ? 'Yes' : 'No'})`;

                return `<li><strong>${displayDate}:</strong> ${mealsStr} (Beverage: ${teaCoffeeDisplay}) ${prefs && prefs.packedFood ? '(Packed Meal)' : ''}</li>`;
            }).join('');

            const morningTeaCoffeeDisplay = registrationData.travelDetails.members[index].morningTeaCoffee.preference === 'none' ? 'None' : `${registrationData.travelDetails.members[index].morningTeaCoffee.preference.charAt(0).toUpperCase() + registrationData.travelDetails.members[index].morningTeaCoffee.preference.slice(1)} (Sugar: ${registrationData.travelDetails.members[index].morningTeaCoffee.sugar === 'sugar' ? 'Yes' : 'No'})`;


            summaryHtml += `
                <div class="summary-attendee-card mt-4">
                    <h4><i class="fas fa-user-circle mr-2"></i>${member.firstName} ${member.lastName} ${index === 0 ? '(Main Registrant)' : ''}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 text-sm">
                        <div><strong>Age/Gender:</strong> <span>${member.age} / ${member.gender}</span></div>
                        <div><strong>Mobile:</strong> <span>${member.mobile}</span></div>
                        <div><strong>Attending Dates:</strong> <span>${member.attendingDates.map(d => new Date(d + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })).join(', ')}</span></div>
                        <div><strong>Travel:</strong> <span>${member.modeOfTransport} from ${member.cityOfOrigin}</span></div>
                        <div><strong>Arrival:</strong> <span>${member.arrivalDate} ${member.arrivalTime}</span></div>
                        <div><strong>Departure:</strong> <span>${member.departureDate} ${member.departureTime}</span></div>
                        <div><strong>Accommodation:</strong> <span>${member.stayAtHall ? 'Hall' : 'Other'}${member.stayAtHall && member.cotRequired ? ' (Cot)' : ''}</span></div>
                        <div><strong>Stairs Difficulty:</strong> <span>${member.difficultyClimbingStairs ? 'Yes' : 'No'}</span></div>
                        <div><strong>Local Assistance:</strong> <span>${member.localAssistance || 'None'}</span></div>
                        <div><strong>Recordings:</strong> <span>${member.recordingsNeeded || 'None'}</span></div>
                    </div>
                    <h5 class="font-semibold text-base mt-4 mb-2"><i class="fas fa-mug-hot mr-2"></i>Morning Tea/Coffee:</h5>
                    <ul class="list-none text-sm ml-4">
                        <li>${morningTeaCoffeeDisplay}</li>
                    </ul>
                    <h5 class="font-semibold text-base mt-4 mb-2"><i class="fas fa-utensils mr-2"></i>Meals Per Day:</h5>
                    <ul class="list-none text-sm ml-4">
                        ${mealsSummary}
                    </ul>
                    <p class="mt-4"><strong><i class="fas fa-exclamation-triangle mr-2"></i>Special Requests:</strong> <span>${member.specialRequests || 'None'}</span></p>
                </div>
            `;
        });

        summaryHtml += `
            <button class="form-button mt-8 w-full" onclick="confirmBooking(this)">Confirm All Details & Book</button>
        `;

        addInteractionElement('user-input-form', summaryHtml, 'registration-summary-form');
        addInteractionElement('bot-message', `<span>Please review your registration details carefully before confirming.</span>`, null);
    }

    /**
     * Displays the "Concert Ticket" style confirmation for a new registration.
     */
    function displayTicketConfirmation() {
        // Remove all interaction bubbles
        document.querySelectorAll('.interaction-bubble').forEach(bubble => {
            bubble.classList.remove('active');
            setTimeout(() => bubble.remove(), 500);
        });

        // Hide default final greeting section
        finalGreetingSection.classList.add('hidden');

        let attendeesSummaryHtml = '';
        const mealMap = {
            breakfast: 'Breakfast',
            lunch: 'Lunch',
            highTea: 'High Tea',
            dinner: 'Dinner'
        };

        registrationData.travelDetails.members.forEach((member, index) => {
            const mealsSummary = member.attendingDates.map(dateYYYYMMDD => {
                const prefs = member.mealPreferences[dateYYYYMMDD];
                const displayDate = new Date(dateYYYYMMDD + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });

                const mealList = [];
                for (const mealKey in mealMap) {
                    // Only include breakfast if it's not July 8th for the mealList
                    if (mealKey === 'breakfast' && dateYYYYMMDD === '2025-07-08') {
                        // Skip breakfast for July 8th
                    } else if (prefs && prefs[mealKey]) {
                        mealList.push(mealMap[mealKey]);
                    }
                }
                const mealsStr = mealList.length > 0 ? mealList.join(', ') : 'None';

                const teaCoffeeDisplay = (prefs && prefs.teaCoffeePreference === 'none') || !prefs ? 'None' : `${prefs.teaCoffeePreference.charAt(0).toUpperCase() + prefs.teaCoffeePreference.slice(1)} (Sugar: ${prefs.teaCoffeeSugar === 'sugar' ? 'Yes' : 'No'})`;

                return `<li><strong>${displayDate}:</strong> ${mealsStr} (Beverage: ${teaCoffeeDisplay}) ${prefs && prefs.packedFood ? '(Packed Meal)' : ''}</li>`;
            }).join('');

            const morningTeaCoffeeDisplay = registrationData.travelDetails.members[index].morningTeaCoffee.preference === 'none' ? 'None' : `${registrationData.travelDetails.members[index].morningTeaCoffee.preference.charAt(0).toUpperCase() + registrationData.travelDetails.members[index].morningTeaCoffee.preference.slice(1)} (Sugar: ${registrationData.travelDetails.members[index].morningTeaCoffee.sugar === 'sugar' ? 'Yes' : 'No'})`;


            attendeesSummaryHtml += `
                <div class="attendee-entry mt-4 pt-4 border-t border-white/10">
                    <p><strong><i class="fas fa-user mr-2"></i>Name:</strong> <span>${member.firstName} ${member.lastName}</span></p>
                    <p><strong><i class="fas fa-venus-mars mr-2"></i>Gender/Age:</strong> <span>${member.gender} / ${member.age}</span></p>
                    <p><strong><i class="fas fa-phone mr-2"></i>Contact:</strong> <span>${member.mobile}</span></p>
                    <p><strong><i class="fas fa-calendar-check mr-2"></i>Attending:</strong> <span>${member.attendingDates.map(d => new Date(d + 'T00:00:00').toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })).join(', ')}</span></p>
                    <p><strong><i class="fas fa-route mr-2"></i>Travel:</strong> <span>${member.modeOfTransport} from ${member.cityOfOrigin} (Arrive: ${member.arrivalTime}, Depart: ${member.departureTime})</span></p>
                    <p><strong><i class="fas fa-bed mr-2"></i>Accommodation:</strong> <span>${member.stayAtHall ? 'Swapnapoorti Hall' : 'Other'}${member.stayAtHall && member.cotRequired ? ' (Cot Needed)' : ''}</span></p>
                    <p><strong><i class="fas fa-stairs mr-2"></i>Stairs Difficulty:</strong> <span>${member.difficultyClimbingStairs ? 'Yes' : 'No'}</span></p>
                    <p><strong><i class="fas fa-hands-helping mr-2"></i>Local Assistance:</strong> <span>${member.localAssistance || 'None'}</span></p>
                    <p><strong><i class="fas fa-headphones-alt mr-2"></i>Recordings:</strong> <span>${member.recordingsNeeded || 'None'}</span></p>
                    <h5 class="font-semibold text-base mt-2 mb-1"><i class="fas fa-mug-hot mr-2"></i>Morning Tea/Coffee:</h5>
                    <ul class="list-none text-sm ml-4">
                        <li>${morningTeaCoffeeDisplay}</li>
                    </ul>
                    <h5 class="font-semibold text-base mt-2 mb-1"><i class="fas fa-utensils mr-2"></i>Meals:</h5>
                    <ul class="list-none text-sm ml-4">
                        ${mealsSummary}
                    </ul>
                    <p class="mt-2"><strong><i class="fas fa-exclamation-triangle mr-2"></i>Special Requests:</strong> <span>${member.specialRequests || 'None'}</span></p>
                </div>
            `;
        });

        const ticketHtml = `
            <p class="text-sm font-semibold text-yellow-300 text-center mb-4 leading-relaxed opacity-80">
                July 8 - 11, 2025 | Swapnapoorti Hall, Pune
            </p>
            <div class="ticket-confirmation-card" id="ticket-confirmation-card">
                <div class="ticket-header">
                    <h2>Gurukul Utsav 2025</h2>
                    <span class="registration-id">${registrationData.registrationId}</span>
                </div>

                <div class="ticket-details">
                    <h4><i class="fas fa-info-circle mr-2"></i>Registration Summary</h4>
                    <p><strong>Main Registrant:</strong> <span>${registrationData.mainRegistrant.firstName} ${registrationData.mainRegistrant.lastName}</span></p>
                    <p><strong>Contact:</strong> <span>${registrationData.mainRegistrant.mobile}</span></p>
                    <p><strong>References:</strong> <span>${registrationData.mainRegistrant.ref1 || 'N/A'}, ${registrationData.mainRegistrant.ref2 || 'N/A'}</span></p>

                    <h4 class="mt-6"><i class="fas fa-users mr-2"></i>Attendees (${registrationData.travelDetails.members.length})</h4>
                    ${attendeesSummaryHtml}
                </div>

                <div class="ticket-footer">
                    <p>We are delighted to welcome you to Gurukul Utsav!</p>
                    <button class="form-button" onclick="downloadRegistrationDetails()">
                        <i class="fas fa-download pr-1"></i> Download Details
                    </button>
                    <button class="form-button" onclick="initFormFlow()">
                        <i class="fas fa-plus-circle pr-1"></i> Start New Registration
                    </button>
                </div>
            </div>
        `;

        interactionWindow.innerHTML = ticketHtml; // Replace content with the ticket
        scrollToBottom(); // Ensure it's visible
    }

    /**
     * Downloads the complete registration data as a PDF file.
     */
    async function downloadRegistrationDetails() {
        const element = document.getElementById('ticket-confirmation-card');
        if (!element) {
            displayMessage('Error: Ticket element not found for PDF generation.', 'error');
            return;
        }

        // Show loading overlay
        pdfLoadingOverlay.classList.add('active');

        // Clone the element to avoid modifying the displayed one during PDF generation
        const clonedElement = element.cloneNode(true);
        // Remove the download button from the cloned element for PDF
        const downloadButtonInCloned = clonedElement.querySelector('.ticket-footer .form-button');
        if (downloadButtonInCloned) {
            downloadButtonInCloned.remove();
        }

        // --- Apply PDF-specific styling to the cloned element ---
        clonedElement.style.background = 'white'; // White background for readability
        clonedElement.style.color = '#000'; // Dark text color for general content
        clonedElement.style.boxShadow = 'none'; // Remove shadow for print
        clonedElement.style.border = '1px solid #666'; // Slightly darker border for definition
        clonedElement.style.transform = 'none'; // Remove transform for print
        clonedElement.style.borderRadius = '0.5rem'; // Keep a slight border radius
        clonedElement.style.padding = '20px'; // Consistent padding

        // Adjust header for PDF
        const pdfHeaderH2 = clonedElement.querySelector('.ticket-header h2');
        if (pdfHeaderH2) {
            pdfHeaderH2.style.color = '#003366'; // Very dark blue for the main title
            pdfHeaderH2.style.textShadow = 'none'; // Remove text shadow
            pdfHeaderH2.style.fontSize = '2.5em'; // Make it bolder/larger
            pdfHeaderH2.style.fontWeight = '900'; // Extra bold
        }

        // Adjust registration ID for PDF
        const pdfRegistrationId = clonedElement.querySelector('.registration-id');
        if (pdfRegistrationId) {
            pdfRegistrationId.style.background = 'none'; // Remove gradient background
            pdfRegistrationId.style.color = '#000'; // Pure black text for the ID
            pdfRegistrationId.style.border = '2px dashed #333'; // Bolder, darker dashed border
            pdfRegistrationId.style.boxShadow = 'none'; // Remove shadow
            pdfRegistrationId.style.fontWeight = '900'; // Ensure it's bold
            pdfRegistrationId.style.fontSize = '2.5em'; // Ensure it's large
        }

        // Adjust sub-headers for PDF
        clonedElement.querySelectorAll('.ticket-details h4').forEach(h4 => {
            h4.style.color = '#003366'; // Very dark blue for sub-headers
            h4.style.fontWeight = '700'; // Bold
        });
        clonedElement.querySelectorAll('.summary-attendee-card h4').forEach(h4 => {
            h4.style.color = '#003366'; // Very dark blue for attendee names
            h4.style.fontWeight = '700'; // Bold
        });
        clonedElement.querySelectorAll('.summary-attendee-card h5').forEach(h5 => {
            h5.style.color = '#333'; // Dark grey for sub-sub-headers
            h5.style.fontWeight = '700'; // Bold
        });


        // Adjust text colors for PDF
        clonedElement.querySelectorAll('.ticket-details p span, .ticket-details ul li span').forEach(span => {
            span.style.color = '#000'; // Ensure data values are pure black
            span.style.fontWeight = '500'; // Slightly bold values
        });
        clonedElement.querySelectorAll('.ticket-details p strong, .ticket-details ul li strong').forEach(strong => {
            strong.style.color = '#333'; // Ensure labels are dark grey
            strong.style.fontWeight = '700'; // Bold labels
        });
        clonedElement.querySelectorAll('.attendee-entry p strong').forEach(strong => {
            strong.style.color = '#333'; // Ensure labels are dark grey
            strong.style.fontWeight = '700'; // Bold labels
        });
         clonedElement.querySelectorAll('.attendee-entry p span').forEach(span => {
            span.style.color = '#000'; // Ensure data values are pure black
            span.style.fontWeight = '500'; // Slightly bold values
        });


        // Adjust bullet points for PDF
        clonedElement.querySelectorAll('.ticket-details ul li::before').forEach(before => {
            before.style.color = '#003366'; // Very dark blue bullet points
            before.style.fontWeight = '900'; // Make bullets bolder
        });

        // Adjust perforation lines for PDF (make them visible on white)
        clonedElement.querySelectorAll('.ticket-confirmation-card::before, .ticket-confirmation-card::after').forEach(pseudo => {
            // Change the radial gradient to use dark circles on transparent background
            pseudo.style.backgroundImage = 'radial-gradient(circle at 10px 10px, transparent 9px, rgba(0,0,0,0.8) 10px)'; /* Darker circles */
            pseudo.style.boxShadow = 'none'; // Remove shadows that might look weird on print
        });

        const ticketFooterP = clonedElement.querySelector('.ticket-footer p');
        if (ticketFooterP) {
            ticketFooterP.style.color = '#333'; // Dark grey for footer text
            ticketFooterP.style.fontWeight = '500'; // Slightly bolder
        }

        // Temporarily append the cloned element to the body for correct rendering by html2pdf
        document.body.appendChild(clonedElement);

        try {
            await html2pdf().from(clonedElement).set({
                margin: 10,
                filename: `GurukulUtsav_Registration_${registrationData.registrationId}.pdf`,
                html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).save();

            displayMessage('Registration details downloaded as PDF!', 'success');
        } catch (error) {
                console.error('Error generating PDF:', error);
                displayMessage('Failed to generate PDF. Please try again or use the text download option.', 'error');
            } finally {
            // Hide loading overlay
            pdfLoadingOverlay.classList.remove('active');
            // Remove the cloned element from the DOM
            if (clonedElement.parentNode) {
                clonedElement.parentNode.removeChild(clonedElement);
            }
        }
    }

  </script>
</body>
</html>
